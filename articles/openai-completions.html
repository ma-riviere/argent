<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>OpenAI - Chat Completions API • argent</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="openai-completions_files/libs/quarto-html/popper.min.js"></script><script src="openai-completions_files/libs/quarto-html/tippy.umd.min.js"></script><link href="openai-completions_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="openai-completions_files/libs/quarto-html/light-border.css" rel="stylesheet">
<!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="OpenAI - Chat Completions API">
<meta property="og:image" content="https://ma-riviere.github.io/argent/reference/figures/logo.png">
<meta property="og:image:alt" content="Creating AI Agents in R">
<meta name="twitter:card" content="summary">
<meta name="twitter:creator" content="@mariviere1">
<meta name="twitter:site" content="@mariviere1">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">argent</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Unreleased version">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/argent.html">Get started</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-providers" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Providers</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-providers">
<li><a class="dropdown-item" href="../articles/google-gemini.html">Google Gemini</a></li>
    <li><a class="dropdown-item" href="../articles/anthropic.html">Anthropic</a></li>
    <li><a class="dropdown-item" href="../articles/openrouter.html">OpenRouter</a></li>
    <li><a class="dropdown-item" href="../articles/local-llm.html">Local LLM</a></li>
    <li><a class="dropdown-item" href="../articles/other-providers.html">Other Providers</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>OpenAI</h6></li>
    <li><a class="dropdown-item" href="../articles/openai-responses.html">Responses API</a></li>
    <li><a class="dropdown-item" href="../articles/openai-completions.html">Chat Completions API</a></li>
    <li><a class="dropdown-item" href="../articles/openai-assistants.html">Assistants API</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-advanced-use" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Advanced Use</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-advanced-use">
<li><a class="dropdown-item" href="../articles/advanced-rag.html">RAG with `ragnar`</a></li>
    <li><a class="dropdown-item" href="../articles/advanced-mcp.html">Using MCP Servers</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ma-riviere/argent/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-quarto">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>OpenAI - Chat Completions API</h1>




      <small class="dont-index">Source: <a href="https://github.com/ma-riviere/argent/blob/main/vignettes/articles/openai-completions.qmd" class="external-link"><code>vignettes/articles/openai-completions.qmd</code></a></small>
      <div class="d-none name"><code></code></div>
    </div>






    <section class="section level2"><h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This article covers using OpenAI’s Chat Completions API with argent. This is the standard OpenAI API that supports tool calling, structured outputs, and reasoning with o1/GPT-5 models.</p>
</section><section class="section level2"><h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">openai_chat</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/OpenAI_Chat.html">OpenAI_Chat</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>api_key <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"OPENAI_API_KEY"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<p><strong>Available Models</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">openai_chat</span><span class="op">$</span><span class="fu">list_models</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">id</span>, <span class="st">"-5-"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</section><section class="section level2"><h2 id="basic-completion">Basic Completion<a class="anchor" aria-label="anchor" href="#basic-completion"></a>
</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">openai_chat</span><span class="op">$</span><span class="fu">chat</span><span class="op">(</span></span>
<span>    <span class="st">"What's the R programming language? Answer in three sentences."</span>,</span>
<span>    model <span class="op">=</span> <span class="st">"gpt-5-mini"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</section><section class="section level2"><h2 id="tool-calling-structured-output-reasoning">Tool Calling + Structured Output + Reasoning<a class="anchor" aria-label="anchor" href="#tool-calling-structured-output-reasoning"></a>
</h2>
<p>First, define some web-related tools (search, crawl, fetch, and a general-use tool) bundled in a <code>web_tools</code> list:</p>
<details><summary>Web Tools Implementation</summary><p><strong>Search:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">web_search</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">query</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co">#' @description Search the web for information using Tavily API. Returns a JSON array of search results with titles, URLs, and content snippets. Use this when you need current information, facts, news, or any data not in your training data.</span></span>
<span>    <span class="co">#' @param query:string* The search query string. Be specific and use keywords that will yield the most relevant results.</span></span>
<span>    </span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu">web_search_tavily</span><span class="op">(</span><span class="va">query</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">web_search_tavily</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">query</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">httr2</span><span class="fu">::</span><span class="fu"><a href="https://httr2.r-lib.org/reference/request.html" class="external-link">request</a></span><span class="op">(</span><span class="st">"https://api.tavily.com/search"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>        <span class="fu">httr2</span><span class="fu">::</span><span class="fu"><a href="https://httr2.r-lib.org/reference/req_body.html" class="external-link">req_body_json</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>            query <span class="op">=</span> <span class="va">query</span>,</span>
<span>            search_depth <span class="op">=</span> <span class="st">"basic"</span>,</span>
<span>            include_answer <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>            max_results <span class="op">=</span> <span class="fl">10</span>,</span>
<span>            api_key <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"TAVILY_API_KEY"</span><span class="op">)</span></span>
<span>        <span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>        <span class="fu">httr2</span><span class="fu">::</span><span class="fu"><a href="https://httr2.r-lib.org/reference/req_error.html" class="external-link">req_error</a></span><span class="op">(</span>is_error <span class="op">=</span> \<span class="op">(</span><span class="va">resp</span><span class="op">)</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>        <span class="fu">httr2</span><span class="fu">::</span><span class="fu"><a href="https://httr2.r-lib.org/reference/req_throttle.html" class="external-link">req_throttle</a></span><span class="op">(</span>rate <span class="op">=</span> <span class="fl">20</span><span class="op">/</span><span class="fl">60</span>, realm <span class="op">=</span> <span class="st">"tavily"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>        <span class="fu">httr2</span><span class="fu">::</span><span class="fu"><a href="https://httr2.r-lib.org/reference/req_perform.html" class="external-link">req_perform</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>        <span class="fu">httr2</span><span class="fu">::</span><span class="fu"><a href="https://httr2.r-lib.org/reference/resp_body_raw.html" class="external-link">resp_body_json</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>        <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/keep_at.html" class="external-link">discard_at</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"response_time"</span>, <span class="st">"follow_up_questions"</span>, <span class="st">"images"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">results</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">results</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/keep_at.html" class="external-link">discard_at</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"raw_content"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu">jsonlite</span><span class="fu">::</span><span class="fu"><a href="https://jeroen.r-universe.dev/jsonlite/reference/fromJSON.html" class="external-link">toJSON</a></span><span class="op">(</span><span class="va">results</span>, pretty <span class="op">=</span> <span class="cn">FALSE</span>, auto_unbox <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<p><strong>Fetch:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">web_fetch</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">url</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co">#' @description Fetch and extract the main text content from a web page as clean markdown. Returns the page content with formatting preserved, stripped of navigation, ads, and boilerplate. Use this to read articles, documentation, blog posts, or any web page content.</span></span>
<span>    <span class="co">#' @param url:string* The complete URL of the web page to fetch (e.g., "https://example.com/article"). Must be a valid HTTP/HTTPS URL.</span></span>
<span>    </span>
<span>    <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">web_fetch_trafilatura</span><span class="op">(</span><span class="va">url</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">could_not_fetch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>        <span class="st">"Impossible to fetch the contents of this web page"</span>,</span>
<span>        <span class="st">"Please reload this page"</span>,</span>
<span>        <span class="st">"There was an error while loading"</span>,</span>
<span>        <span class="st">"404"</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span> <span class="op">||</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span> <span class="op">||</span> <span class="fu"><a href="https://rdrr.io/r/base/nchar.html" class="external-link">nchar</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">||</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">res</span>, <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/modifiers.html" class="external-link">fixed</a></span><span class="op">(</span><span class="va">could_not_fetch</span>, ignore_case <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">web_fetch_rvest</span><span class="op">(</span><span class="va">url</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">web_fetch_trafilatura</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">url</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># pip install trafilatura</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span><span class="op">{</span></span>
<span>        <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"trafilatura -u "</span>, <span class="va">url</span>, <span class="st">" --markdown --no-comments --links "</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/system.html" class="external-link">system</a></span><span class="op">(</span>intern <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>            <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/keep.html" class="external-link">keep</a></span><span class="op">(</span><span class="va">nzchar</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span>collapse <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span></span>
<span>        </span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span>
<span>    <span class="op">}</span>,</span>
<span>    error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="st">"Impossible to fetch the contents of this web page. It might not allow scraping"</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">web_fetch_rvest</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">url</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">tags_to_ignore</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>        <span class="st">"a"</span>, <span class="st">"script"</span>, <span class="st">"code"</span>, <span class="st">"img"</span>, <span class="st">"svg"</span>, <span class="st">"footer"</span>, <span class="st">"g"</span>, <span class="st">"path"</span>, <span class="st">"polygon"</span>, <span class="st">"label"</span>, <span class="st">"button"</span>, <span class="st">"form"</span>, <span class="st">"input"</span>, <span class="st">"select"</span>, </span>
<span>        <span class="st">"style"</span>, <span class="st">"link"</span>, <span class="st">"meta"</span>, <span class="st">"noscript"</span>, <span class="st">"iframe"</span>, <span class="st">"embed"</span>, <span class="st">"object"</span>, <span class="st">"param"</span>, <span class="st">"video"</span>, <span class="st">"audio"</span>, <span class="st">"track"</span>, <span class="st">"source"</span>, </span>
<span>        <span class="st">"canvas"</span>, <span class="st">"map"</span>, <span class="st">"area"</span>, <span class="st">"math"</span>, <span class="st">"col"</span>, <span class="st">"colgroup"</span>, <span class="st">"dl"</span>, <span class="st">"dt"</span>, <span class="st">"dd"</span>, <span class="st">"hr"</span>, <span class="st">"pre"</span>, <span class="st">"address"</span>, <span class="st">"figure"</span>, <span class="st">"figcaption"</span>,</span>
<span>        <span class="st">"dfn"</span>, <span class="st">"em"</span>, <span class="st">"kbd"</span>, <span class="st">"samp"</span>, <span class="st">"var"</span>, <span class="st">"del"</span>, <span class="st">"ins"</span>, <span class="st">"mark"</span>, <span class="st">"circle"</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span>    <span class="va">remove_tags</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">xml</span>, <span class="va">tags</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">walk</a></span><span class="op">(</span><span class="va">tags</span>, \<span class="op">(</span><span class="va">tag</span><span class="op">)</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">walk</a></span><span class="op">(</span><span class="fu">xml2</span><span class="fu">::</span><span class="fu"><a href="http://xml2.r-lib.org/reference/xml_find_all.html" class="external-link">xml_find_all</a></span><span class="op">(</span><span class="va">xml</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">".//"</span>, <span class="va">tag</span><span class="op">)</span><span class="op">)</span>, \<span class="op">(</span><span class="va">node</span><span class="op">)</span> <span class="fu">xml2</span><span class="fu">::</span><span class="fu"><a href="http://xml2.r-lib.org/reference/xml_replace.html" class="external-link">xml_remove</a></span><span class="op">(</span><span class="va">node</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">xml</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span></span>
<span>    <span class="va">cleaned_contents</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span></span>
<span>        <span class="fu">rvest</span><span class="fu">::</span><span class="fu"><a href="http://xml2.r-lib.org/reference/read_xml.html" class="external-link">read_html</a></span><span class="op">(</span><span class="va">url</span><span class="op">)</span></span>
<span>        <span class="op">|&gt;</span> <span class="fu">rvest</span><span class="fu">::</span><span class="fu"><a href="https://rvest.tidyverse.org/reference/html_element.html" class="external-link">html_element</a></span><span class="op">(</span><span class="st">"body"</span><span class="op">)</span></span>
<span>        <span class="op">|&gt;</span> <span class="fu">remove_tags</span><span class="op">(</span><span class="va">tags_to_ignore</span><span class="op">)</span></span>
<span>        <span class="op">|&gt;</span> <span class="fu">rvest</span><span class="fu">::</span><span class="fu"><a href="https://rvest.tidyverse.org/reference/html_children.html" class="external-link">html_children</a></span><span class="op">(</span><span class="op">)</span></span>
<span>        <span class="op">|&gt;</span> <span class="fu">rvest</span><span class="fu">::</span><span class="fu"><a href="https://rvest.tidyverse.org/reference/html_text.html" class="external-link">html_text2</a></span><span class="op">(</span><span class="op">)</span></span>
<span>        <span class="op">|&gt;</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/keep.html" class="external-link">discard</a></span><span class="op">(</span>\<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span> <span class="op">==</span> <span class="st">""</span><span class="op">)</span></span>
<span>        <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span>collapse <span class="op">=</span> <span class="st">"\n\n"</span><span class="op">)</span>,</span>
<span>        error <span class="op">=</span> \<span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">cleaned_contents</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
</details><p>Then, let’s define a JSON schema for the structured output using <code><a href="../reference/tool_definitions.html">schema()</a></code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">package_info_schema</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tool_definitions.html">schema</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"package_info"</span>,</span>
<span>    description <span class="op">=</span> <span class="st">"Information about an R package release"</span>,</span>
<span>    release_version <span class="op">=</span> <span class="st">"string* The release version of the package"</span>,</span>
<span>    release_date <span class="op">=</span> <span class="st">"string* The release date of the `release_version`"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">openai_chat</span><span class="op">$</span><span class="fu">chat</span><span class="op">(</span></span>
<span>    <span class="st">"When was the first release of the R 'ellmer' package on GitHub?"</span>,</span>
<span>    model <span class="op">=</span> <span class="st">"gpt-5-mini"</span>,</span>
<span>    reasoning_effort <span class="op">=</span> <span class="st">"low"</span>,</span>
<span>    tools <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="../reference/tool_definitions.html">as_tool</a></span><span class="op">(</span><span class="va">web_search</span><span class="op">)</span>, <span class="fu"><a href="../reference/tool_definitions.html">as_tool</a></span><span class="op">(</span><span class="va">web_fetch</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    output_schema <span class="op">=</span> <span class="va">package_info_schema</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="sourceCode" id="cb8"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>$release_version</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>[1] "v0.1.0"</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>$release_date</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>[1] "2025-01-09T18:06:27Z"</span></code></pre></div>
<div>
<blockquote>
<p><strong>Note</strong></p>
<p>The Chat Completions API does not support extracting reasoning content.</p>
</blockquote>
</div>
</section><section class="section level2"><h2 id="server-side-tools">Server-side Tools<a class="anchor" aria-label="anchor" href="#server-side-tools"></a>
</h2>
<p>Server-side tools are tools you can call without having to define them yourself. They will be run on the provider’s server.</p>
<p>OpenAI Chat Completions API only supports one server-side tool: <strong>web_search</strong></p>
<section class="level2"><h3 id="server-side-web-search">Server-side: Web Search<a class="anchor" aria-label="anchor" href="#server-side-web-search"></a>
</h3>
<p>OpenAI provides specialized search models with web search capabilities for the Chat Completions API:</p>
<ul>
<li><code>gpt-5-search-api</code></li>
<li><code>gpt-4o-search-preview</code></li>
<li><code>gpt-4o-mini-search-preview</code></li>
</ul>
<p><strong>Basic usage:</strong> <code>search-preview</code> models automatically use web search</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">openai_chat</span><span class="op">$</span><span class="fu">chat</span><span class="op">(</span></span>
<span>    <span class="st">"What's the latest version of the R 'ellmer' package?"</span>,</span>
<span>    model <span class="op">=</span> <span class="st">"gpt-4o-mini-search-preview"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<p><strong>Advanced usage:</strong> we can pass additional options to the web search tool</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">openai_chat</span><span class="op">$</span><span class="fu">chat</span><span class="op">(</span></span>
<span>    <span class="st">"What are the best restaurants near me?"</span>,</span>
<span>    model <span class="op">=</span> <span class="st">"gpt-4o-mini-search-preview"</span>,</span>
<span>    tools <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        type <span class="op">=</span> <span class="st">"web_search"</span>,</span>
<span>        user_location <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>            type <span class="op">=</span> <span class="st">"approximate"</span>,</span>
<span>            approximate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>                country <span class="op">=</span> <span class="st">"NO"</span>,</span>
<span>                city <span class="op">=</span> <span class="st">"Trondheim"</span>,</span>
<span>                timezone <span class="op">=</span> <span class="st">"Europe/Oslo"</span></span>
<span>            <span class="op">)</span></span>
<span>        <span class="op">)</span>,</span>
<span>        search_context_size <span class="op">=</span> <span class="st">"medium"</span>  <span class="co"># "low", "medium", or "high"</span></span>
<span>    <span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<p><strong>Cost</strong>: Web searches incur $25.00/1k calls plus token costs.</p>
<div>
<blockquote>
<p><strong>Note</strong></p>
<p>Search models do not support standard sampling parameters (temperature, top_p, frequency_penalty, presence_penalty, n). These are automatically omitted when using search models.</p>
</blockquote>
</div>
<p><strong>Extracting the annotations:</strong> we can extract the annotations with <code>openai_chat$get_supplementary()</code> or <code>print(openai_chat, show_supplementary = TRUE)</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu">yaml</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/yaml/man/as.yaml.html" class="external-link">as.yaml</a></span><span class="op">(</span><span class="va">openai_chat</span><span class="op">$</span><span class="fu">get_supplementary</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="cell">
<details class="code-fold"><summary>Web search annotations</summary><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">annotations</span><span class="kw">:</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">type</span><span class="kw">:</span><span class="at"> url_citation</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">url_citation</span><span class="kw">:</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">end_index</span><span class="kw">:</span><span class="at"> </span><span class="dv">284</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">start_index</span><span class="kw">:</span><span class="at"> </span><span class="dv">196</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">title</span><span class="kw">:</span><span class="at"> Fagn</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">url</span><span class="kw">:</span><span class="at"> https://www.google.com/maps/search/Fagn%2C+Trondheim%2C+Norway?utm_source=openai</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">type</span><span class="kw">:</span><span class="at"> url_citation</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">url_citation</span><span class="kw">:</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">end_index</span><span class="kw">:</span><span class="at"> </span><span class="dv">584</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">start_index</span><span class="kw">:</span><span class="at"> </span><span class="dv">484</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">title</span><span class="kw">:</span><span class="at"> Speilsalen</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">url</span><span class="kw">:</span><span class="at"> https://www.google.com/maps/search/Speilsalen%2C+Trondheim%2C+Norway?utm_source=openai</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">type</span><span class="kw">:</span><span class="at"> url_citation</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">url_citation</span><span class="kw">:</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">end_index</span><span class="kw">:</span><span class="at"> </span><span class="dv">909</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">start_index</span><span class="kw">:</span><span class="at"> </span><span class="dv">819</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">title</span><span class="kw">:</span><span class="at"> Credo</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">url</span><span class="kw">:</span><span class="at"> https://www.google.com/maps/search/Credo%2C+Trondheim%2C+Norway?utm_source=openai</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">type</span><span class="kw">:</span><span class="at"> url_citation</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">url_citation</span><span class="kw">:</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">end_index</span><span class="kw">:</span><span class="at"> </span><span class="dv">1241</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">start_index</span><span class="kw">:</span><span class="at"> </span><span class="dv">1122</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">title</span><span class="kw">:</span><span class="at"> To Rom og Kjøkken</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">url</span><span class="kw">:</span><span class="at"> https://www.google.com/maps/search/To+Rom+og+Kj%C3%B8kken%2C+Trondheim%2C+Norway?utm_source=openai</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">type</span><span class="kw">:</span><span class="at"> url_citation</span></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">url_citation</span><span class="kw">:</span></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">end_index</span><span class="kw">:</span><span class="at"> </span><span class="dv">1562</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">start_index</span><span class="kw">:</span><span class="at"> </span><span class="dv">1427</span></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">title</span><span class="kw">:</span><span class="at"> Havfruen Sjømatrestaurant</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">url</span><span class="kw">:</span><span class="at"> https://www.google.com/maps/search/Havfruen+Sj%C3%B8matrestaurant%2C+Trondheim%2C+Norway?utm_source=openai</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">type</span><span class="kw">:</span><span class="at"> url_citation</span></span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">url_citation</span><span class="kw">:</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">end_index</span><span class="kw">:</span><span class="at"> </span><span class="dv">1837</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">start_index</span><span class="kw">:</span><span class="at"> </span><span class="dv">1729</span></span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">title</span><span class="kw">:</span><span class="at"> Bula Neobistro</span></span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">url</span><span class="kw">:</span><span class="at"> https://www.google.com/maps/search/Bula+Neobistro%2C+Trondheim%2C+Norway?utm_source=openai</span></span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">type</span><span class="kw">:</span><span class="at"> url_citation</span></span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">url_citation</span><span class="kw">:</span></span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">end_index</span><span class="kw">:</span><span class="at"> </span><span class="dv">2111</span></span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">start_index</span><span class="kw">:</span><span class="at"> </span><span class="dv">1989</span></span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">title</span><span class="kw">:</span><span class="at"> Vertshuset Grenaderen</span></span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">url</span><span class="kw">:</span><span class="at"> https://www.google.com/maps/search/Vertshuset+Grenaderen%2C+Trondheim%2C+Norway?utm_source=openai</span></span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">type</span><span class="kw">:</span><span class="at"> url_citation</span></span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">url_citation</span><span class="kw">:</span></span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">end_index</span><span class="kw">:</span><span class="at"> </span><span class="dv">2805</span></span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">start_index</span><span class="kw">:</span><span class="at"> </span><span class="dv">2686</span></span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">title</span><span class="kw">:</span><span class="at"> Top 10 Best Restaurants to Visit in Trondheim | Norway</span></span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">url</span><span class="kw">:</span><span class="at"> https://www.youtube.com/watch?v=0J6xfdlb3I4&amp;utm_source=openai</span></span></code></pre></div>
</details>
</div>
<p>For more flexible server-side tools, use the <a href="responses-api.html">Responses API</a> instead.</p>
</section></section><section class="section level2"><h2 id="multimodal-inputs">Multimodal Inputs<a class="anchor" aria-label="anchor" href="#multimodal-inputs"></a>
</h2>
<p>OpenAI Responses API supports sending:</p>
<ul>
<li>Images: URLs (as-is, or base64), files (base64)</li>
<li>PDFs: URLs and files (base64, or text content)</li>
<li>Remote files (through <code><a href="../reference/content_converters.html">as_file_content()</a></code>)</li>
<li>Plain text &amp; code files</li>
<li>Text-based data files (csv, tsv, json, ..)</li>
<li>R objects</li>
</ul>
<section class="level2"><h3 id="image-comprehension">Image Comprehension<a class="anchor" aria-label="anchor" href="#image-comprehension"></a>
</h3>
<div class="cell">
<details class="code-fold"><summary>Downloading an example image</summary><div class="sourceCode cell-code" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bsg04_cast_image_url</span> <span class="op">&lt;-</span> <span class="st">"https://upload.wikimedia.org/wikipedia/en/1/1a/Battlestar_Galactica_%282004%29_cast.jpg"</span></span>
<span><span class="va">bsg04_cast_image_path</span> <span class="op">&lt;-</span> <span class="fu">download_temp_file</span><span class="op">(</span><span class="va">bsg04_cast_image_url</span><span class="op">)</span></span></code></pre></div>
</details>
</div>
<p><strong>Sending a local image:</strong></p>
<p>When providing a path to a local image, it will automatically be converted to base64 before being sent to the server.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">openai_chat</span><span class="op">$</span><span class="fu">chat</span><span class="op">(</span></span>
<span>    <span class="st">"Who are the characters in this image, and what show is it from?"</span>,</span>
<span>    <span class="va">bsg04_cast_image_path</span>,</span>
<span>    model <span class="op">=</span> <span class="st">"gpt-5-mini"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="sourceCode" id="cb15"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>This is a promotional shot of the main characters from the reimagined TV series Battlestar Galactica (2004). From left to right the characters are:</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>- Admiral William Adama (commander of the battlestar)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>- President Laura Roslin</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>- Captain Lee "Apollo" Adama</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>- Kara "Starbuck" Thrace</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>- Number Six (the Cylon model)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>- Dr. Gaius Baltar (with Number Six)</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>- Sharon "Boomer" Valerii (a Cylon sleeper/Raptor pilot)</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>(If you want, I can point out who plays each character.)</span></code></pre></div>
<p><em>So say we all!</em></p>
<p><strong>Sending an image URL:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">openai_chat</span><span class="op">$</span><span class="fu">chat</span><span class="op">(</span></span>
<span>    <span class="st">"Who are the characters in this image, and what show is it from?"</span>,</span>
<span>    <span class="va">bsg04_cast_image_url</span>,</span>
<span>    model <span class="op">=</span> <span class="st">"gpt-5-mini"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div>
<blockquote>
<p><strong>Note</strong></p>
<p>OpenAI supports an optional <code>detail</code> parameter (low/high/auto) to control the image processing detail level when the image is sent as a URL. The default value is <code>"auto"</code>.</p>
<p>To specify this parameter, we need to pass the image URL to <code>as_image_content(url, .provider_options = list(detail = "low"))</code>.</p>
<p>We could have used the <code><a href="../reference/content_converters.html">as_image_content()</a></code> to resize the image before sending it with the <code>.resize</code> argument.</p>
<p>OpenAI Chat Completions API also supports sending a file_id (i.e. the image <code>as_file_content(file_id)</code> after uploading it with <code>openai_chat$upload_file()</code>).</p>
</blockquote>
</div>
</section><section class="level2"><h3 id="pdf-comprehension">PDF Comprehension<a class="anchor" aria-label="anchor" href="#pdf-comprehension"></a>
</h3>
<div class="cell">
<details class="code-fold"><summary>Downloading an example PDF (my CV)</summary><div class="sourceCode cell-code" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_cv_url</span> <span class="op">&lt;-</span> <span class="st">"https://ma-riviere.com/res/cv.pdf"</span></span>
<span><span class="va">my_cv_pdf_path</span> <span class="op">&lt;-</span> <span class="fu">download_temp_file</span><span class="op">(</span><span class="va">my_cv_url</span><span class="op">)</span></span></code></pre></div>
</details>
</div>
<p><strong>Sending a local PDF:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">openai_chat</span><span class="op">$</span><span class="fu">chat</span><span class="op">(</span></span>
<span>    <span class="st">"What's my favorite programming language?"</span>,</span>
<span>    <span class="va">my_cv_pdf_path</span>,</span>
<span>    model <span class="op">=</span> <span class="st">"gpt-5-mini"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="sourceCode" id="cb19"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>Based on the resume you provided (page 1), your favorite programming language appears to be R — the header says "R Programming | Data Science | Neuroscience," you list R first under Programming Skills, and you have a strong focus on R &amp; Shiny in your work experience. If that’s not right, tell me which source I should check or confirm your actual preference.</span></code></pre></div>
<p><em>Damn right!</em></p>
<p><strong>Sending PDF URLs:</strong></p>
<p>For OpenAI Chat Completions, by default, PDF URLs are sent as base64 to the server.</p>
<p>However, we can use the <code><a href="../reference/content_converters.html">as_text_content()</a></code> helper to have <code><a href="https://docs.ropensci.org/pdftools//reference/pdf_render_page.html" class="external-link">pdftools::pdf_convert()</a></code> parse the PDFs and pass their text contents to the model instead.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">r6_pdf_url</span> <span class="op">&lt;-</span> <span class="st">"https://cran.r-project.org/web/packages/R6/R6.pdf"</span></span>
<span><span class="va">s7_pdf_url</span> <span class="op">&lt;-</span> <span class="st">"https://cran.r-project.org/web/packages/S7/S7.pdf"</span></span>
<span></span>
<span><span class="va">multimodal_prompt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="st">"Give a 3 sentences summary of the advantages of S7 over R6"</span>,</span>
<span>    <span class="fu"><a href="../reference/content_converters.html">as_text_content</a></span><span class="op">(</span><span class="va">r6_pdf_url</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="../reference/content_converters.html">as_text_content</a></span><span class="op">(</span><span class="va">s7_pdf_url</span><span class="op">)</span>,</span>
<span>    <span class="st">"And give me the current versions of both packages"</span> <span class="co"># To make sure it actually reads the PDFs</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">openai_chat</span><span class="op">$</span><span class="fu">chat</span><span class="op">(</span><span class="op">!</span><span class="op">!</span><span class="op">!</span><span class="va">multimodal_prompt</span>, model <span class="op">=</span> <span class="st">"gpt-5-mini"</span><span class="op">)</span></span></code></pre></div>
</div>
</section><section class="level2"><h3 id="passing-r-objects">Passing R Objects<a class="anchor" aria-label="anchor" href="#passing-r-objects"></a>
</h3>
<p>You can pass any R object to <code>chat()</code> as is:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lm_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">body_mass</span> <span class="op">~</span> <span class="va">species</span> <span class="op">+</span> <span class="va">sex</span>, data <span class="op">=</span> <span class="fu">datasets</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/r/datasets/penguins.html" class="external-link">penguins</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">openai_chat</span><span class="op">$</span><span class="fu">chat</span><span class="op">(</span></span>
<span>    <span class="st">"What can we deduct from this regression model?"</span>,</span>
<span>    <span class="va">lm_obj</span>,</span>
<span>    model <span class="op">=</span> <span class="st">"gpt-5-mini"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="sourceCode" id="cb22"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>1) Estimated effects (relative to the reference group Adelie &amp; female):  </span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>   - Intercept = 3372.4 g → predicted body mass for an Adelie female ≈ 3372 g.  </span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>   - speciesChinstrap = +26.9 g → Chinstrap females ≈ 27 g heavier than Adelie females (practically negligible).  </span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>   - speciesGentoo = +1377.9 g → Gentoo females ≈ 1378 g heavier than Adelie females (large difference).  </span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>   - sexmale = +667.6 g → males ≈ 668 g heavier than females (same additive effect across species).</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>2) Predicted group means (by combination):  </span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>   - Adelie female ≈ 3372 g; Adelie male ≈ 3372.4 + 667.6 ≈ 4040 g.  </span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>   - Chinstrap female ≈ 3372.4 + 26.9 ≈ 3399 g; Chinstrap male ≈ 3399 + 667.6 ≈ 4067 g.  </span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>   - Gentoo female ≈ 3372.4 + 1377.9 ≈ 4750 g; Gentoo male ≈ 4750 + 667.6 ≈ 5418 g.</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>3) Model structure and caveats:  </span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>   - This is an additive linear model (body_mass ~ species + sex) using treatment contrasts (Adelie &amp; female as baselines); sex effect is assumed equal across species (no interaction included).  </span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>   - There are 333 observations (11 rows omitted), rank = 4, df.residual = 329.  </span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>   - The output quoted does not show standard errors, p-values, R² or diagnostic statistics, so you cannot formally assess statistical significance or overall fit from what’s shown — run summary(lm_obj) and diagnostic plots to check significance and model assumptions.</span></code></pre></div>
</section><section class="level2"><h3 id="sending-files">Sending files<a class="anchor" aria-label="anchor" href="#sending-files"></a>
</h3>
<p>We can also send files directly to the model.</p>
<p><strong>Uploading Files</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">file_metadata</span> <span class="op">&lt;-</span> <span class="va">openai_chat</span><span class="op">$</span><span class="fu">upload_file</span><span class="op">(</span><span class="va">my_cv_url</span><span class="op">)</span></span></code></pre></div>
</div>
<p><strong>Listing Files</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">openai_chat</span><span class="op">$</span><span class="fu">list_files</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="sourceCode" id="cb25"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a># A tibble: 1 × 9</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  object id                          purpose   filename               bytes created_at          expires_at status    status_details</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  &lt;chr&gt;  &lt;chr&gt;                       &lt;chr&gt;     &lt;chr&gt;                  &lt;int&gt; &lt;dttm&gt;              &lt;lgl&gt;      &lt;chr&gt;     &lt;lgl&gt;         </span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>1 file   file-5LtQyoh6ZdtK71TpZdTxSn user_data file1cc931188f797.pdf 431965 2025-11-11 21:49:14 NA         processed NA </span></code></pre></div>
<p><strong>Using Uploaded Files</strong></p>
<p>Use <code><a href="../reference/content_converters.html">as_file_content()</a></code> to reference uploaded files:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">openai_chat</span><span class="op">$</span><span class="fu">chat</span><span class="op">(</span></span>
<span>    <span class="st">"What are my two favorite frameworks/tools ?"</span>,</span>
<span>    <span class="fu"><a href="../reference/content_converters.html">as_file_content</a></span><span class="op">(</span><span class="va">file_metadata</span><span class="op">$</span><span class="va">id</span><span class="op">)</span>,</span>
<span>    model <span class="op">=</span> <span class="st">"gpt-5-mini"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="sourceCode" id="cb27"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>On your CV (Frameworks &amp; Tools section, right column on page 1) the top two listed are:</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>- Shiny</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>- Scientific publishing tools — Quarto / R Markdown</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>So your two favorite frameworks/tools appear to be Shiny and Quarto (R Markdown).</span></code></pre></div>
<p><strong>Downloading Files</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">openai_chat</span><span class="op">$</span><span class="fu">download_file</span><span class="op">(</span><span class="va">file_metadata</span><span class="op">$</span><span class="va">id</span>, dest_path <span class="op">=</span> <span class="st">"data"</span><span class="op">)</span>  <span class="co"># Downloads to data/ by default</span></span>
<span><span class="co">#&gt; ✔ [OpenAI] File downloaded to: data/file1cc931188f797.pdf</span></span></code></pre></div>
</div>
<p><strong>Deleting Files</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">openai_chat</span><span class="op">$</span><span class="fu">delete_file</span><span class="op">(</span><span class="va">file_metadata</span><span class="op">$</span><span class="va">id</span><span class="op">)</span></span>
<span><span class="co">#&gt; ✔ [OpenAI] File deleted: file-5LtQyoh6ZdtK71TpZdTxSn</span></span></code></pre></div>
</div>
</section></section><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config);
    }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script></main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://ma-riviere.com" class="external-link">Marc-Aurèle Rivière</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
