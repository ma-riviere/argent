<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Anthropic (Claude) • argent</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="anthropic_files/libs/quarto-html/popper.min.js"></script><script src="anthropic_files/libs/quarto-html/tippy.umd.min.js"></script><link href="anthropic_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="anthropic_files/libs/quarto-html/light-border.css" rel="stylesheet">
<!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Anthropic (Claude)">
<meta property="og:image" content="https://ma-riviere.github.io/argent/reference/figures/logo.png">
<meta property="og:image:alt" content="Creating AI Agents in R">
<meta name="twitter:card" content="summary">
<meta name="twitter:creator" content="@mariviere1">
<meta name="twitter:site" content="@mariviere1">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">argent</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Unreleased version">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/argent.html">Get started</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-providers" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Providers</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-providers">
<li><a class="dropdown-item" href="../articles/google-gemini.html">Google Gemini</a></li>
    <li><a class="dropdown-item" href="../articles/anthropic.html">Anthropic</a></li>
    <li><a class="dropdown-item" href="../articles/openrouter.html">OpenRouter</a></li>
    <li><a class="dropdown-item" href="../articles/local-llm.html">Local LLM</a></li>
    <li><a class="dropdown-item" href="../articles/other-providers.html">Other Providers</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>OpenAI</h6></li>
    <li><a class="dropdown-item" href="../articles/openai-responses.html">Responses API</a></li>
    <li><a class="dropdown-item" href="../articles/openai-completions.html">Chat Completions API</a></li>
    <li><a class="dropdown-item" href="../articles/openai-assistants.html">Assistants API</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-advanced-use" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Advanced Use</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-advanced-use">
<li><a class="dropdown-item" href="../articles/advanced-rag.html">RAG with `ragnar`</a></li>
    <li><a class="dropdown-item" href="../articles/advanced-mcp.html">Using MCP Servers</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ma-riviere/argent/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-quarto">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Anthropic (Claude)</h1>




      <small class="dont-index">Source: <a href="https://github.com/ma-riviere/argent/blob/main/vignettes/articles/anthropic.qmd" class="external-link"><code>vignettes/articles/anthropic.qmd</code></a></small>
      <div class="d-none name"><code></code></div>
    </div>






    <section class="section level2"><h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This article covers using the Anthropic (Claude) provider with <code>argent</code>. Anthropic offers powerful extended thinking capabilities, server-side tools, and prompt caching for cost optimization.</p>
</section><section class="section level2"><h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">anthropic</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Anthropic.html">Anthropic</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>api_key <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"ANTHROPIC_API_KEY"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<p><strong>Available Models</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">anthropic</span><span class="op">$</span><span class="fu">list_models</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
</section><section class="section level2"><h2 id="basic-completion">Basic Completion<a class="anchor" aria-label="anchor" href="#basic-completion"></a>
</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">anthropic</span><span class="op">$</span><span class="fu">chat</span><span class="op">(</span></span>
<span>    <span class="st">"What's the R programming language? Answer in three sentences."</span>,</span>
<span>    model <span class="op">=</span> <span class="st">"claude-haiku-4-5-20251001"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</section><section class="section level2"><h2 id="tool-calling-structured-output-thinking">Tool Calling + Structured Output + Thinking<a class="anchor" aria-label="anchor" href="#tool-calling-structured-output-thinking"></a>
</h2>
<p>Anthropic supports extended thinking via the <code>thinking_budget</code> parameter, which allows models to reason through problems before responding.</p>
<p>First, define some web-related tools (search, crawl, fetch, and a general-use tool) bundled in a <code>web_tools</code> list:</p>
<details><summary>Web Tools Implementation</summary><p><strong>Search:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">web_search</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">query</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co">#' @description Search the web for information using Tavily API. Returns a JSON array of search results with titles, URLs, and content snippets. Use this when you need current information, facts, news, or any data not in your training data.</span></span>
<span>    <span class="co">#' @param query:string* The search query string. Be specific and use keywords that will yield the most relevant results.</span></span>
<span>    </span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu">web_search_tavily</span><span class="op">(</span><span class="va">query</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">web_search_tavily</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">query</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">httr2</span><span class="fu">::</span><span class="fu"><a href="https://httr2.r-lib.org/reference/request.html" class="external-link">request</a></span><span class="op">(</span><span class="st">"https://api.tavily.com/search"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>        <span class="fu">httr2</span><span class="fu">::</span><span class="fu"><a href="https://httr2.r-lib.org/reference/req_body.html" class="external-link">req_body_json</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>            query <span class="op">=</span> <span class="va">query</span>,</span>
<span>            search_depth <span class="op">=</span> <span class="st">"basic"</span>,</span>
<span>            include_answer <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>            max_results <span class="op">=</span> <span class="fl">10</span>,</span>
<span>            api_key <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"TAVILY_API_KEY"</span><span class="op">)</span></span>
<span>        <span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>        <span class="fu">httr2</span><span class="fu">::</span><span class="fu"><a href="https://httr2.r-lib.org/reference/req_error.html" class="external-link">req_error</a></span><span class="op">(</span>is_error <span class="op">=</span> \<span class="op">(</span><span class="va">resp</span><span class="op">)</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>        <span class="fu">httr2</span><span class="fu">::</span><span class="fu"><a href="https://httr2.r-lib.org/reference/req_throttle.html" class="external-link">req_throttle</a></span><span class="op">(</span>rate <span class="op">=</span> <span class="fl">20</span><span class="op">/</span><span class="fl">60</span>, realm <span class="op">=</span> <span class="st">"tavily"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>        <span class="fu">httr2</span><span class="fu">::</span><span class="fu"><a href="https://httr2.r-lib.org/reference/req_perform.html" class="external-link">req_perform</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>        <span class="fu">httr2</span><span class="fu">::</span><span class="fu"><a href="https://httr2.r-lib.org/reference/resp_body_raw.html" class="external-link">resp_body_json</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>        <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/keep_at.html" class="external-link">discard_at</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"response_time"</span>, <span class="st">"follow_up_questions"</span>, <span class="st">"images"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">results</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">results</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/keep_at.html" class="external-link">discard_at</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"raw_content"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu">jsonlite</span><span class="fu">::</span><span class="fu"><a href="https://jeroen.r-universe.dev/jsonlite/reference/fromJSON.html" class="external-link">toJSON</a></span><span class="op">(</span><span class="va">results</span>, pretty <span class="op">=</span> <span class="cn">FALSE</span>, auto_unbox <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<p><strong>Fetch:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">web_fetch</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">url</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co">#' @description Fetch and extract the main text content from a web page as clean markdown. Returns the page content with formatting preserved, stripped of navigation, ads, and boilerplate. Use this to read articles, documentation, blog posts, or any web page content.</span></span>
<span>    <span class="co">#' @param url:string* The complete URL of the web page to fetch (e.g., "https://example.com/article"). Must be a valid HTTP/HTTPS URL.</span></span>
<span>    </span>
<span>    <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">web_fetch_trafilatura</span><span class="op">(</span><span class="va">url</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">could_not_fetch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>        <span class="st">"Impossible to fetch the contents of this web page"</span>,</span>
<span>        <span class="st">"Please reload this page"</span>,</span>
<span>        <span class="st">"There was an error while loading"</span>,</span>
<span>        <span class="st">"404"</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span> <span class="op">||</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span> <span class="op">||</span> <span class="fu"><a href="https://rdrr.io/r/base/nchar.html" class="external-link">nchar</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">||</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">res</span>, <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/modifiers.html" class="external-link">fixed</a></span><span class="op">(</span><span class="va">could_not_fetch</span>, ignore_case <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">web_fetch_rvest</span><span class="op">(</span><span class="va">url</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">web_fetch_trafilatura</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">url</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># pip install trafilatura</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span><span class="op">{</span></span>
<span>        <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"trafilatura -u "</span>, <span class="va">url</span>, <span class="st">" --markdown --no-comments --links "</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/system.html" class="external-link">system</a></span><span class="op">(</span>intern <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>            <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/keep.html" class="external-link">keep</a></span><span class="op">(</span><span class="va">nzchar</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span>collapse <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span></span>
<span>        </span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span>
<span>    <span class="op">}</span>,</span>
<span>    error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="st">"Impossible to fetch the contents of this web page. It might not allow scraping"</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">web_fetch_rvest</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">url</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">tags_to_ignore</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>        <span class="st">"a"</span>, <span class="st">"script"</span>, <span class="st">"code"</span>, <span class="st">"img"</span>, <span class="st">"svg"</span>, <span class="st">"footer"</span>, <span class="st">"g"</span>, <span class="st">"path"</span>, <span class="st">"polygon"</span>, <span class="st">"label"</span>, <span class="st">"button"</span>, <span class="st">"form"</span>, <span class="st">"input"</span>, <span class="st">"select"</span>, </span>
<span>        <span class="st">"style"</span>, <span class="st">"link"</span>, <span class="st">"meta"</span>, <span class="st">"noscript"</span>, <span class="st">"iframe"</span>, <span class="st">"embed"</span>, <span class="st">"object"</span>, <span class="st">"param"</span>, <span class="st">"video"</span>, <span class="st">"audio"</span>, <span class="st">"track"</span>, <span class="st">"source"</span>, </span>
<span>        <span class="st">"canvas"</span>, <span class="st">"map"</span>, <span class="st">"area"</span>, <span class="st">"math"</span>, <span class="st">"col"</span>, <span class="st">"colgroup"</span>, <span class="st">"dl"</span>, <span class="st">"dt"</span>, <span class="st">"dd"</span>, <span class="st">"hr"</span>, <span class="st">"pre"</span>, <span class="st">"address"</span>, <span class="st">"figure"</span>, <span class="st">"figcaption"</span>,</span>
<span>        <span class="st">"dfn"</span>, <span class="st">"em"</span>, <span class="st">"kbd"</span>, <span class="st">"samp"</span>, <span class="st">"var"</span>, <span class="st">"del"</span>, <span class="st">"ins"</span>, <span class="st">"mark"</span>, <span class="st">"circle"</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span>    <span class="va">remove_tags</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">xml</span>, <span class="va">tags</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">walk</a></span><span class="op">(</span><span class="va">tags</span>, \<span class="op">(</span><span class="va">tag</span><span class="op">)</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">walk</a></span><span class="op">(</span><span class="fu">xml2</span><span class="fu">::</span><span class="fu"><a href="http://xml2.r-lib.org/reference/xml_find_all.html" class="external-link">xml_find_all</a></span><span class="op">(</span><span class="va">xml</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">".//"</span>, <span class="va">tag</span><span class="op">)</span><span class="op">)</span>, \<span class="op">(</span><span class="va">node</span><span class="op">)</span> <span class="fu">xml2</span><span class="fu">::</span><span class="fu"><a href="http://xml2.r-lib.org/reference/xml_replace.html" class="external-link">xml_remove</a></span><span class="op">(</span><span class="va">node</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">xml</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span></span>
<span>    <span class="va">cleaned_contents</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span></span>
<span>        <span class="fu">rvest</span><span class="fu">::</span><span class="fu"><a href="http://xml2.r-lib.org/reference/read_xml.html" class="external-link">read_html</a></span><span class="op">(</span><span class="va">url</span><span class="op">)</span></span>
<span>        <span class="op">|&gt;</span> <span class="fu">rvest</span><span class="fu">::</span><span class="fu"><a href="https://rvest.tidyverse.org/reference/html_element.html" class="external-link">html_element</a></span><span class="op">(</span><span class="st">"body"</span><span class="op">)</span></span>
<span>        <span class="op">|&gt;</span> <span class="fu">remove_tags</span><span class="op">(</span><span class="va">tags_to_ignore</span><span class="op">)</span></span>
<span>        <span class="op">|&gt;</span> <span class="fu">rvest</span><span class="fu">::</span><span class="fu"><a href="https://rvest.tidyverse.org/reference/html_children.html" class="external-link">html_children</a></span><span class="op">(</span><span class="op">)</span></span>
<span>        <span class="op">|&gt;</span> <span class="fu">rvest</span><span class="fu">::</span><span class="fu"><a href="https://rvest.tidyverse.org/reference/html_text.html" class="external-link">html_text2</a></span><span class="op">(</span><span class="op">)</span></span>
<span>        <span class="op">|&gt;</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/keep.html" class="external-link">discard</a></span><span class="op">(</span>\<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span> <span class="op">==</span> <span class="st">""</span><span class="op">)</span></span>
<span>        <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span>collapse <span class="op">=</span> <span class="st">"\n\n"</span><span class="op">)</span>,</span>
<span>        error <span class="op">=</span> \<span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">cleaned_contents</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
</details><p>Then, let’s define a JSON schema for the structured output using <code><a href="../reference/tool_definitions.html">schema()</a></code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">package_info_schema</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tool_definitions.html">schema</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"package_info"</span>,</span>
<span>    description <span class="op">=</span> <span class="st">"Information about an R package release"</span>,</span>
<span>    release_version <span class="op">=</span> <span class="st">"string* The release version of the package"</span>,</span>
<span>    release_date <span class="op">=</span> <span class="st">"string* The release date of the `release_version`"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<p>Then, run the agent:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">anthropic</span><span class="op">$</span><span class="fu">chat</span><span class="op">(</span></span>
<span>    <span class="st">"When was the first release of the R 'ellmer' package on GitHub?"</span>,</span>
<span>    model <span class="op">=</span> <span class="st">"claude-haiku-4-5-20251001"</span>,</span>
<span>    thinking_budget <span class="op">=</span> <span class="fl">1024</span>,</span>
<span>    tools <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="../reference/tool_definitions.html">as_tool</a></span><span class="op">(</span><span class="va">web_search</span><span class="op">)</span>, <span class="fu"><a href="../reference/tool_definitions.html">as_tool</a></span><span class="op">(</span><span class="va">web_fetch</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    output_schema <span class="op">=</span> <span class="va">package_info_schema</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="sourceCode" id="cb8"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>$release_version</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>[1] "0.1.0"</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>$release_date</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>[1] "2025-01-09"</span></code></pre></div>
<p>The model will keep calling tools until it has enough information to answer the question.</p>
<section class="level2"><h3 id="extracting-reasoning">Extracting Reasoning<a class="anchor" aria-label="anchor" href="#extracting-reasoning"></a>
</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">anthropic</span><span class="op">$</span><span class="fu">get_reasoning_text</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<p>Alternatively, simply <code>print(anthropic)</code> to see the reasoning and answers’ text in the console, turn by turn.</p>
<div>
<blockquote>
<p><strong>Note</strong></p>
<p><code>get_reasoning_text()</code> and <code>get_content_text()</code> use the last API response (<code>anthropic$get_last_response()</code>) by default.</p>
</blockquote>
</div>
</section></section><section class="section level2"><h2 id="server-side-tools">Server-side Tools<a class="anchor" aria-label="anchor" href="#server-side-tools"></a>
</h2>
<p>Server-side tools are tools you can call without having to define them yourself. They will be run on the provider’s server.</p>
<p>Anthropic provides three server-side tools:</p>
<ul>
<li>
<strong>web_search</strong> - Web search with citations</li>
<li>
<strong>web_fetch</strong> - Fetch and process URLs</li>
<li>
<strong>code_execution</strong> - Execute commands, write and execute python code, analyze data, create visualizations and files</li>
</ul>
<section class="level2"><h3 id="server-side-web-search">Server-side: Web Search<a class="anchor" aria-label="anchor" href="#server-side-web-search"></a>
</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">anthropic</span><span class="op">$</span><span class="fu">chat</span><span class="op">(</span></span>
<span>    <span class="st">"What's the latest version of the R 'ellmer' package?"</span>,</span>
<span>    model <span class="op">=</span> <span class="st">"claude-haiku-4-5-20251001"</span>,</span>
<span>    tools <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"web_search"</span><span class="op">)</span>,</span>
<span>    output_schema <span class="op">=</span> <span class="va">package_info_schema</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div>
<blockquote>
<p><strong>Tip</strong></p>
<p>The <code>web_search</code> tool supports additional parameters like <code>allowed_domains</code>, <code>exclude_domains</code>, <code>max_uses</code>, and <code>user_location</code>. See <a href="https://docs.claude.com/en/docs/agents-and-tools/tool-use/web-search-tool#tool-definition" class="external-link">Anthropic’s documentation</a> for details.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">anthropic</span><span class="op">$</span><span class="fu">chat</span><span class="op">(</span></span>
<span>    <span class="st">"What's the latest version of the R 'ellmer' package?"</span>,</span>
<span>    model <span class="op">=</span> <span class="st">"claude-haiku-4-5-20251001"</span>,</span>
<span>    tools <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>            type <span class="op">=</span> <span class="st">"web_search_20250305"</span>,</span>
<span>            name <span class="op">=</span> <span class="st">"web_search"</span>,</span>
<span>            blocked_domains <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"rdrr.io"</span><span class="op">)</span>,</span>
<span>            max_uses <span class="op">=</span> <span class="fl">2</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    output_schema <span class="op">=</span> <span class="va">package_info_schema</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</blockquote>
</div>
<p>We can call <code>anthropic$get_supplementary()</code> to get the citations.</p>
</section><section class="level2"><h3 id="server-side-web-fetch">Server-side: Web Fetch<a class="anchor" aria-label="anchor" href="#server-side-web-fetch"></a>
</h3>
<p>This server tool lets the LLM fetch the contents of URLs given to it in the prompt.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">anthropic</span><span class="op">$</span><span class="fu">chat</span><span class="op">(</span></span>
<span>    <span class="st">"Summarize the main changes in the current development version of the R 'ellmer' package from: https://raw.githubusercontent.com/tidyverse/ellmer/main/NEWS.md"</span>,</span>
<span>    model <span class="op">=</span> <span class="st">"claude-haiku-4-5-20251001"</span>,</span>
<span>    tools <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"web_fetch"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<p>The <code>web_fetch</code> tool also supports parameters like <code>allowed_domains</code>, <code>exclude_domains</code>, and <code>max_uses</code>. See <a href="https://docs.claude.com/en/docs/agents-and-tools/tool-use/web-fetch-tool#tool-definition" class="external-link">Anthropic’s documentation</a> for details.</p>
<p>We can call <code>anthropic$get_supplementary()</code> to get the details of the searches the server made.</p>
</section><section class="level2"><h3 id="server-side-code-execution">Server-side: Code Execution<a class="anchor" aria-label="anchor" href="#server-side-code-execution"></a>
</h3>
<p>Anthropic’s code_execution tool provides a sandboxed environment for executing shell commands and file operations.</p>
<div>
<blockquote>
<p><strong>Note</strong></p>
<ul>
<li>
<strong>Pricing</strong>: $0.05/session-hour with 5-minute minimum</li>
<li>
<strong>Resources</strong>: 5GB RAM/disk, 1 CPU, no internet access</li>
<li>
<strong>Workspace</strong>: Linked to the API key (files can be downloaded)</li>
<li>
<strong>Sub-tools</strong>:
<ul>
<li>
<code>bash_code_execution</code> - Execute bash commands</li>
<li>
<code>text_editor_code_execution</code> - Edit files</li>
</ul>
</li>
<li>
<strong>Expiration</strong>: 30 days after creation</li>
</ul>
<p>Claude automatically determines which sub-tool to use.</p>
</blockquote>
</div>
<p><strong>Example: Analyzing the Penguins Dataset</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins_url</span> <span class="op">&lt;-</span> <span class="st">"https://raw.githubusercontent.com/allisonhorst/palmerpenguins/refs/heads/main/inst/extdata/penguins.csv"</span></span>
<span><span class="va">penguins_file</span> <span class="op">&lt;-</span> <span class="va">anthropic</span><span class="op">$</span><span class="fu">upload_file</span><span class="op">(</span><span class="va">penguins_url</span><span class="op">)</span></span>
<span></span>
<span><span class="va">code_exec_tool</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"code_execution"</span>, file_ids <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">penguins_file</span><span class="op">$</span><span class="va">id</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">anthropic</span><span class="op">$</span><span class="fu">chat</span><span class="op">(</span></span>
<span>    <span class="st">"Create a summary table showing average body_mass grouped by species, sex, and year. Save as CSV."</span>,</span>
<span>    model <span class="op">=</span> <span class="st">"claude-sonnet-4-5-20250929"</span>,</span>
<span>    tools <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">code_exec_tool</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<p>Inspect the generated code:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">anthropic</span><span class="op">$</span><span class="fu">get_generated_code</span><span class="op">(</span>langs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"python"</span><span class="op">)</span>, as_chunks <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<details><summary>Generated Code</summary><div class="sourceCode" id="cb15"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Read the CSV file</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>input_file <span class="op">=</span> os.path.join(os.environ[<span class="st">'INPUT_DIR'</span>], <span class="st">'fileaa34f5b158276.csv'</span>)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(input_file)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Display basic info about the data</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Original data shape:"</span>, df.shape)</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Column names:"</span>, df.columns.tolist())</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">First few rows:"</span>)</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.head())</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Check for missing values in key columns</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Missing values in key columns:"</span>)</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"species: </span><span class="sc">{</span>df[<span class="st">'species'</span>]<span class="sc">.</span>isna()<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"sex: </span><span class="sc">{</span>df[<span class="st">'sex'</span>]<span class="sc">.</span>isna()<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"year: </span><span class="sc">{</span>df[<span class="st">'year'</span>]<span class="sc">.</span>isna()<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"body_mass: </span><span class="sc">{</span>df[<span class="st">'body_mass'</span>]<span class="sc">.</span>isna()<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove rows where body_mass is NA (can't calculate average for missing values)</span></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Also remove rows where sex is NA if you want clean grouping</span></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>df_clean <span class="op">=</span> df.dropna(subset<span class="op">=</span>[<span class="st">'body_mass'</span>, <span class="st">'sex'</span>, <span class="st">'species'</span>, <span class="st">'year'</span>])</span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Data shape after removing rows with missing values: </span><span class="sc">{</span>df_clean<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Group by species, sex, and year, and calculate average body_mass</span></span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>summary <span class="op">=</span> df_clean.groupby([<span class="st">'species'</span>, <span class="st">'sex'</span>, <span class="st">'year'</span>])[<span class="st">'body_mass'</span>].mean().reset_index()</span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>summary.columns <span class="op">=</span> [<span class="st">'species'</span>, <span class="st">'sex'</span>, <span class="st">'year'</span>, <span class="st">'average_body_mass'</span>]</span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Round to 2 decimal places for readability</span></span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>summary[<span class="st">'average_body_mass'</span>] <span class="op">=</span> summary[<span class="st">'average_body_mass'</span>].<span class="bu">round</span>(<span class="dv">2</span>)</span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort by species, year, and sex for better readability</span></span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>summary <span class="op">=</span> summary.sort_values([<span class="st">'species'</span>, <span class="st">'year'</span>, <span class="st">'sex'</span>]).reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Summary table:"</span>)</span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(summary)</span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Save to CSV</span></span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a>output_file <span class="op">=</span> <span class="st">'/tmp/body_mass_summary.csv'</span></span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a>summary.to_csv(output_file, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb15-44"><a href="#cb15-44" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Summary saved to </span><span class="sc">{</span>output_file<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb15-45"><a href="#cb15-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-46"><a href="#cb15-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Copy to OUTPUT_DIR for export</span></span>
<span id="cb15-47"><a href="#cb15-47" aria-hidden="true" tabindex="-1"></a>output_export <span class="op">=</span> os.path.join(os.environ[<span class="st">'OUTPUT_DIR'</span>], <span class="st">'body_mass_summary.csv'</span>)</span>
<span id="cb15-48"><a href="#cb15-48" aria-hidden="true" tabindex="-1"></a>summary.to_csv(output_export, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb15-49"><a href="#cb15-49" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Summary exported to </span><span class="sc">{</span>output_export<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div>
</details><p>Download the generated output file to <code>/data</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">downloaded_path</span> <span class="op">&lt;-</span> <span class="va">anthropic</span><span class="op">$</span><span class="fu">download_generated_files</span><span class="op">(</span>dest_path <span class="op">=</span> <span class="st">"data"</span><span class="op">)</span></span>
<span><span class="co">#&gt; ✔ [Anthropic] File downloaded to: data/body_mass_summary.csv</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="va">downloaded_path</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="sourceCode" id="cb18"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>     species    sex year average_body_mass</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>1     Adelie female 2007           3389.77</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>2     Adelie   male 2007           4038.64</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>3     Adelie female 2008           3386.00</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>4     Adelie   male 2008           4098.00</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>5     Adelie female 2009           3334.62</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>6     Adelie   male 2009           3995.19</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>7  Chinstrap female 2007           3569.23</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>8  Chinstrap   male 2007           3819.23</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>9  Chinstrap female 2008           3472.22</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>10 Chinstrap   male 2008           4127.78</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>11 Chinstrap female 2009           3522.92</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>12 Chinstrap   male 2009           3927.08</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>13    Gentoo female 2007           4618.75</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>14    Gentoo   male 2007           5552.94</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>15    Gentoo female 2008           4627.27</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>16    Gentoo   male 2008           5410.87</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>17    Gentoo female 2009           4786.25</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>18    Gentoo   male 2009           5510.71</span></code></pre></div>
<p>Continue asking questions in the same context:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguin_output_schema</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tool_definitions.html">schema</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"penguin_output"</span>,</span>
<span>    description <span class="op">=</span> <span class="st">"Schema for the penguin output"</span>,</span>
<span>    average_body_mass <span class="op">=</span> <span class="st">"number* The average body_mass"</span>,</span>
<span>    species <span class="op">=</span> <span class="st">"string* The species"</span>,</span>
<span>    sex <span class="op">=</span> <span class="st">"string* The sex"</span>,</span>
<span>    year <span class="op">=</span> <span class="st">"integer* The year"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">anthropic</span><span class="op">$</span><span class="fu">chat</span><span class="op">(</span></span>
<span>    <span class="st">"What's the average body_mass for the Adelie females in 2009?"</span>,</span>
<span>    tools <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"code_execution"</span><span class="op">)</span>,</span>
<span>    output_schema <span class="op">=</span> <span class="va">penguin_output_schema</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="sourceCode" id="cb20"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>$species</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>[1] "Adelie"</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>$sex</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>[1] "female"</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>$year</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>[1] 2009</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>$average_body_mass</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>[1] 3334.62</span></code></pre></div>
<p>Cleanup:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">anthropic</span><span class="op">$</span><span class="fu">delete_file</span><span class="op">(</span><span class="va">penguins_file</span><span class="op">$</span><span class="va">id</span><span class="op">)</span></span></code></pre></div>
</div>
</section></section><section class="section level2"><h2 id="multimodal-inputs">Multimodal Inputs<a class="anchor" aria-label="anchor" href="#multimodal-inputs"></a>
</h2>
<p>Anthropic Claude supports sending:</p>
<ul>
<li>PDFs: URLs (as-is, base64, or text content), files (base64, or text content)</li>
<li>Images: URLs (as-is, or base64), files (base64)</li>
<li>Remote files (through <code><a href="../reference/content_converters.html">as_file_content()</a></code>)</li>
<li>Plain text &amp; code files</li>
<li>Text-based data files (csv, tsv, json, ..)</li>
<li>R objects</li>
</ul>
<section class="level2"><h3 id="image-comprehension">Image Comprehension<a class="anchor" aria-label="anchor" href="#image-comprehension"></a>
</h3>
<div class="cell">
<details class="code-fold"><summary>Downloading an example image</summary><div class="sourceCode cell-code" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bsg04_cast_image_url</span> <span class="op">&lt;-</span> <span class="st">"https://upload.wikimedia.org/wikipedia/en/1/1a/Battlestar_Galactica_%282004%29_cast.jpg"</span></span>
<span><span class="va">bsg04_cast_image_path</span> <span class="op">&lt;-</span> <span class="fu">download_temp_file</span><span class="op">(</span><span class="va">bsg04_cast_image_url</span><span class="op">)</span></span></code></pre></div>
</details>
</div>
<p><strong>Sending a local image:</strong></p>
<p>When providing a path to a local image, it will automatically be converted to base64 before being sent to the server.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">anthropic</span><span class="op">$</span><span class="fu">chat</span><span class="op">(</span></span>
<span>    <span class="st">"Who are the characters in this image, and what show is it from?"</span>,</span>
<span>    <span class="va">bsg04_cast_image_path</span>,</span>
<span>    model <span class="op">=</span> <span class="st">"claude-haiku-4-5-20251001"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<p><strong>Sending an image URL:</strong></p>
<div>
<blockquote>
<p><strong>Note</strong></p>
<p>Image URLs are sent as-is to Anthropic.</p>
<p>We could have used the <code>as_image_content(bsg04_cast_image_url)</code> helper to make sure the path/url is converted to base64, and, optionally, to resize the image before sending it.</p>
</blockquote>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">anthropic</span><span class="op">$</span><span class="fu">chat</span><span class="op">(</span></span>
<span>    <span class="st">"Who are the characters in this image, and what show is it from?"</span>,</span>
<span>    <span class="va">bsg04_cast_image_url</span>,</span>
<span>    model <span class="op">=</span> <span class="st">"claude-haiku-4-5-20251001"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="sourceCode" id="cb25"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>This is the cast from **Battlestar Galactica** (2004-2009), the science fiction series that rebooted the original 1978 show.</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>The main characters visible in this promotional image include:</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>- **Edward James Olmos** as Admiral William Adama</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>- **Mary McDonnell** as President Laura Roslin</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>- **Katee Sackhoff** as Kara "Starbuck" Thrace</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>- **Jamie Bamber** as Lee "Apollo" Adama</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>- **Tricia Helfer** as Number Six</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>- **James Callis** as Gaius Baltar</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>- **Grace Park** as Sharon "Athena" Agathon</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>The show follows the last surviving battleship and its fleet of civilian ships as they search for the mythical planet Earth while being hunted by robotic Cylons. It became known for its complex characters, political intrigue, and exploration of themes like identity, religion, and survival.</span></code></pre></div>
<p><em>So say we all!</em></p>
</section><section class="level2"><h3 id="pdf-comprehension">PDF Comprehension<a class="anchor" aria-label="anchor" href="#pdf-comprehension"></a>
</h3>
<div class="cell">
<details class="code-fold"><summary>Downloading an example PDF (my CV)</summary><div class="sourceCode cell-code" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_cv_url</span> <span class="op">&lt;-</span> <span class="st">"https://ma-riviere.com/res/cv.pdf"</span></span>
<span><span class="va">my_cv_pdf_path</span> <span class="op">&lt;-</span> <span class="fu">download_temp_file</span><span class="op">(</span><span class="va">my_cv_url</span><span class="op">)</span></span></code></pre></div>
</details>
</div>
<p><strong>Sending a local PDF:</strong></p>
<p>When providing the prompt a path to a local PDF, it will automatically be converted to base64 before being sent to the server.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">anthropic</span><span class="op">$</span><span class="fu">chat</span><span class="op">(</span></span>
<span>    <span class="st">"What's my favorite programming language?"</span>,</span>
<span>    <span class="va">my_cv_pdf_path</span>,</span>
<span>    model <span class="op">=</span> <span class="st">"claude-haiku-4-5-20251001"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="sourceCode" id="cb28"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>Based on your resume, your favorite programming language is **R**.</span></code></pre></div>
<p><em>Damn right!</em></p>
<p><strong>Sending PDF URLs:</strong></p>
<p>For Anthropic, by default, PDF URLs are sent as-is to the server.</p>
<p>However, we can use the <code><a href="../reference/content_converters.html">as_text_content()</a></code> helper to have <code><a href="https://docs.ropensci.org/pdftools//reference/pdf_render_page.html" class="external-link">pdftools::pdf_convert()</a></code> parse the PDFs and pass their text contents to the model instead.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">r6_pdf_url</span> <span class="op">&lt;-</span> <span class="st">"https://cran.r-project.org/web/packages/R6/R6.pdf"</span></span>
<span><span class="va">s7_pdf_url</span> <span class="op">&lt;-</span> <span class="st">"https://cran.r-project.org/web/packages/S7/S7.pdf"</span></span>
<span></span>
<span><span class="va">multimodal_prompt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="st">"Give a short summary of the pros and cons of the two class systems in the following PDFs:"</span>,</span>
<span>    <span class="fu"><a href="../reference/content_converters.html">as_text_content</a></span><span class="op">(</span><span class="va">r6_pdf_url</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="../reference/content_converters.html">as_text_content</a></span><span class="op">(</span><span class="va">s7_pdf_url</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">anthropic</span><span class="op">$</span><span class="fu">chat</span><span class="op">(</span><span class="op">!</span><span class="op">!</span><span class="op">!</span><span class="va">multimodal_prompt</span>, model <span class="op">=</span> <span class="st">"claude-sonnet-4-5-20250929"</span><span class="op">)</span></span></code></pre></div>
</div>
</section><section class="level2"><h3 id="sending-files">Sending files<a class="anchor" aria-label="anchor" href="#sending-files"></a>
</h3>
<p>We can also send files directly to the model.</p>
<p>Thanks to the <code><a href="../reference/content_converters.html">as_file_content()</a></code> helper, we can pass further options to the provider:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cv_metadata</span> <span class="op">&lt;-</span> <span class="va">anthropic</span><span class="op">$</span><span class="fu">upload_file</span><span class="op">(</span><span class="va">my_cv_url</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cv_file_ref</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/content_converters.html">as_file_content</a></span><span class="op">(</span></span>
<span>    <span class="va">cv_metadata</span><span class="op">$</span><span class="va">id</span>,</span>
<span>    .provider_options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        title <span class="op">=</span> <span class="st">"Some stuff I've done"</span>, </span>
<span>        context <span class="op">=</span> <span class="st">"The `argent` R package is not yet mentionned on it but will soon be."</span>, </span>
<span>        citations <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">anthropic</span><span class="op">$</span><span class="fu">chat</span><span class="op">(</span></span>
<span>    <span class="st">"What R packages or tools are mentionned in my 'some stuff I've done' document?"</span>,</span>
<span>    <span class="va">cv_file_ref</span>,</span>
<span>    model <span class="op">=</span> <span class="st">"claude-haiku-4-5-20251001"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">anthropic</span><span class="op">$</span><span class="fu">delete_file</span><span class="op">(</span><span class="va">cv_metadata</span><span class="op">$</span><span class="va">id</span><span class="op">)</span></span></code></pre></div>
</div>
</section></section><section class="section level2"><h2 id="prompt-caching">Prompt Caching<a class="anchor" aria-label="anchor" href="#prompt-caching"></a>
</h2>
<p>Anthropic supports prompt caching to reduce costs and latency for repeated context.</p>
<p>Enable caching with the <code>cache_prompt</code>, <code>cache_system</code>, and <code>cache_tools</code> parameters:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">multimodal_prompt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="st">"Give a 3 sentences summary of the advantages of S7 over R6"</span>,</span>
<span>    <span class="fu"><a href="../reference/content_converters.html">as_text_content</a></span><span class="op">(</span><span class="va">r6_pdf_url</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="../reference/content_converters.html">as_text_content</a></span><span class="op">(</span><span class="va">s7_pdf_url</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">anthropic</span><span class="op">$</span><span class="fu">chat</span><span class="op">(</span><span class="op">!</span><span class="op">!</span><span class="op">!</span><span class="va">multimodal_prompt</span>, model <span class="op">=</span> <span class="st">"claude-haiku-4-5-20251001"</span>, cache_prompt <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<p>We can check that the content was indeed cached:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/pluck.html" class="external-link">pluck</a></span><span class="op">(</span><span class="va">anthropic</span><span class="op">$</span><span class="fu">get_last_response</span><span class="op">(</span><span class="op">)</span>, <span class="st">"usage"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="sourceCode" id="cb33"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>$input_tokens</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>[1] 2</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>$cache_creation_input_tokens</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>[1] 19770</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>$cache_read_input_tokens</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>[1] 0</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>$cache_creation</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>$cache_creation$ephemeral_5m_input_tokens</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>[1] 19770</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>$cache_creation$ephemeral_1h_input_tokens</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>[1] 0</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>$output_tokens</span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>[1] 140</span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>$service_tier</span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>[1] "standard"</span></code></pre></div>
<div>
<blockquote>
<p><strong>Note</strong></p>
<p>Cached content is stored for 5 minutes and reused across requests, significantly reducing token costs for repeated context.</p>
<p>See <a href="https://docs.anthropic.com/en/docs/build-with-claude/prompt-caching" class="external-link">Anthropic’s prompt caching documentation</a> for more details.</p>
</blockquote>
</div>
</section><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config);
    }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script></main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://ma-riviere.com" class="external-link">Marc-Aurèle Rivière</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
