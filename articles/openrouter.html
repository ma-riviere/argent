<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>OpenRouter • argent</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="openrouter_files/libs/quarto-html/popper.min.js"></script><script src="openrouter_files/libs/quarto-html/tippy.umd.min.js"></script><link href="openrouter_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="openrouter_files/libs/quarto-html/light-border.css" rel="stylesheet">
<!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="OpenRouter">
<meta name="twitter:card" content="summary">
<meta name="twitter:creator" content="@mariviere1">
<meta name="twitter:site" content="@mariviere1">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">argent</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Unreleased version">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/argent.html">Get started</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-providers" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Providers</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-providers">
<li><a class="dropdown-item" href="../articles/google-gemini.html">Google Gemini</a></li>
    <li><a class="dropdown-item" href="../articles/anthropic.html">Anthropic</a></li>
    <li><a class="dropdown-item" href="../articles/openrouter.html">OpenRouter</a></li>
    <li><a class="dropdown-item" href="../articles/local-llm.html">Local LLM</a></li>
    <li><a class="dropdown-item" href="../articles/other-providers.html">Other Providers</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>OpenAI</h6></li>
    <li><a class="dropdown-item" href="../articles/openai-responses.html">Responses API</a></li>
    <li><a class="dropdown-item" href="../articles/openai-completions.html">Chat Completions API</a></li>
    <li><a class="dropdown-item" href="../articles/openai-assistants.html">Assistants API</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-advanced-use" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Advanced Use</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-advanced-use">
<li><a class="dropdown-item" href="../articles/usecase-rag.html">RAG Applications</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ma-riviere/argent/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-quarto">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>OpenRouter</h1>




      <small class="dont-index">Source: <a href="https://github.com/ma-riviere/argent/blob/main/vignettes/articles/openrouter.qmd" class="external-link"><code>vignettes/articles/openrouter.qmd</code></a></small>
      <div class="d-none name"><code></code></div>
    </div>






    <section class="section level2"><h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This article covers using the OpenRouter provider with argent. OpenRouter aggregates multiple LLM providers, offering routing capabilities, fallback options, and access to a wide variety of models.</p>
</section><section class="section level2"><h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">openrouter</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/OpenRouter.html">OpenRouter</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>api_key <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"OPENROUTER_API_KEY"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</section><section class="section level2"><h2 id="discovering-models-and-providers">Discovering Models and Providers<a class="anchor" aria-label="anchor" href="#discovering-models-and-providers"></a>
</h2>
<p><strong>Available Models</strong></p>
<p>OpenRouter provides access to hundreds of models from various providers:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">openrouter</span><span class="op">$</span><span class="fu">list_models</span><span class="op">(</span>supported_parameters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"tools"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>        <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">name</span>, <span class="st">"free"</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">context_length</span> <span class="op">&gt;</span> <span class="fl">100000</span> <span class="op">&amp;</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">input_modalities</span>, <span class="st">"image"</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">context_length</span>, <span class="va">architecture</span><span class="op">)</span></span></code></pre></div>
</div>
<p><strong>Available Providers</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">openrouter</span><span class="op">$</span><span class="fu">list_providers</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span></code></pre></div>
</div>
</section><section class="section level2"><h2 id="basic-completion">Basic Completion<a class="anchor" aria-label="anchor" href="#basic-completion"></a>
</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">openrouter</span><span class="op">$</span><span class="fu">chat</span><span class="op">(</span></span>
<span>    <span class="st">"What's the R programming language? Answer in three sentences."</span>,</span>
<span>    model <span class="op">=</span> <span class="st">"z-ai/glm-4.5-air:free"</span>,</span>
<span>    provider_options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>only <span class="op">=</span> <span class="st">"z-ai"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</section><section class="section level2"><h2 id="tool-calling-structured-output-thinking">Tool Calling + Structured Output + Thinking<a class="anchor" aria-label="anchor" href="#tool-calling-structured-output-thinking"></a>
</h2>
<p>First, define some web-related tools (search, crawl, fetch, and a general-use tool) bundled in a <code>web_tools</code> list:</p>
<details><summary>Web Tools Implementation</summary><p><strong>Search:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">web_search</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">query</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co">#' @description Search the web for information using Tavily API. Returns a JSON array of search results with titles, URLs, and content snippets. Use this when you need current information, facts, news, or any data not in your training data.</span></span>
<span>    <span class="co">#' @param query:string* The search query string. Be specific and use keywords that will yield the most relevant results.</span></span>
<span>    </span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu">web_search_tavily</span><span class="op">(</span><span class="va">query</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">web_search_tavily</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">query</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">httr2</span><span class="fu">::</span><span class="fu"><a href="https://httr2.r-lib.org/reference/request.html" class="external-link">request</a></span><span class="op">(</span><span class="st">"https://api.tavily.com/search"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>        <span class="fu">httr2</span><span class="fu">::</span><span class="fu"><a href="https://httr2.r-lib.org/reference/req_body.html" class="external-link">req_body_json</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>            query <span class="op">=</span> <span class="va">query</span>,</span>
<span>            search_depth <span class="op">=</span> <span class="st">"basic"</span>,</span>
<span>            include_answer <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>            max_results <span class="op">=</span> <span class="fl">10</span>,</span>
<span>            api_key <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"TAVILY_API_KEY"</span><span class="op">)</span></span>
<span>        <span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>        <span class="fu">httr2</span><span class="fu">::</span><span class="fu"><a href="https://httr2.r-lib.org/reference/req_error.html" class="external-link">req_error</a></span><span class="op">(</span>is_error <span class="op">=</span> \<span class="op">(</span><span class="va">resp</span><span class="op">)</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>        <span class="fu">httr2</span><span class="fu">::</span><span class="fu"><a href="https://httr2.r-lib.org/reference/req_throttle.html" class="external-link">req_throttle</a></span><span class="op">(</span>rate <span class="op">=</span> <span class="fl">20</span><span class="op">/</span><span class="fl">60</span>, realm <span class="op">=</span> <span class="st">"tavily"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>        <span class="fu">httr2</span><span class="fu">::</span><span class="fu"><a href="https://httr2.r-lib.org/reference/req_perform.html" class="external-link">req_perform</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>        <span class="fu">httr2</span><span class="fu">::</span><span class="fu"><a href="https://httr2.r-lib.org/reference/resp_body_raw.html" class="external-link">resp_body_json</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>        <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/keep_at.html" class="external-link">discard_at</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"response_time"</span>, <span class="st">"follow_up_questions"</span>, <span class="st">"images"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">results</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">results</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/keep_at.html" class="external-link">discard_at</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"raw_content"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu">jsonlite</span><span class="fu">::</span><span class="fu"><a href="https://jeroen.r-universe.dev/jsonlite/reference/fromJSON.html" class="external-link">toJSON</a></span><span class="op">(</span><span class="va">results</span>, pretty <span class="op">=</span> <span class="cn">FALSE</span>, auto_unbox <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<p><strong>Fetch:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">web_fetch</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">url</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co">#' @description Fetch and extract the main text content from a web page as clean markdown. Returns the page content with formatting preserved, stripped of navigation, ads, and boilerplate. Use this to read articles, documentation, blog posts, or any web page content. Automatically falls back to alternative methods if the primary fetch fails.</span></span>
<span>    <span class="co">#' @param url:string* The complete URL of the web page to fetch (e.g., "https://example.com/article"). Must be a valid HTTP/HTTPS URL.</span></span>
<span>    </span>
<span>    <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">web_fetch_trafilatura</span><span class="op">(</span><span class="va">url</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">could_not_fetch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>        <span class="st">"Impossible to fetch the contents of this web page"</span>,</span>
<span>        <span class="st">"Please reload this page"</span>,</span>
<span>        <span class="st">"There was an error while loading"</span>,</span>
<span>        <span class="st">"404"</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span> <span class="op">||</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span> <span class="op">||</span> <span class="fu"><a href="https://rdrr.io/r/base/nchar.html" class="external-link">nchar</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">||</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">res</span>, <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/modifiers.html" class="external-link">fixed</a></span><span class="op">(</span><span class="va">could_not_fetch</span>, ignore_case <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">web_fetch_rvest</span><span class="op">(</span><span class="va">url</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">web_fetch_trafilatura</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">url</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># pip install trafilatura</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span><span class="op">{</span></span>
<span>        <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"trafilatura -u "</span>, <span class="va">url</span>, <span class="st">" --markdown --no-comments --links "</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/system.html" class="external-link">system</a></span><span class="op">(</span>intern <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>            <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/keep.html" class="external-link">keep</a></span><span class="op">(</span><span class="va">nzchar</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span>collapse <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span></span>
<span>        </span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span>
<span>    <span class="op">}</span>,</span>
<span>    error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="st">"Impossible to fetch the contents of this web page. It might not allow scraping"</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">web_fetch_rvest</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">url</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">tags_to_ignore</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>        <span class="st">"a"</span>, <span class="st">"script"</span>, <span class="st">"code"</span>, <span class="st">"img"</span>, <span class="st">"svg"</span>, <span class="st">"footer"</span>, <span class="st">"g"</span>, <span class="st">"path"</span>, <span class="st">"polygon"</span>, <span class="st">"label"</span>, <span class="st">"button"</span>, <span class="st">"form"</span>, <span class="st">"input"</span>, <span class="st">"select"</span>, </span>
<span>        <span class="st">"style"</span>, <span class="st">"link"</span>, <span class="st">"meta"</span>, <span class="st">"noscript"</span>, <span class="st">"iframe"</span>, <span class="st">"embed"</span>, <span class="st">"object"</span>, <span class="st">"param"</span>, <span class="st">"video"</span>, <span class="st">"audio"</span>, <span class="st">"track"</span>, <span class="st">"source"</span>, </span>
<span>        <span class="st">"canvas"</span>, <span class="st">"map"</span>, <span class="st">"area"</span>, <span class="st">"math"</span>, <span class="st">"col"</span>, <span class="st">"colgroup"</span>, <span class="st">"dl"</span>, <span class="st">"dt"</span>, <span class="st">"dd"</span>, <span class="st">"hr"</span>, <span class="st">"pre"</span>, <span class="st">"address"</span>, <span class="st">"figure"</span>, <span class="st">"figcaption"</span>,</span>
<span>        <span class="st">"dfn"</span>, <span class="st">"em"</span>, <span class="st">"kbd"</span>, <span class="st">"samp"</span>, <span class="st">"var"</span>, <span class="st">"del"</span>, <span class="st">"ins"</span>, <span class="st">"mark"</span>, <span class="st">"circle"</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span>    <span class="va">remove_tags</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">xml</span>, <span class="va">tags</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">walk</a></span><span class="op">(</span><span class="va">tags</span>, \<span class="op">(</span><span class="va">tag</span><span class="op">)</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">walk</a></span><span class="op">(</span><span class="fu">xml2</span><span class="fu">::</span><span class="fu"><a href="http://xml2.r-lib.org/reference/xml_find_all.html" class="external-link">xml_find_all</a></span><span class="op">(</span><span class="va">xml</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">".//"</span>, <span class="va">tag</span><span class="op">)</span><span class="op">)</span>, \<span class="op">(</span><span class="va">node</span><span class="op">)</span> <span class="fu">xml2</span><span class="fu">::</span><span class="fu"><a href="http://xml2.r-lib.org/reference/xml_replace.html" class="external-link">xml_remove</a></span><span class="op">(</span><span class="va">node</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">xml</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span></span>
<span>    <span class="va">cleaned_contents</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span></span>
<span>        <span class="fu">rvest</span><span class="fu">::</span><span class="fu"><a href="http://xml2.r-lib.org/reference/read_xml.html" class="external-link">read_html</a></span><span class="op">(</span><span class="va">url</span><span class="op">)</span></span>
<span>        <span class="op">|&gt;</span> <span class="fu">rvest</span><span class="fu">::</span><span class="fu"><a href="https://rvest.tidyverse.org/reference/html_element.html" class="external-link">html_element</a></span><span class="op">(</span><span class="st">"body"</span><span class="op">)</span></span>
<span>        <span class="op">|&gt;</span> <span class="fu">remove_tags</span><span class="op">(</span><span class="va">tags_to_ignore</span><span class="op">)</span></span>
<span>        <span class="op">|&gt;</span> <span class="fu">rvest</span><span class="fu">::</span><span class="fu"><a href="https://rvest.tidyverse.org/reference/html_children.html" class="external-link">html_children</a></span><span class="op">(</span><span class="op">)</span></span>
<span>        <span class="op">|&gt;</span> <span class="fu">rvest</span><span class="fu">::</span><span class="fu"><a href="https://rvest.tidyverse.org/reference/html_text.html" class="external-link">html_text2</a></span><span class="op">(</span><span class="op">)</span></span>
<span>        <span class="op">|&gt;</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/keep.html" class="external-link">discard</a></span><span class="op">(</span>\<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span> <span class="op">==</span> <span class="st">""</span><span class="op">)</span></span>
<span>        <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span>collapse <span class="op">=</span> <span class="st">"\n\n"</span><span class="op">)</span>,</span>
<span>        error <span class="op">=</span> \<span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">cleaned_contents</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
</details><p>Then, let’s define a JSON schema for the structured output using <code><a href="../reference/tool_definitions.html">schema()</a></code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">package_info_schema</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tool_definitions.html">schema</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"package_info"</span>,</span>
<span>    description <span class="op">=</span> <span class="st">"Information about an R package release"</span>,</span>
<span>    release_version <span class="op">=</span> <span class="st">"string* The release version of the package"</span>,</span>
<span>    release_date <span class="op">=</span> <span class="st">"string* The release date of the `release_version`"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<p>Then, run the agent:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">openrouter</span><span class="op">$</span><span class="fu">chat</span><span class="op">(</span></span>
<span>    <span class="st">"When was the first release of the R 'ellmer' package on GitHub?"</span>,</span>
<span>    model <span class="op">=</span> <span class="st">"z-ai/glm-4.5-air:free"</span>,</span>
<span>    provider_options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>only <span class="op">=</span> <span class="st">"z-ai"</span><span class="op">)</span>,</span>
<span>    thinking_budget <span class="op">=</span> <span class="fl">512</span>,</span>
<span>    tools <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="../reference/tool_definitions.html">as_tool</a></span><span class="op">(</span><span class="va">web_search</span><span class="op">)</span>, <span class="fu"><a href="../reference/tool_definitions.html">as_tool</a></span><span class="op">(</span><span class="va">web_fetch</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    output_schema <span class="op">=</span> <span class="va">package_info_schema</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="sourceCode" id="cb9"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>$release_version</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>[1] "0.1.0"</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>$release_date</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>[1] "January 9, 2025"</span></code></pre></div>
<div>
<blockquote>
<p><strong>Note</strong></p>
<p>Structured output works on ANY model that supports tool calling, even if they don’t support structured outputs or response formats natively. <code>argent</code> handles this through a “forced tool call” mechanism.</p>
</blockquote>
</div>
<section class="level2"><h3 id="extracting-reasoning">Extracting Reasoning<a class="anchor" aria-label="anchor" href="#extracting-reasoning"></a>
</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">openrouter</span><span class="op">$</span><span class="fu">get_reasoning_text</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<p>Alternatively, simply <code>print(openrouter)</code> to see the reasoning and answers’ text in the console, turn by turn.</p>
<div>
<blockquote>
<p><strong>Note</strong></p>
<p><code>get_reasoning_text()</code> and <code>get_content_text()</code> use the last API response (<code>openrouter$get_last_response()</code>) by default.</p>
</blockquote>
</div>
</section></section><section class="section level2"><h2 id="server-side-tools">Server-side Tools<a class="anchor" aria-label="anchor" href="#server-side-tools"></a>
</h2>
<p>Server-side tools are tools you can call without having to define them yourself. They will be run on the provider’s server.</p>
<p>OpenRouter only supports one server-side tool:</p>
<ul>
<li>
<strong>web_search</strong> - Web search capabilities</li>
</ul>
<section class="level2"><h3 id="web-search">Web Search<a class="anchor" aria-label="anchor" href="#web-search"></a>
</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">openrouter</span><span class="op">$</span><span class="fu">chat</span><span class="op">(</span></span>
<span>    <span class="st">"When was the last version of the R 'ragnar' package released on GitHub?"</span>,</span>
<span>    model <span class="op">=</span> <span class="st">"minimax/minimax-m2:free"</span>,</span>
<span>    provider_options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>only <span class="op">=</span> <span class="st">"minimax"</span><span class="op">)</span>,</span>
<span>    tools <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"web_search"</span>, engine <span class="op">=</span> <span class="st">"exa"</span>, max_results <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    output_schema <span class="op">=</span> <span class="va">package_info_schema</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<p>Supported search engines: - <code>"exa"</code> - High-quality semantic search - <code>"tavily"</code> - Fast general search - <code>"searchapi"</code> - Google-powered search</p>
<div>
<blockquote>
<p><strong>Note</strong></p>
<p>You can simply use <code>tools = list("web_search")</code>, which will set the engine to the default (<code>native</code> with fallback to <code>exa</code>), and the max results to 5.</p>
</blockquote>
</div>
</section></section><section class="section level2"><h2 id="multimodal-inputs">Multimodal Inputs<a class="anchor" aria-label="anchor" href="#multimodal-inputs"></a>
</h2>
<p>OpenRouter supports sending:</p>
<ul>
<li>Images (files or URLs) as base64</li>
<li>PDF files as base64, and URLs as-is (with configurable server-side parser engines: <code>as_pdf_content("pdf_url", .provider_options = list(pdf_parser = c("pdf-text", "mistral-ocr", "native"))))</code>)</li>
<li>Text/code files</li>
<li>Text-based data files (csv, tsv, json, ..)</li>
<li>R objects</li>
</ul>
<section class="level2"><h3 id="image-comprehension">Image Comprehension<a class="anchor" aria-label="anchor" href="#image-comprehension"></a>
</h3>
<div class="cell">
<details class="code-fold"><summary>Downloading an example image</summary><div class="sourceCode cell-code" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bsg04_cast_image_url</span> <span class="op">&lt;-</span> <span class="st">"https://upload.wikimedia.org/wikipedia/en/1/1a/Battlestar_Galactica_%282004%29_cast.jpg"</span></span>
<span><span class="va">bsg04_cast_image_path</span> <span class="op">&lt;-</span> <span class="fu">download_temp_file</span><span class="op">(</span><span class="va">bsg04_cast_image_url</span><span class="op">)</span></span></code></pre></div>
</details>
</div>
<p><strong>Sending a local image:</strong></p>
<p>When providing a path to a local image, it will automatically be converted to base64 before being sent to the server.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">openrouter</span><span class="op">$</span><span class="fu">chat</span><span class="op">(</span></span>
<span>    <span class="st">"Who are the characters in this image, and what show is it from?"</span>,</span>
<span>    <span class="va">bsg04_cast_image_path</span>,</span>
<span>    model <span class="op">=</span> <span class="st">"mistralai/mistral-small-3.2-24b-instruct:free"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="sourceCode" id="cb14"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>The image you provided is from the TV show "Battlestar Galactica". The characters in the image are:</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>1. Edward James Olmos as William Adama</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>2. Mary McDonnell as Laura Roslin</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>3. Jamie Bamber as Lee "Apollo" Adama</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>4. Katee Sackhoff as Kara "Starbuck" Thrace</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>5. Tricia Helfer as Number Six</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>6. James Callis as Gaius Baltar</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>7. Grace Park as Sharon "Boomer" Valerii</span></code></pre></div>
<p><em>So say we all!</em></p>
<p><strong>Sending an image URL:</strong></p>
<p>OpenRouter supports sending image URLs directly:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">openrouter</span><span class="op">$</span><span class="fu">chat</span><span class="op">(</span></span>
<span>    <span class="st">"Who are the characters in this image, and what show is it from?"</span>,</span>
<span>    <span class="va">bsg04_cast_image_url</span>,</span>
<span>    model <span class="op">=</span> <span class="st">"mistralai/mistral-small-3.2-24b-instruct:free"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div>
<blockquote>
<p><strong>Tip</strong></p>
<p>Using <code><a href="../reference/content_converters.html">as_image_content()</a></code> or <code><a href="../reference/content_converters.html">as_text_content()</a></code> will force the URL to be downloaded and the image to be converted to base64. Furthermore, <code><a href="../reference/content_converters.html">as_image_content()</a></code> has a <code>.resize</code> parameter to control the image size.</p>
</blockquote>
</div>
</section><section class="level2"><h3 id="pdf-comprehension">PDF Comprehension<a class="anchor" aria-label="anchor" href="#pdf-comprehension"></a>
</h3>
<div class="cell">
<details class="code-fold"><summary>Downloading an example PDF (my CV)</summary><div class="sourceCode cell-code" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_cv_url</span> <span class="op">&lt;-</span> <span class="st">"https://ma-riviere.com/res/cv.pdf"</span></span>
<span><span class="va">my_cv_pdf_path</span> <span class="op">&lt;-</span> <span class="fu">download_temp_file</span><span class="op">(</span><span class="va">my_cv_url</span><span class="op">)</span></span></code></pre></div>
</details>
</div>
<p><strong>Sending a local PDF:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">openrouter</span><span class="op">$</span><span class="fu">chat</span><span class="op">(</span></span>
<span>    <span class="st">"What's my favorite programming language?"</span>,</span>
<span>    <span class="va">my_cv_pdf_path</span>,</span>
<span>    model <span class="op">=</span> <span class="st">"z-ai/glm-4.5-air:free"</span>,</span>
<span>    provider_options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>only <span class="op">=</span> <span class="st">"z-ai"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="sourceCode" id="cb18"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>Based on the document you provided, it appears that R is your favorite programming language.</span></code></pre></div>
<p><em>Damn right!</em></p>
<div>
<blockquote>
<p><strong>Note</strong></p>
<p>When sending a PDF (local or URL) to OpenRouter, you can optionally specify the parser engine the server will use to parse the PDF’s contents via the <code>.provider_options</code> parameter of <code><a href="../reference/content_converters.html">as_pdf_content()</a></code>. If not specidfied (or if not using <code><a href="../reference/content_converters.html">as_pdf_content()</a></code>), it will be set to <code>"pdf-text"</code> by default, which is free. The possible values are: <code>"pdf-text"</code>, <code>"mistral-ocr"</code>, <code>"native"</code>. See OpenRouter <a href="https://openrouter.ai/docs/features/multimodal/pdfs" class="external-link">documentation</a> for more details.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">openrouter</span><span class="op">$</span><span class="fu">chat</span><span class="op">(</span></span>
<span>    <span class="st">"What's my favorite programming language?"</span>,</span>
<span>    <span class="fu"><a href="../reference/content_converters.html">as_pdf_content</a></span><span class="op">(</span><span class="va">my_cv_url</span>, .provider_options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>pdf_parser <span class="op">=</span> <span class="st">"mistral-ocr"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    model <span class="op">=</span> <span class="st">"anthropic/claude-sonnet-4"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<p>Of course, we could parse the PDF’s contents before sending them as text. <code><a href="../reference/content_converters.html">as_text_content()</a></code> does this using <code><a href="https://docs.ropensci.org/pdftools//reference/pdf_render_page.html" class="external-link">pdftools::pdf_convert()</a></code>. Or we could have implemented our own OCR solution, e.g. using a <code>local_llm</code> instance with a VL model like <em>Qwen3-8B-VL-instruct</em>.</p>
</blockquote>
</div>
<p><strong>Sending PDF URLs:</strong></p>
<p>For OpenRouter, by default, PDF URLs are sent as-is to the server.</p>
<p>However, we can use the <code><a href="../reference/content_converters.html">as_text_content()</a></code> helper to have <code><a href="https://docs.ropensci.org/pdftools//reference/pdf_render_page.html" class="external-link">pdftools::pdf_convert()</a></code> parse the PDFs and pass their text contents to the model instead.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">r6_pdf_url</span> <span class="op">&lt;-</span> <span class="st">"https://cran.r-project.org/web/packages/R6/R6.pdf"</span></span>
<span><span class="va">s7_pdf_url</span> <span class="op">&lt;-</span> <span class="st">"https://cran.r-project.org/web/packages/S7/S7.pdf"</span></span>
<span></span>
<span><span class="va">multimodal_prompt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="st">"Give a 3 sentences summary of the advantages of S7 over R6"</span>,</span>
<span>    <span class="fu"><a href="../reference/content_converters.html">as_text_content</a></span><span class="op">(</span><span class="va">r6_pdf_url</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="../reference/content_converters.html">as_text_content</a></span><span class="op">(</span><span class="va">s7_pdf_url</span><span class="op">)</span>,</span>
<span>    <span class="st">"And give me the current versions of both packages"</span> <span class="co"># To make sure you actually read the PDFs</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">openrouter</span><span class="op">$</span><span class="fu">chat</span><span class="op">(</span><span class="op">!</span><span class="op">!</span><span class="op">!</span><span class="va">multimodal_prompt</span>, model <span class="op">=</span> <span class="st">"z-ai/glm-4.5-air:free"</span>, provider_options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>only <span class="op">=</span> <span class="st">"z-ai"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="sourceCode" id="cb21"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>Based on the documentation provided, here's a 3-sentence summary of the advantages of S7 over R6:</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>S7 provides a more formal and comprehensive object-oriented system with complete class, generic, and method specification capabilities, including multiple dispatch, which is more limited in R6. Unlike R6, S7 is designed as a successor to S3 and S4 systems with better integration into R's existing object-oriented framework and offers superior tools for method introspection through functions like method_explain(). The S7 system has been collaboratively developed by the R Consortium's Object-Oriented Programming Working Group, representing a more standardized future direction for object-oriented programming in R.</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>The current versions of both packages are:</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>- R6: Version 2.6.1 (published 2025-02-15)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>- S7: Version 0.2.0 (published 2024-11-07)</span></code></pre></div>
</section><section class="level2"><h3 id="passing-r-objects">Passing R Objects<a class="anchor" aria-label="anchor" href="#passing-r-objects"></a>
</h3>
<p>You can pass any R object to <code>chat()</code> as is:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lm_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">body_mass</span> <span class="op">~</span> <span class="va">species</span> <span class="op">+</span> <span class="va">sex</span>, data <span class="op">=</span> <span class="fu">datasets</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/r/datasets/penguins.html" class="external-link">penguins</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">openrouter</span><span class="op">$</span><span class="fu">chat</span><span class="op">(</span></span>
<span>    <span class="st">"What can we deduct from this regression model?"</span>,</span>
<span>    <span class="va">lm_obj</span>,</span>
<span>    model <span class="op">=</span> <span class="st">"z-ai/glm-4.5-air:free"</span>,</span>
<span>    provider_options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>only <span class="op">=</span> <span class="st">"z-ai"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="sourceCode" id="cb23"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>From analyzing this regression model, I can deduct the following 3 key points:</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>1. **Species significantly affects body mass**: The coefficients show that Gentoo penguins have substantially higher body mass (+1377.9 units) compared to Adelie penguins (the reference category), while Chinstrap penguins have only slightly higher body mass (+26.9 units) compared to Adelie penguins. This suggests a large biological difference in body mass between species, with Gentoo penguins being the heaviest.</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>2. **Sex has a notable impact on body mass**: The coefficient for sexmale (+667.6 units) indicates that male penguins have significantly higher body mass than female penguins, regardless of species. This difference is substantial but smaller than the difference between the heaviest (Gentoo) and lightest (Adelie) species.</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>3. **The model uses data from 333 penguins** with measurements on body mass grouped by 3 species (Adelie, Chinstrap, Gentoo) and 2 sexes (female, male). The model has 4 parameters total (intercept + species contrasts + sex contrast) and 329 degrees of freedom for residuals, suggesting this is a reasonably sized dataset for these predictors.</span></code></pre></div>
<div>
<blockquote>
<p><strong>Note</strong></p>
<p>Any R object passed to <code>chat()</code> will be automatically converted to JSON (or text if JSON conversion fails), with some added information like the name of the object and its classes.</p>
</blockquote>
</div>
</section><section class="level2"><h3 id="file-references">File References<a class="anchor" aria-label="anchor" href="#file-references"></a>
</h3>
<div>
<blockquote>
<p><strong>Warning</strong></p>
<p>Remote file references via <code><a href="../reference/content_converters.html">as_file_content()</a></code> are not supported with OpenRouter. Use local file paths or URLs instead.</p>
</blockquote>
</div>
</section></section><section class="section level2"><h2 id="routing">Routing<a class="anchor" aria-label="anchor" href="#routing"></a>
</h2>
<section class="level2"><h3 id="automatic-routing">Automatic Routing<a class="anchor" aria-label="anchor" href="#automatic-routing"></a>
</h3>
<p>If no model is specified, <code>argent</code> will automatically use the <code>"openrouter/auto"</code> model router, which will route the request to the best provider for the given request.</p>
</section><section class="level2"><h3 id="fallback-models">Fallback Models<a class="anchor" aria-label="anchor" href="#fallback-models"></a>
</h3>
<p>You can specify multiple models to use, and the first one that succeeds will be used.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">openrouter</span><span class="op">$</span><span class="fu">chat</span><span class="op">(</span></span>
<span>    <span class="st">"What's the R programming language? Answer in three sentences."</span>,</span>
<span>    model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"deepseek/deepseek-chat-v3-0324:free"</span>, <span class="st">"minimax/minimax-m2:free"</span><span class="op">)</span>,</span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</section><section class="level2"><h3 id="provider-routing">Provider Routing<a class="anchor" aria-label="anchor" href="#provider-routing"></a>
</h3>
<p>OpenRouter provides powerful provider routing capabilities through the <code>provider_options</code> parameter. See the <a href="https://openrouter.ai/docs/features/provider-routing" class="external-link">OpenRouter documentation</a> for full details.</p>
<section class="level3"><h4 id="basic-provider-control">Basic Provider Control<a class="anchor" aria-label="anchor" href="#basic-provider-control"></a>
</h4>
<p>Control which providers are used and in what order:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">openrouter</span><span class="op">$</span><span class="fu">chat</span><span class="op">(</span></span>
<span>    prompt <span class="op">=</span> <span class="st">"Your question here"</span>,</span>
<span>    model <span class="op">=</span> <span class="st">"z-ai/glm-4.5-air:free"</span>,</span>
<span>    provider_options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        only <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"z-ai"</span>, <span class="st">"atlas-cloud/fp8"</span><span class="op">)</span>,    <span class="co"># Only use these providers</span></span>
<span>        ignore <span class="op">=</span> <span class="st">"chutes/bf16"</span>,                 <span class="co"># Never use this provider</span></span>
<span>        order <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"z-ai"</span>, <span class="st">"atlas-cloud/fp8"</span><span class="op">)</span>    <span class="co"># Try in this order</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</section><section class="level3"><h4 id="advanced-routing-options">Advanced Routing Options<a class="anchor" aria-label="anchor" href="#advanced-routing-options"></a>
</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">openrouter</span><span class="op">$</span><span class="fu">chat</span><span class="op">(</span></span>
<span>    prompt <span class="op">=</span> <span class="st">"Your question here"</span>,</span>
<span>    model <span class="op">=</span> <span class="st">"anthropic/claude-3.5-sonnet"</span>,</span>
<span>    provider_options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        allow_fallbacks <span class="op">=</span> <span class="cn">TRUE</span>,                 <span class="co"># Allow backup providers</span></span>
<span>        require_parameters <span class="op">=</span> <span class="cn">TRUE</span>,              <span class="co"># Only use providers supporting all parameters</span></span>
<span>        data_collection <span class="op">=</span> <span class="st">"deny"</span>,               <span class="co"># Prevent provider data storage</span></span>
<span>        zdr <span class="op">=</span> <span class="cn">TRUE</span>,                             <span class="co"># Only use Zero Data Retention endpoints</span></span>
<span>        quantizations <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"int4"</span>, <span class="st">"int8"</span><span class="op">)</span>,      <span class="co"># Filter by quantization levels</span></span>
<span>        sort <span class="op">=</span> <span class="st">"price"</span>,                         <span class="co"># Sort providers by price or throughput</span></span>
<span>        max_price <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>                       <span class="co"># Set maximum pricing</span></span>
<span>            prompt <span class="op">=</span> <span class="fl">0.001</span>,</span>
<span>            completion <span class="op">=</span> <span class="fl">0.002</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</section></section></section><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config);
    }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script></main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://ma-riviere.com" class="external-link">Marc-Aurèle Rivière</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
