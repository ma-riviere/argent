<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Google (Gemini) • argent</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="google-gemini_files/libs/quarto-html/popper.min.js"></script><script src="google-gemini_files/libs/quarto-html/tippy.umd.min.js"></script><link href="google-gemini_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="google-gemini_files/libs/quarto-html/light-border.css" rel="stylesheet">
<!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Google (Gemini)">
<meta property="og:image" content="https://ma-riviere.github.io/argent/reference/figures/logo.png">
<meta property="og:image:alt" content="Creating AI Agents in R">
<meta name="twitter:card" content="summary">
<meta name="twitter:creator" content="@mariviere1">
<meta name="twitter:site" content="@mariviere1">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">argent</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Unreleased version">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/argent.html">Get started</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-providers" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Providers</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-providers">
<li><a class="dropdown-item" href="../articles/google-gemini.html">Google Gemini</a></li>
    <li><a class="dropdown-item" href="../articles/anthropic.html">Anthropic</a></li>
    <li><a class="dropdown-item" href="../articles/openrouter.html">OpenRouter</a></li>
    <li><a class="dropdown-item" href="../articles/local-llm.html">Local LLM</a></li>
    <li><a class="dropdown-item" href="../articles/other-providers.html">Other Providers</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>OpenAI</h6></li>
    <li><a class="dropdown-item" href="../articles/openai-responses.html">Responses API</a></li>
    <li><a class="dropdown-item" href="../articles/openai-completions.html">Chat Completions API</a></li>
    <li><a class="dropdown-item" href="../articles/openai-assistants.html">Assistants API</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-advanced-use" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Advanced Use</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-advanced-use">
<li><a class="dropdown-item" href="../articles/advanced-rag.html">RAG with `ragnar`</a></li>
    <li><a class="dropdown-item" href="../articles/advanced-mcp.html">Using MCP Servers</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ma-riviere/argent/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-quarto">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Google (Gemini)</h1>




      <small class="dont-index">Source: <a href="https://github.com/ma-riviere/argent/blob/main/vignettes/articles/google-gemini.qmd" class="external-link"><code>vignettes/articles/google-gemini.qmd</code></a></small>
      <div class="d-none name"><code></code></div>
    </div>






    <section class="section level2"><h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This article covers using the Google Gemini provider with argent. Google Gemini offers powerful multimodal capabilities, server-side tools, and extended thinking features.</p>
</section><section class="section level2"><h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">google_gemini</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Google.html">Google</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>api_key <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"GEMINI_API_KEY"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<p><strong>Available Models</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">google_gemini</span><span class="op">$</span><span class="fu">list_models</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">name</span>, <span class="st">"2.5-flash|2.5-pro|3-pro"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">description</span><span class="op">)</span></span></code></pre></div>
</div>
</section><section class="section level2"><h2 id="basic-completion">Basic Completion<a class="anchor" aria-label="anchor" href="#basic-completion"></a>
</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">google_gemini</span><span class="op">$</span><span class="fu">chat</span><span class="op">(</span></span>
<span>    <span class="st">"What's the R programming language? Answer in three sentences."</span>,</span>
<span>    model <span class="op">=</span> <span class="st">"gemini-2.5-flash"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</section><section class="section level2"><h2 id="tool-calling-structured-output-thinking">Tool Calling + Structured Output + Thinking<a class="anchor" aria-label="anchor" href="#tool-calling-structured-output-thinking"></a>
</h2>
<p>First, define some web-related tools (search, crawl, fetch, and a general-use tool) bundled in a <code>web_tools</code> list:</p>
<details><summary>Web Tools Implementation</summary><p><strong>Search:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">web_search</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">query</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co">#' @description Search the web for information using Tavily API. Returns a JSON array of search results with titles, URLs, and content snippets. Use this when you need current information, facts, news, or any data not in your training data.</span></span>
<span>    <span class="co">#' @param query:string* The search query string. Be specific and use keywords that will yield the most relevant results.</span></span>
<span>    </span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu">web_search_tavily</span><span class="op">(</span><span class="va">query</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">web_search_tavily</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">query</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">httr2</span><span class="fu">::</span><span class="fu"><a href="https://httr2.r-lib.org/reference/request.html" class="external-link">request</a></span><span class="op">(</span><span class="st">"https://api.tavily.com/search"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>        <span class="fu">httr2</span><span class="fu">::</span><span class="fu"><a href="https://httr2.r-lib.org/reference/req_body.html" class="external-link">req_body_json</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>            query <span class="op">=</span> <span class="va">query</span>,</span>
<span>            search_depth <span class="op">=</span> <span class="st">"basic"</span>,</span>
<span>            include_answer <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>            max_results <span class="op">=</span> <span class="fl">10</span>,</span>
<span>            api_key <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"TAVILY_API_KEY"</span><span class="op">)</span></span>
<span>        <span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>        <span class="fu">httr2</span><span class="fu">::</span><span class="fu"><a href="https://httr2.r-lib.org/reference/req_error.html" class="external-link">req_error</a></span><span class="op">(</span>is_error <span class="op">=</span> \<span class="op">(</span><span class="va">resp</span><span class="op">)</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>        <span class="fu">httr2</span><span class="fu">::</span><span class="fu"><a href="https://httr2.r-lib.org/reference/req_throttle.html" class="external-link">req_throttle</a></span><span class="op">(</span>rate <span class="op">=</span> <span class="fl">20</span><span class="op">/</span><span class="fl">60</span>, realm <span class="op">=</span> <span class="st">"tavily"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>        <span class="fu">httr2</span><span class="fu">::</span><span class="fu"><a href="https://httr2.r-lib.org/reference/req_perform.html" class="external-link">req_perform</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>        <span class="fu">httr2</span><span class="fu">::</span><span class="fu"><a href="https://httr2.r-lib.org/reference/resp_body_raw.html" class="external-link">resp_body_json</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>        <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/keep_at.html" class="external-link">discard_at</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"response_time"</span>, <span class="st">"follow_up_questions"</span>, <span class="st">"images"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">results</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">results</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/keep_at.html" class="external-link">discard_at</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"raw_content"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu">jsonlite</span><span class="fu">::</span><span class="fu"><a href="https://jeroen.r-universe.dev/jsonlite/reference/fromJSON.html" class="external-link">toJSON</a></span><span class="op">(</span><span class="va">results</span>, pretty <span class="op">=</span> <span class="cn">FALSE</span>, auto_unbox <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<p><strong>Fetch:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">web_fetch</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">url</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co">#' @description Fetch and extract the main text content from a web page as clean markdown. Returns the page content with formatting preserved, stripped of navigation, ads, and boilerplate. Use this to read articles, documentation, blog posts, or any web page content.</span></span>
<span>    <span class="co">#' @param url:string* The complete URL of the web page to fetch (e.g., "https://example.com/article"). Must be a valid HTTP/HTTPS URL.</span></span>
<span>    </span>
<span>    <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">web_fetch_trafilatura</span><span class="op">(</span><span class="va">url</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">could_not_fetch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>        <span class="st">"Impossible to fetch the contents of this web page"</span>,</span>
<span>        <span class="st">"Please reload this page"</span>,</span>
<span>        <span class="st">"There was an error while loading"</span>,</span>
<span>        <span class="st">"404"</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span> <span class="op">||</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span> <span class="op">||</span> <span class="fu"><a href="https://rdrr.io/r/base/nchar.html" class="external-link">nchar</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">||</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">res</span>, <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/modifiers.html" class="external-link">fixed</a></span><span class="op">(</span><span class="va">could_not_fetch</span>, ignore_case <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">web_fetch_rvest</span><span class="op">(</span><span class="va">url</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">web_fetch_trafilatura</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">url</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># pip install trafilatura</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span><span class="op">{</span></span>
<span>        <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"trafilatura -u "</span>, <span class="va">url</span>, <span class="st">" --markdown --no-comments --links "</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/system.html" class="external-link">system</a></span><span class="op">(</span>intern <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>            <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/keep.html" class="external-link">keep</a></span><span class="op">(</span><span class="va">nzchar</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span>collapse <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span></span>
<span>        </span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span>
<span>    <span class="op">}</span>,</span>
<span>    error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="st">"Impossible to fetch the contents of this web page. It might not allow scraping"</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">web_fetch_rvest</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">url</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">tags_to_ignore</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>        <span class="st">"a"</span>, <span class="st">"script"</span>, <span class="st">"code"</span>, <span class="st">"img"</span>, <span class="st">"svg"</span>, <span class="st">"footer"</span>, <span class="st">"g"</span>, <span class="st">"path"</span>, <span class="st">"polygon"</span>, <span class="st">"label"</span>, <span class="st">"button"</span>, <span class="st">"form"</span>, <span class="st">"input"</span>, <span class="st">"select"</span>, </span>
<span>        <span class="st">"style"</span>, <span class="st">"link"</span>, <span class="st">"meta"</span>, <span class="st">"noscript"</span>, <span class="st">"iframe"</span>, <span class="st">"embed"</span>, <span class="st">"object"</span>, <span class="st">"param"</span>, <span class="st">"video"</span>, <span class="st">"audio"</span>, <span class="st">"track"</span>, <span class="st">"source"</span>, </span>
<span>        <span class="st">"canvas"</span>, <span class="st">"map"</span>, <span class="st">"area"</span>, <span class="st">"math"</span>, <span class="st">"col"</span>, <span class="st">"colgroup"</span>, <span class="st">"dl"</span>, <span class="st">"dt"</span>, <span class="st">"dd"</span>, <span class="st">"hr"</span>, <span class="st">"pre"</span>, <span class="st">"address"</span>, <span class="st">"figure"</span>, <span class="st">"figcaption"</span>,</span>
<span>        <span class="st">"dfn"</span>, <span class="st">"em"</span>, <span class="st">"kbd"</span>, <span class="st">"samp"</span>, <span class="st">"var"</span>, <span class="st">"del"</span>, <span class="st">"ins"</span>, <span class="st">"mark"</span>, <span class="st">"circle"</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span>    <span class="va">remove_tags</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">xml</span>, <span class="va">tags</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">walk</a></span><span class="op">(</span><span class="va">tags</span>, \<span class="op">(</span><span class="va">tag</span><span class="op">)</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">walk</a></span><span class="op">(</span><span class="fu">xml2</span><span class="fu">::</span><span class="fu"><a href="http://xml2.r-lib.org/reference/xml_find_all.html" class="external-link">xml_find_all</a></span><span class="op">(</span><span class="va">xml</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">".//"</span>, <span class="va">tag</span><span class="op">)</span><span class="op">)</span>, \<span class="op">(</span><span class="va">node</span><span class="op">)</span> <span class="fu">xml2</span><span class="fu">::</span><span class="fu"><a href="http://xml2.r-lib.org/reference/xml_replace.html" class="external-link">xml_remove</a></span><span class="op">(</span><span class="va">node</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">xml</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span></span>
<span>    <span class="va">cleaned_contents</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span></span>
<span>        <span class="fu">rvest</span><span class="fu">::</span><span class="fu"><a href="http://xml2.r-lib.org/reference/read_xml.html" class="external-link">read_html</a></span><span class="op">(</span><span class="va">url</span><span class="op">)</span></span>
<span>        <span class="op">|&gt;</span> <span class="fu">rvest</span><span class="fu">::</span><span class="fu"><a href="https://rvest.tidyverse.org/reference/html_element.html" class="external-link">html_element</a></span><span class="op">(</span><span class="st">"body"</span><span class="op">)</span></span>
<span>        <span class="op">|&gt;</span> <span class="fu">remove_tags</span><span class="op">(</span><span class="va">tags_to_ignore</span><span class="op">)</span></span>
<span>        <span class="op">|&gt;</span> <span class="fu">rvest</span><span class="fu">::</span><span class="fu"><a href="https://rvest.tidyverse.org/reference/html_children.html" class="external-link">html_children</a></span><span class="op">(</span><span class="op">)</span></span>
<span>        <span class="op">|&gt;</span> <span class="fu">rvest</span><span class="fu">::</span><span class="fu"><a href="https://rvest.tidyverse.org/reference/html_text.html" class="external-link">html_text2</a></span><span class="op">(</span><span class="op">)</span></span>
<span>        <span class="op">|&gt;</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/keep.html" class="external-link">discard</a></span><span class="op">(</span>\<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span> <span class="op">==</span> <span class="st">""</span><span class="op">)</span></span>
<span>        <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span>collapse <span class="op">=</span> <span class="st">"\n\n"</span><span class="op">)</span>,</span>
<span>        error <span class="op">=</span> \<span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">cleaned_contents</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
</details><p>Then, let’s define a JSON schema for the structured output using <code><a href="../reference/tool_definitions.html">schema()</a></code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">package_info_schema</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tool_definitions.html">schema</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"package_info"</span>,</span>
<span>    description <span class="op">=</span> <span class="st">"Information about an R package release"</span>,</span>
<span>    release_version <span class="op">=</span> <span class="st">"string* The release version of the package"</span>,</span>
<span>    release_date <span class="op">=</span> <span class="st">"string* The release date of the `release_version`"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<p>Then, run the agent:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">google_gemini</span><span class="op">$</span><span class="fu">chat</span><span class="op">(</span></span>
<span>    <span class="st">"When was the first release of the R 'ellmer' package on GitHub?"</span>,</span>
<span>    model <span class="op">=</span> <span class="st">"gemini-2.5-flash"</span>,</span>
<span>    thinking_budget <span class="op">=</span> <span class="fl">512</span>,</span>
<span>    include_thoughts <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    tools <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="../reference/tool_definitions.html">as_tool</a></span><span class="op">(</span><span class="va">web_search</span><span class="op">)</span>, <span class="fu"><a href="../reference/tool_definitions.html">as_tool</a></span><span class="op">(</span><span class="va">web_fetch</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    output_schema <span class="op">=</span> <span class="va">package_info_schema</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="sourceCode" id="cb8"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>$release_version</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>[1] "0.1.0"</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>$release_date</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>[1] "2025-01-09"</span></code></pre></div>
<p>The model will keep calling tools until it has enough information to answer the question.</p>
<section class="level2"><h3 id="extracting-reasoning">Extracting Reasoning<a class="anchor" aria-label="anchor" href="#extracting-reasoning"></a>
</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">google_gemini</span><span class="op">$</span><span class="fu">get_reasoning_text</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<p>Alternatively, simply <code>print(google_gemini)</code> to see the reasoning and answers’ text in the console, turn by turn.</p>
<div>
<blockquote>
<p><strong>Note</strong></p>
<p><code>get_reasoning_text()</code> and <code>get_content_text()</code> use the last API response (<code>google_gemini$get_last_response()</code>) by default.</p>
</blockquote>
</div>
</section></section><section class="section level2"><h2 id="server-side-tools">Server-side Tools<a class="anchor" aria-label="anchor" href="#server-side-tools"></a>
</h2>
<p>Server-side tools are tools you can call without having to define them yourself. They will be run on the provider’s server.</p>
<p>Google Gemini supports five server-side tools that can be used alongside client-side tools:</p>
<ul>
<li>
<strong>google_search</strong> - Web search with grounding</li>
<li>
<strong>google_maps</strong> - Location-aware information with Google Maps data</li>
<li>
<strong>url_context</strong> - Fetch and process URLs</li>
<li>
<strong>code_execution</strong> - Execute Python code</li>
<li>
<strong>file_search</strong> - Search through uploaded files using vector stores (i.e. server-side RAG)</li>
</ul>
<section class="level2"><h3 id="server-side-google-search">Server-side: Google Search<a class="anchor" aria-label="anchor" href="#server-side-google-search"></a>
</h3>
<p>The server-side web search tool provides search results with citations:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">google_gemini</span><span class="op">$</span><span class="fu">chat</span><span class="op">(</span></span>
<span>    <span class="st">"What's the latest version of the R 'ellmer' package?"</span>,</span>
<span>    model <span class="op">=</span> <span class="st">"gemini-2.5-flash"</span>,</span>
<span>    tools <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"google_search"</span><span class="op">)</span>,</span>
<span>    output_schema <span class="op">=</span> <span class="va">package_info_schema</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<p><strong>Extract grounding metadata</strong> (citations and sources):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">google_gemini</span><span class="op">$</span><span class="fu">get_supplementary</span><span class="op">(</span><span class="op">)</span> <span class="co"># Defaults to the last response</span></span></code></pre></div>
</div>
<div>
<blockquote>
<p><strong>Note</strong></p>
<p>This server-side tool is equivalent to our client-side <code>web_search</code> tool.</p>
</blockquote>
</div>
</section><section class="level2"><h3 id="server-side-url-context">Server-side: URL Context<a class="anchor" aria-label="anchor" href="#server-side-url-context"></a>
</h3>
<p>This server tool lets the LLM fetch the contents of URLs given to it in the prompt. It supports fetching text (HTML, JSON, XML), images (PNG, JPEG, WebP), and PDFs.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">google_gemini</span><span class="op">$</span><span class="fu">chat</span><span class="op">(</span></span>
<span>    <span class="st">"Summarize the main changes in the current development version of the R 'ellmer' package in 2 sentences: \ </span></span>
<span><span class="st">    https://raw.githubusercontent.com/tidyverse/ellmer/main/NEWS.md"</span>,</span>
<span>    model <span class="op">=</span> <span class="st">"gemini-2.5-flash"</span>,</span>
<span>    tools <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"url_context"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="sourceCode" id="cb13"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>The current development version of the R 'ellmer' package introduces several significant changes, including enhanced control over model reasoning effort with new `reasoning_effort` and `reasoning_tokens` parameters for various chat functions. Additionally, it refines API key handling by using a `credentials` function to retrieve keys on demand, preventing their storage in chat objects, and supports image generation through `chat_google_gemini()` and `chat_openai_responses()`.</span></code></pre></div>
<p><strong>Limitations:</strong></p>
<ul>
<li>Maximum 20 URLs per request</li>
<li>34MB limit per URL</li>
<li>Retrieved content counts toward input token usage</li>
</ul>
<div>
<blockquote>
<p><strong>Note</strong></p>
<p>This server-side tool is equivalent to our client-side <code>web_fetch</code> tool.</p>
</blockquote>
</div>
</section><section class="level2"><h3 id="server-side-file-search">Server-side: File Search<a class="anchor" aria-label="anchor" href="#server-side-file-search"></a>
</h3>
<p>With Google Gemini, we can create a file search store and use the file_search tool to search through uploaded files, effectively turning it into a server-side RAG application. See the <a href="#server-side-rag">File Search &amp; RAG</a> section below for a complete example.</p>
</section><section class="level2"><h3 id="server-side-google-maps">Server-side: Google Maps<a class="anchor" aria-label="anchor" href="#server-side-google-maps"></a>
</h3>
<p>The Google Maps grounding tool connects Gemini with Google Maps’ rich, factual, and up-to-date location data. This enables accurate, location-aware responses for geographical queries.</p>
<section class="level3"><h4 id="basic-usage">Basic Usage<a class="anchor" aria-label="anchor" href="#basic-usage"></a>
</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">google_gemini</span><span class="op">$</span><span class="fu">chat</span><span class="op">(</span></span>
<span>    <span class="st">"What are the 5 best Italian restaurants within a 15-minute walk from Times Square?"</span>,</span>
<span>    model <span class="op">=</span> <span class="st">"gemini-2.5-flash"</span>,</span>
<span>    tools <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"google_maps"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<p>We can also provide a specific location for more relevant results:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">google_gemini</span><span class="op">$</span><span class="fu">chat</span><span class="op">(</span></span>
<span>    <span class="st">"Give me 5 good coffee shops with outdoor seating in a 1km radius from here."</span>,</span>
<span>    model <span class="op">=</span> <span class="st">"gemini-2.5-flash"</span>,</span>
<span>    tools <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>            type <span class="op">=</span> <span class="st">"google_maps"</span>,</span>
<span>            location <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>                latitude <span class="op">=</span> <span class="fl">63.43047233964285</span>,</span>
<span>                longitude <span class="op">=</span> <span class="op">-</span><span class="fl">10.394945036790627</span></span>
<span>            <span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="sourceCode" id="cb16"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>Here are 5 good coffee shops with outdoor seating near you:</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>1.  **Jacobsen &amp; Svart Coffee Roasters** - This coffee shop has a rating of 4.7 stars and is currently open until 5:00 PM today.</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>2.  **Tantes Hage** - With a rating of 4.8 stars, this cafe offers outdoor seating. Please note that Tantes Hage is closed today, but open on Sundays from 10:00 AM to 6:00 PM.</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>3.  **Café Løkka** - This cafe has a 4.3-star rating and is currently open until 12:00 AM.</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>4.  **Dromedar Kaffebar, Nordre** - Rated 4.3 stars, this coffee shop is open until 7:00 PM today.</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>5.  **Espresso House** (Nordre gate 1-3) - This cafe has a rating of 4.2 stars and is currently open until 8:00 PM.</span></code></pre></div>
<p><strong>Extract grounding metadata</strong> (citations and sources):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">google_gemini</span><span class="op">$</span><span class="fu">get_supplementary</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<p><strong>Enabling the Maps Widget</strong></p>
<p>Enable the widget context token to render interactive Google Maps widgets using the Maps API:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">google_gemini</span><span class="op">$</span><span class="fu">chat</span><span class="op">(</span></span>
<span>    <span class="st">"Plan a day in Trondheim. I want to see the Nidaros, swim in a lake, and have a beer by the river."</span>,</span>
<span>    model <span class="op">=</span> <span class="st">"gemini-2.5-flash"</span>,</span>
<span>    tools <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>            type <span class="op">=</span> <span class="st">"google_maps"</span>,</span>
<span>            enable_widget <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>            location <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>                latitude <span class="op">=</span> <span class="fl">63.43047233964285</span>,</span>
<span>                longitude <span class="op">=</span> <span class="op">-</span><span class="fl">10.394945036790627</span></span>
<span>            <span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="sourceCode" id="cb19"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>Here's a possible plan for your day in Trondheim:</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>Start your day by visiting the magnificent Nidaros Cathedral, a Gothic cathedral dating from the 13th century located at Kongsgårdsgata 2. The cathedral typically opens at 9:00 AM on weekdays.</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>After exploring the cathedral, head to Theisendammen badeplass for a refreshing swim in a lake. This park is open 24 hours, highly-rated, and is a good option for swimming.</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>In the evening, enjoy a beer by the Nidelva river at Den Gode Nabo AS. This highly-rated bar, located at Øvre Bakklandet 66, offers outdoor seating, perfect for enjoying the riverside atmosphere.</span></code></pre></div>
<p>Extract the widget context token:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">google_gemini</span><span class="op">$</span><span class="fu">get_supplementary</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/pluck.html" class="external-link">pluck</a></span><span class="op">(</span><span class="st">"grounding_metadata"</span>, <span class="st">"googleMapsWidgetContextToken"</span><span class="op">)</span></span></code></pre></div>
</div>
<p>The widget token can be passed to the Google Maps API to display interactive maps with markers in your frontend.</p>
<div>
<blockquote>
<p><strong>Note</strong></p>
<ul>
<li>Only works with specific Gemini models (2.5 Pro, 2.5 Flash, 2.5 Flash-Lite, 2.0 Flash)</li>
<li>Free tier: 500 successful requests per day</li>
<li>25$ per 1,000 grounded prompts</li>
</ul>
</blockquote>
</div>
</section></section><section class="level2"><h3 id="server-side-code-execution">Server-side: Code Execution<a class="anchor" aria-label="anchor" href="#server-side-code-execution"></a>
</h3>
<p>The code execution tool allows the model to write and execute Python code in a server-side sandboxed environment for data analysis, calculations, and visualizations.</p>
<p><strong>Example: Analyzing the Penguins Dataset</strong></p>
<p>Let’s upload the penguins dataset as a remote file and use the code execution tool:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins_url</span> <span class="op">&lt;-</span> <span class="st">"https://raw.githubusercontent.com/allisonhorst/palmerpenguins/refs/heads/main/inst/extdata/penguins.csv"</span></span>
<span><span class="va">penguins_file_metadata</span> <span class="op">&lt;-</span> <span class="va">google_gemini</span><span class="op">$</span><span class="fu">upload_file</span><span class="op">(</span><span class="va">penguins_url</span><span class="op">)</span></span>
<span></span>
<span><span class="va">google_gemini</span><span class="op">$</span><span class="fu">chat</span><span class="op">(</span></span>
<span>    <span class="st">"Create a summary table showing average body_mass grouped by species, sex, and year. Save as CSV."</span>,</span>
<span>    model <span class="op">=</span> <span class="st">"gemini-2.5-flash"</span>,</span>
<span>    tools <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"code_execution"</span>, file_ids <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">penguins_file_metadata</span><span class="op">$</span><span class="va">name</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<p>Inspect the generated code:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">google_gemini</span><span class="op">$</span><span class="fu">get_generated_code</span><span class="op">(</span>langs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"python"</span><span class="op">)</span>, as_chunks <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<details><summary>Generated Code</summary><div class="sourceCode" id="cb23"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the CSV file</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">"input_file_0.csv"</span>)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the first few rows and information about the DataFrame</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"DataFrame Head:"</span>)</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.head())</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">DataFrame Info:"</span>)</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.info())</span></code></pre></div>
<div class="sourceCode" id="cb24"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Group by species, sex, and year and calculate the average body_mass_g</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>summary_table <span class="op">=</span> df.groupby([<span class="st">'species'</span>, <span class="st">'sex'</span>, <span class="st">'year'</span>])[<span class="st">'body_mass_g'</span>].mean().reset_index()</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename the 'body_mass_g' column to 'average_body_mass_g' for clarity</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>summary_table <span class="op">=</span> summary_table.rename(columns<span class="op">=</span>{<span class="st">'body_mass_g'</span>: <span class="st">'average_body_mass_g'</span>})</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the summary table to a CSV file</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>output_filename <span class="op">=</span> <span class="st">"average_body_mass_summary.csv"</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>summary_table.to_csv(output_filename, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Summary table saved to </span><span class="sc">{</span>output_filename<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Summary Table Head:"</span>)</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(summary_table.head())</span></code></pre></div>
</details><p>Download the generated files:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">downloaded_path</span> <span class="op">&lt;-</span> <span class="va">google_gemini</span><span class="op">$</span><span class="fu">download_generated_files</span><span class="op">(</span>dest_path <span class="op">=</span> <span class="st">"data"</span><span class="op">)</span></span>
<span><span class="co">#&gt; ✔ File saved: data/generated_file_9604db3d-57fc-4aab-bd60-bf4c194ab6e5.csv</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="va">downloaded_path</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="sourceCode" id="cb27"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>     species    sex year average_body_mass_g</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>1     Adelie female 2007            3389.773</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>2     Adelie female 2008            3386.000</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>3     Adelie female 2009            3334.615</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>4     Adelie   male 2007            4038.636</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>5     Adelie   male 2008            4098.000</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>6     Adelie   male 2009            3995.192</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>7  Chinstrap female 2007            3569.231</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>8  Chinstrap female 2008            3472.222</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>9  Chinstrap female 2009            3522.917</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>10 Chinstrap   male 2007            3819.231</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>11 Chinstrap   male 2008            4127.778</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>12 Chinstrap   male 2009            3927.083</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>13    Gentoo female 2007            4618.750</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>14    Gentoo female 2008            4627.273</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>15    Gentoo female 2009            4786.250</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>16    Gentoo   male 2007            5552.941</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>17    Gentoo   male 2008            5410.870</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>18    Gentoo   male 2009            5510.714</span></code></pre></div>
<p>Continue asking questions in the same context:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguin_output_schema</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tool_definitions.html">schema</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"penguin_output"</span>,</span>
<span>    description <span class="op">=</span> <span class="st">"Schema for the penguin output"</span>,</span>
<span>    average_body_mass <span class="op">=</span> <span class="st">"number* The average body_mass"</span>,</span>
<span>    species <span class="op">=</span> <span class="st">"string* The species"</span>,</span>
<span>    sex <span class="op">=</span> <span class="st">"string* The sex"</span>,</span>
<span>    year <span class="op">=</span> <span class="st">"integer* The year"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">google_gemini</span><span class="op">$</span><span class="fu">chat</span><span class="op">(</span></span>
<span>    <span class="st">"What's the average body_mass for the Adelie females in 2009?"</span>,</span>
<span>    tools <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"code_execution"</span><span class="op">)</span>,</span>
<span>    output_schema <span class="op">=</span> <span class="va">penguin_output_schema</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="sourceCode" id="cb29"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>$species</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>[1] "Adelie"</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>$sex</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>[1] "females"</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>$year</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>[1] 2009</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>$average_body_mass</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>[1] 3334.62</span></code></pre></div>
</section><section class="level2"><h3 id="multimodal-inputs">Multimodal Inputs<a class="anchor" aria-label="anchor" href="#multimodal-inputs"></a>
</h3>
<p>Google Gemini supports sending:</p>
<ul>
<li>PDF (files or URLs) as text or base64</li>
<li>Images (files or URLs) as base64</li>
<li>Remote files (through <code><a href="../reference/content_converters.html">as_file_content()</a></code>)</li>
<li>Plain text &amp; code files</li>
<li>Text-based data files (csv, tsv, json, ..)</li>
<li>R objects</li>
</ul>
<section class="level3"><h4 id="image-comprehension">Image Comprehension<a class="anchor" aria-label="anchor" href="#image-comprehension"></a>
</h4>
<div class="cell">
<details class="code-fold"><summary>Downloading an example image</summary><div class="sourceCode cell-code" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bsg04_cast_image_url</span> <span class="op">&lt;-</span> <span class="st">"https://upload.wikimedia.org/wikipedia/en/1/1a/Battlestar_Galactica_%282004%29_cast.jpg"</span></span>
<span><span class="va">bsg04_cast_image_path</span> <span class="op">&lt;-</span> <span class="fu">download_temp_file</span><span class="op">(</span><span class="va">bsg04_cast_image_url</span><span class="op">)</span></span></code></pre></div>
</details>
</div>
<p><strong>Sending a local image:</strong></p>
<p>When providing a path to a local image, it will automatically be converted to base64 before being sent to the server.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">google_gemini</span><span class="op">$</span><span class="fu">chat</span><span class="op">(</span></span>
<span>    <span class="st">"Who are the characters in this image, and what show is it from?"</span>,</span>
<span>    <span class="va">bsg04_cast_image_path</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="sourceCode" id="cb32"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>The characters in the image are from the show **Battlestar Galactica**.</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>From left to right, the characters are:</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>*   **Admiral William Adama** (played by Edward James Olmos)</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>*   **President Laura Roslin** (played by Mary McDonnell)</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>*   **Captain Lee "Apollo" Adama** (played by Jamie Bamber)</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>*   **Lieutenant Kara "Starbuck" Thrace** (played by Katee Sackhoff)</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>*   **Number Six** (played by Tricia Helfer)</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>*   **Gaius Baltar** (played by James Callis)</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>*   **Sharon "Boomer" Valerii / Sharon "Athena" Agathon** (played by Grace Park)</span></code></pre></div>
<p><em>So say we all!</em></p>
<p><strong>Sending an image URL:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">google_gemini</span><span class="op">$</span><span class="fu">reset_history</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">google_gemini</span><span class="op">$</span><span class="fu">chat</span><span class="op">(</span></span>
<span>    <span class="st">"Who are the characters in this image, and what show is it from?"</span>,</span>
<span>    <span class="va">bsg04_cast_image_url</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div>
<blockquote>
<p><strong>Note</strong></p>
<p>Here, the URL was automatically detected, downloaded in a temporary file, and converted to base64, before being passed to the model.</p>
<p>Other providers may have different behavior. For example, Anthropic supports passing image files URLs directly.</p>
</blockquote>
</div>
<div>
<blockquote>
<p><strong>Tip</strong></p>
<p>We could have used the <code>as_image_content(bsg04_cast_image_url)</code> helper to make sure the path/url is treated as an image, and, optionally, to resize the image before sending it.</p>
</blockquote>
</div>
</section><section class="level3"><h4 id="pdf-comprehension">PDF Comprehension<a class="anchor" aria-label="anchor" href="#pdf-comprehension"></a>
</h4>
<div class="cell">
<details class="code-fold"><summary>Downloading an example PDF (my CV)</summary><div class="sourceCode cell-code" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_cv_url</span> <span class="op">&lt;-</span> <span class="st">"https://ma-riviere.com/res/cv.pdf"</span></span>
<span><span class="va">my_cv_pdf_path</span> <span class="op">&lt;-</span> <span class="fu">download_temp_file</span><span class="op">(</span><span class="va">my_cv_url</span><span class="op">)</span></span></code></pre></div>
</details>
</div>
<p><strong>Sending a local PDF:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">google_gemini</span><span class="op">$</span><span class="fu">chat</span><span class="op">(</span></span>
<span>    <span class="st">"What's my favorite programming language ?"</span>,</span>
<span>    <span class="va">my_cv_pdf_path</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="sourceCode" id="cb36"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>Based on your resume, your favorite programming language appears to be **R**.</span></code></pre></div>
<p><em>Damn right!</em></p>
<p><strong>Sending PDF URLs:</strong></p>
<p>For Google, by default, PDF URLs are sent as base64 to the server.</p>
<p>However, we can use the <code><a href="../reference/content_converters.html">as_text_content()</a></code> helper to have <code><a href="https://docs.ropensci.org/pdftools//reference/pdf_render_page.html" class="external-link">pdftools::pdf_convert()</a></code> parse the PDFs and pass their text contents to the model instead.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">r6_pdf_url</span> <span class="op">&lt;-</span> <span class="st">"https://cran.r-project.org/web/packages/R6/R6.pdf"</span></span>
<span><span class="va">s7_pdf_url</span> <span class="op">&lt;-</span> <span class="st">"https://cran.r-project.org/web/packages/S7/S7.pdf"</span></span>
<span></span>
<span><span class="va">multimodal_prompt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="st">"Give a 3 sentences summary of the advantages of S7 over R6"</span>,</span>
<span>    <span class="fu"><a href="../reference/content_converters.html">as_text_content</a></span><span class="op">(</span><span class="va">r6_pdf_url</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="../reference/content_converters.html">as_text_content</a></span><span class="op">(</span><span class="va">s7_pdf_url</span><span class="op">)</span>,</span>
<span>    <span class="st">"And give me the current versions of both packages"</span> <span class="co"># To make sure you actually read the PDFs</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">google_gemini</span><span class="op">$</span><span class="fu">chat</span><span class="op">(</span><span class="op">!</span><span class="op">!</span><span class="op">!</span><span class="va">multimodal_prompt</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="sourceCode" id="cb38"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>S7 offers a more formal and comprehensive object-oriented system for R, explicitly designed as a successor to both S3 and S4, featuring formal class, generic, and method specifications. It supports limited multiple dispatch, allowing method selection based on the types of multiple arguments, a capability not natively offered by R6. Furthermore, S7 is the result of a collaborative effort by the R Consortium Object-Oriented Programming Working Group, suggesting a broader community consensus and potential for standardization in R's future.</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>The current versions of the packages are:</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>*   **R6:** 2.6.1 (published 2025-02-15)</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>*   **S7:** 0.2.0 (published 2024-11-07)</span></code></pre></div>
</section><section class="level3"><h4 id="passing-r-objects">Passing R Objects<a class="anchor" aria-label="anchor" href="#passing-r-objects"></a>
</h4>
<p>You can pass any R object to <code>chat()</code> as is:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lm_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">body_mass</span> <span class="op">~</span> <span class="va">species</span> <span class="op">+</span> <span class="va">sex</span>, data <span class="op">=</span> <span class="fu">datasets</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/r/datasets/penguins.html" class="external-link">penguins</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">google_gemini</span><span class="op">$</span><span class="fu">chat</span><span class="op">(</span></span>
<span>    <span class="st">"What can we deduct from this regression model ?"</span>,</span>
<span>    <span class="va">lm_obj</span>,</span>
<span>    model <span class="op">=</span> <span class="st">"gemini-2.5-flash"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="sourceCode" id="cb40"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>From the provided regression model output, we can deduce the following three points:</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>1.  **Model Type and Purpose**: This is a linear regression model (`lm_obj`) attempting to explain or predict `body_mass` based on two categorical predictor variables: `species` and `sex`. The model was fitted using the `datasets::penguins` dataset.</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>2.  **Intercept and Reference Group Body Mass**: The estimated intercept is 3372.4. Given that `contr.treatment` was used for both categorical variables, this intercept represents the estimated average `body_mass` (likely in grams) for the baseline group: an **Adelie female penguin**.</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>3.  **Estimated Effects of Predictors**:</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    *   **Species Effect**: Compared to Adelie penguins (the reference species), Chinstrap penguins are estimated to have an average `body_mass` that is 26.9 units higher, and Gentoo penguins are estimated to have an average `body_mass` that is 1377.9 units higher, assuming sex is held constant.</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    *   **Sex Effect**: Compared to female penguins (the reference sex), male penguins are estimated to have an average `body_mass` that is 667.6 units higher, assuming species is held constant.</span></code></pre></div>
<div>
<blockquote>
<p><strong>Note</strong></p>
<p>Any R object passed to <code>chat()</code> will be automatically converted to JSON (or text if JSON conversion fails), with some added information like the name of the object and its classes.</p>
</blockquote>
</div>
</section><section class="level3"><h4 id="passing-uploaded-files">Passing Uploaded Files<a class="anchor" aria-label="anchor" href="#passing-uploaded-files"></a>
</h4>
<p>Upload a file and reference it with <code><a href="../reference/content_converters.html">as_file_content()</a></code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">file_metadata</span> <span class="op">&lt;-</span> <span class="va">google_gemini</span><span class="op">$</span><span class="fu">upload_file</span><span class="op">(</span><span class="va">my_cv_url</span><span class="op">)</span> <span class="co"># Pass an URL or a local file path</span></span>
<span></span>
<span><span class="va">multipart_prompt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="st">"What are my two favorite frameworks/tools ?"</span>,</span>
<span>    <span class="fu"><a href="../reference/content_converters.html">as_file_content</a></span><span class="op">(</span><span class="va">file_metadata</span><span class="op">$</span><span class="va">name</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">google_gemini</span><span class="op">$</span><span class="fu">chat</span><span class="op">(</span><span class="op">!</span><span class="op">!</span><span class="op">!</span><span class="va">multipart_prompt</span>, model <span class="op">=</span> <span class="st">"gemini-2.5-flash"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">google_gemini</span><span class="op">$</span><span class="fu">delete_file</span><span class="op">(</span><span class="va">file_metadata</span><span class="op">$</span><span class="va">name</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="sourceCode" id="cb42"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>Based on your resume, your two favorite frameworks/tools appear to be **Shiny** and **Quarto/R Markdown**.</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>Here's why:</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>*   Your most recent role is "R/Shiny Developer," highlighting Shiny as a primary tool.</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>*   Shiny is listed first and prominently in your "Frameworks &amp; Tools" section.</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>*   "Quarto, R Markdown" is also listed prominently and is explicitly mentioned in your "Consulting" section, and is a natural pairing with R and Shiny for scientific publishing and interactive content.</span></code></pre></div>
<div>
<blockquote>
<p><strong>Note</strong></p>
<p>Here, using <code><a href="../reference/content_converters.html">as_file_content()</a></code> is necessary to signal to the model to use this as a remote file reference, rather than just some text content.</p>
</blockquote>
</div>
<div>
<blockquote>
<p><strong>Tip</strong></p>
<p>You can use <code>$list_files()</code> to list all uploaded files and their metadata.</p>
</blockquote>
</div>
</section></section></section><section class="section level2"><h2 id="server-side-rag">File Search &amp; RAG<a class="anchor" aria-label="anchor" href="#server-side-rag"></a>
</h2>
<p>The file search tool enables Retrieval-Augmented Generation (RAG) by allowing the model to search through uploaded files. This is Google’s managed solution for file search using vector embeddings.</p>
<section class="level2"><h3 id="creating-a-file-search-store">Creating a File Search Store<a class="anchor" aria-label="anchor" href="#creating-a-file-search-store"></a>
</h3>
<p>First, create a file search store to hold your files:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">store</span> <span class="op">&lt;-</span> <span class="va">google_gemini</span><span class="op">$</span><span class="fu">create_store</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"R OOP Store"</span><span class="op">)</span></span>
<span><span class="co">#&gt; ✔ [Google] File search store created: fileSearchStores/r-oop-store-bkd207kkacou</span></span></code></pre></div>
</div>
</section><section class="level2"><h3 id="uploading-files-to-store">Uploading Files to Store<a class="anchor" aria-label="anchor" href="#uploading-files-to-store"></a>
</h3>
<p>You can either upload files directly or import existing File API files:</p>
<p><strong>Direct upload:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">r6_pdf_url</span> <span class="op">&lt;-</span> <span class="st">"https://cran.r-project.org/web/packages/R6/R6.pdf"</span></span>
<span></span>
<span><span class="va">doc</span> <span class="op">&lt;-</span> <span class="va">google_gemini</span><span class="op">$</span><span class="fu">add_file_to_store</span><span class="op">(</span></span>
<span>    file_path <span class="op">=</span> <span class="va">r6_pdf_url</span>,</span>
<span>    store_name <span class="op">=</span> <span class="va">store</span><span class="op">$</span><span class="va">name</span>,</span>
<span>    file_name <span class="op">=</span> <span class="st">"R6 Package Documentation"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; ✔ [Google] File uploaded to store: fileSearchStores/r-oop-store-bkd207kkacou/documents/r6-package-documentation-9uwwjohjvjj1</span></span></code></pre></div>
</div>
<p><strong>Import from File API:</strong></p>
<p>Another way to upload files is to use the <code>upload_file()</code>, and then import the uploaded file into the store. The result will be the same.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">file_metadata</span> <span class="op">&lt;-</span> <span class="va">google_gemini</span><span class="op">$</span><span class="fu">upload_file</span><span class="op">(</span><span class="va">r6_pdf_url</span>, name <span class="op">=</span> <span class="st">"R6 Package Documentation 2"</span><span class="op">)</span></span>
<span><span class="co">#&gt; ✔ [Google] File uploaded: files/ie6e5jfpuwpf</span></span>
<span></span>
<span><span class="va">doc</span> <span class="op">&lt;-</span> <span class="va">google_gemini</span><span class="op">$</span><span class="fu">import_file_to_store</span><span class="op">(</span></span>
<span>    file_name <span class="op">=</span> <span class="va">file_metadata</span><span class="op">$</span><span class="va">name</span>,</span>
<span>    store_name <span class="op">=</span> <span class="va">store</span><span class="op">$</span><span class="va">name</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; ✔ [Google] File imported: fileSearchStores/r-oop-store-bkd207kkacou/documents/ie6e5jfpuwpf-3z73sypazx1o</span></span></code></pre></div>
</div>
</section><section class="level2"><h3 id="using-file-search-in-chat">Using File Search in Chat<a class="anchor" aria-label="anchor" href="#using-file-search-in-chat"></a>
</h3>
<p>Once files are uploaded, use the file_search tool in your chat requests:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">google_gemini</span><span class="op">$</span><span class="fu">chat</span><span class="op">(</span></span>
<span>    <span class="st">"What are the key features of R6 classes compared to reference classes? In three sentences."</span>,</span>
<span>    model <span class="op">=</span> <span class="st">"gemini-2.5-flash"</span>,</span>
<span>    tools <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"file_search"</span>, store_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">store</span><span class="op">$</span><span class="va">name</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<p><strong>Extract grounding metadata with citations:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu">yaml</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/yaml/man/as.yaml.html" class="external-link">as.yaml</a></span><span class="op">(</span><span class="va">google_gemini</span><span class="op">$</span><span class="fu">get_supplementary</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="cell">
<details class="code-fold"><summary>Grounding metadata with file citations</summary><div class="sourceCode cell-code" id="cb48"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">grounding_metadata</span><span class="kw">:</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">groundingChunks</span><span class="kw">:</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">retrievedContext</span><span class="kw">:</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">title</span><span class="kw">:</span><span class="at"> je792h7nxtr4</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="fu">      text</span><span class="kw">: </span><span class="ch">|-</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>        above) of the object.</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>        The default print method of R6 objects can be redefined, by supplying a public print method.</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>         (print members that are not functions are ignored.) This method is automatically called when-</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>         ever the object is printed, e.g. when the object's name is typed at the command prompt, or when</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>         print(obj) is called. It can also be called directly via obj\$print(). All extra arguments from a</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>         print(obj,...) call are passed on to the obj\$print(...) method.</span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>        Portable and non-portable classes</span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a>        When R6 classes are portable (the default), they can be inherited across packages without compli-</span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a>         cation. However, when in portable mode, members must be accessed with self and private, as in</span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a>         self\$x and private\$y.</span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a>        --- PAGE 5 ---</span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a>        R6Class</span>
<span id="cb48-23"><a href="#cb48-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-24"><a href="#cb48-24" aria-hidden="true" tabindex="-1"></a>        5</span>
<span id="cb48-25"><a href="#cb48-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-26"><a href="#cb48-26" aria-hidden="true" tabindex="-1"></a>        When used in non-portable mode, R6 classes behave more like reference classes: inheritance across</span>
<span id="cb48-27"><a href="#cb48-27" aria-hidden="true" tabindex="-1"></a>         packages will not work well, and self and private are not necessary for accessing fields.</span>
<span id="cb48-28"><a href="#cb48-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-29"><a href="#cb48-29" aria-hidden="true" tabindex="-1"></a>        Cloning objects</span>
<span id="cb48-30"><a href="#cb48-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-31"><a href="#cb48-31" aria-hidden="true" tabindex="-1"></a>        R6 objects have a method named clone by default. To disable this, use cloneable=FALSE. Having</span>
<span id="cb48-32"><a href="#cb48-32" aria-hidden="true" tabindex="-1"></a>         the clone method present will slightly increase the memory footprint of R6 objects, but since the</span>
<span id="cb48-33"><a href="#cb48-33" aria-hidden="true" tabindex="-1"></a>         method will be shared across all R6 objects, the memory use will be negligible.</span>
<span id="cb48-34"><a href="#cb48-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-35"><a href="#cb48-35" aria-hidden="true" tabindex="-1"></a>        By default, calling x\$clone() on an R6 object will result in a shallow</span>
<span id="cb48-36"><a href="#cb48-36" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">fileSearchStore</span><span class="kw">:</span><span class="at"> fileSearchStores/r-oop-store-bkd207kkacou</span></span>
<span id="cb48-37"><a href="#cb48-37" aria-hidden="true" tabindex="-1"></a><span class="co">...</span></span></code></pre></div>
</details>
</div>
</section><section class="level2"><h3 id="using-metadata-filtering">Using Metadata Filtering<a class="anchor" aria-label="anchor" href="#using-metadata-filtering"></a>
</h3>
<p>Add custom metadata to files for filtering:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s7_pdf_url</span> <span class="op">&lt;-</span> <span class="st">"https://cran.r-project.org/web/packages/S7/S7.pdf"</span></span>
<span></span>
<span><span class="va">doc2</span> <span class="op">&lt;-</span> <span class="va">google_gemini</span><span class="op">$</span><span class="fu">add_file_to_store</span><span class="op">(</span></span>
<span>    file_path <span class="op">=</span> <span class="va">s7_pdf_url</span>,</span>
<span>    store_name <span class="op">=</span> <span class="va">store</span><span class="op">$</span><span class="va">name</span>,</span>
<span>    file_name <span class="op">=</span> <span class="st">"S7 Package Documentation"</span>,</span>
<span>    custom_metadata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        package <span class="op">=</span> <span class="st">"S7"</span>,</span>
<span>        version <span class="op">=</span> <span class="st">"0.2.0"</span>,</span>
<span>        year <span class="op">=</span> <span class="fl">2024</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; ✔ [Google] File uploaded to store: fileSearchStores/r-oop-store-bkd207kkacou/documents/fileSearchStores/r-oop-store-bkd207kkacou/documents/s7-package-documentation-x7o9goo6eufz</span></span>
<span></span>
<span><span class="va">google_gemini</span><span class="op">$</span><span class="fu">chat</span><span class="op">(</span></span>
<span>    <span class="st">"What are the main features of S7?"</span>,</span>
<span>    model <span class="op">=</span> <span class="st">"gemini-2.5-flash"</span>,</span>
<span>    tools <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>            type <span class="op">=</span> <span class="st">"file_search"</span>,</span>
<span>            store_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">store</span><span class="op">$</span><span class="va">name</span><span class="op">)</span>,</span>
<span>            metadata_filter <span class="op">=</span> <span class="st">"package=S7"</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</section><section class="level2"><h3 id="chunking-configuration">Chunking Configuration<a class="anchor" aria-label="anchor" href="#chunking-configuration"></a>
</h3>
<p>Control how files are chunked for better retrieval.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">doc3</span> <span class="op">&lt;-</span> <span class="va">google_gemini</span><span class="op">$</span><span class="fu">add_file_to_store</span><span class="op">(</span></span>
<span>    file_path <span class="op">=</span> <span class="va">s7_pdf_url</span>,</span>
<span>    store_name <span class="op">=</span> <span class="va">store</span><span class="op">$</span><span class="va">name</span>,</span>
<span>    file_name <span class="op">=</span> <span class="st">"S7 Package Documentation 2"</span>,</span>
<span>    chunking_config <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        max_tokens_per_chunk <span class="op">=</span> <span class="fl">400</span>,</span>
<span>        max_overlap_tokens <span class="op">=</span> <span class="fl">50</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; ✔ [Google] File uploaded to store: fileSearchStores/r-oop-store-bkd207kkacou/documents/s7-package-documentation-2-sgob116kg3ts</span></span></code></pre></div>
</div>
</section><section class="level2"><h3 id="querying-files-directly">Querying Files Directly<a class="anchor" aria-label="anchor" href="#querying-files-directly"></a>
</h3>
<p>You can also query specific files without using the chat interface:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">google_gemini</span><span class="op">$</span><span class="fu">query_file</span><span class="op">(</span></span>
<span>    file_name <span class="op">=</span> <span class="va">doc</span><span class="op">$</span><span class="va">name</span>,</span>
<span>    query <span class="op">=</span> <span class="st">"What are active bindings?"</span>,</span>
<span>    results_count <span class="op">=</span> <span class="fl">5</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</section><section class="level2"><h3 id="managing-stores-and-files">Managing Stores and Files<a class="anchor" aria-label="anchor" href="#managing-stores-and-files"></a>
</h3>
<p><strong>List all stores:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">google_gemini</span><span class="op">$</span><span class="fu">list_stores</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<p><strong>List files in a store:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">google_gemini</span><span class="op">$</span><span class="fu">list_files_in_store</span><span class="op">(</span><span class="va">store</span><span class="op">$</span><span class="va">name</span><span class="op">)</span></span></code></pre></div>
</div>
<p><strong>Get file details:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">google_gemini</span><span class="op">$</span><span class="fu">read_file_from_store</span><span class="op">(</span><span class="va">doc</span><span class="op">$</span><span class="va">name</span><span class="op">)</span></span></code></pre></div>
</div>
<p><strong>Delete a file:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">google_gemini</span><span class="op">$</span><span class="fu">delete_file_from_store</span><span class="op">(</span><span class="va">doc</span><span class="op">$</span><span class="va">name</span><span class="op">)</span></span></code></pre></div>
</div>
<p><strong>Delete a store:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">google_gemini</span><span class="op">$</span><span class="fu">delete_store</span><span class="op">(</span><span class="va">store</span><span class="op">$</span><span class="va">name</span>, force <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div>
<blockquote>
<p><strong>Note</strong></p>
<p><strong>Pricing &amp; Limits:</strong> - File search is currently in preview and pricing may change - Maximum file size: 2GB - Supported formats: PDF, TXT, HTML, DOCX, and more</p>
</blockquote>
</div>
</section></section><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config);
    }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script></main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://ma-riviere.com" class="external-link">Marc-Aurèle Rivière</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
