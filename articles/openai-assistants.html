<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>OpenAI - Assistants API • argent</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="openai-assistants_files/libs/quarto-html/popper.min.js"></script><script src="openai-assistants_files/libs/quarto-html/tippy.umd.min.js"></script><link href="openai-assistants_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="openai-assistants_files/libs/quarto-html/light-border.css" rel="stylesheet">
<!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="OpenAI - Assistants API">
<meta name="twitter:card" content="summary">
<meta name="twitter:creator" content="@mariviere1">
<meta name="twitter:site" content="@mariviere1">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">argent</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Unreleased version">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/argent.html">Get started</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-providers" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Providers</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-providers">
<li><a class="dropdown-item" href="../articles/google-gemini.html">Google Gemini</a></li>
    <li><a class="dropdown-item" href="../articles/anthropic.html">Anthropic</a></li>
    <li><a class="dropdown-item" href="../articles/openrouter.html">OpenRouter</a></li>
    <li><a class="dropdown-item" href="../articles/local-llm.html">Local LLM</a></li>
    <li><a class="dropdown-item" href="../articles/other-providers.html">Other Providers</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>OpenAI</h6></li>
    <li><a class="dropdown-item" href="../articles/openai-responses.html">Responses API</a></li>
    <li><a class="dropdown-item" href="../articles/openai-completions.html">Chat Completions API</a></li>
    <li><a class="dropdown-item" href="../articles/openai-assistants.html">Assistants API</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-advanced-use" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Advanced Use</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-advanced-use">
<li><a class="dropdown-item" href="../articles/usecase-rag.html">RAG Applications</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ma-riviere/argent/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-quarto">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>OpenAI - Assistants API</h1>




      <small class="dont-index">Source: <a href="https://github.com/ma-riviere/argent/blob/main/vignettes/articles/openai-assistants.qmd" class="external-link"><code>vignettes/articles/openai-assistants.qmd</code></a></small>
      <div class="d-none name"><code></code></div>
    </div>






    <div>
<blockquote>
<p><strong>Deprecation Warning</strong></p>
<p>The Assistants API is deprecated and will shut down on August 26, 2026.</p>
<p><strong>Use the <a href="responses-api.html">Responses API</a> instead</strong> for all new development. The Responses API provides all the same features with a better interface and additional capabilities.</p>
<p>Additionally, the Assistants API does not work with GPT-5 models.</p>
</blockquote>
</div>
<section class="section level2"><h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The Assistants API manages conversation state server-side through threads and provides server-side tools like file_search and code_interpreter.</p>
</section><section class="section level2"><h2 id="key-differences-with-openais-other-apis">Key Differences with OpenAI’s other APIs<a class="anchor" aria-label="anchor" href="#key-differences-with-openais-other-apis"></a>
</h2>
<ul>
<li>
<strong>Server-side state</strong>: Conversation history stored in threads on OpenAI servers</li>
<li>
<strong>Thread-based management</strong>: Conversations persist in threads</li>
<li>
<strong>No GPT-5 support</strong>: Limited to GPT-4 and earlier models</li>
<li>
<strong>No reasoning</strong>: Does not support <code>reasoning_effort</code>
</li>
</ul></section><section class="section level2"><h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">openai_assistant</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/OpenAI_Assistant.html">OpenAI_Assistant</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>api_key <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"OPENAI_API_KEY"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div>
<blockquote>
<p><strong>Note</strong></p>
<p>This does not create an assistant, it only creates an instance of the <code>OpenAI_Assistant</code> class. For OpenAI Assistants, you need to specifically create an assistant with <code>create_assistant()</code>.</p>
</blockquote>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">openai_assistant</span><span class="op">$</span><span class="fu">create_assistant</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"My Assistant"</span>, model <span class="op">=</span> <span class="st">"gpt-4o-mini"</span><span class="op">)</span></span></code></pre></div>
</div>
<p>The assistant configuration (model, temperature, tools, system) is set during creation and applies to all subsequent <code>chat()</code> calls.</p>
<div>
<blockquote>
<p><strong>Note</strong></p>
<p>We can check the assistant configuration with <code>get_assistant()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">openai_assistant</span><span class="op">$</span><span class="fu">get_assistant</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<p>We can also load an existing assistant with <code>load_assistant()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Find assistant by name</span></span>
<span><span class="va">assistant_id</span> <span class="op">&lt;-</span> <span class="va">openai_assistant</span><span class="op">$</span><span class="fu">find_assistants</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"My Assistant"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/pluck.html" class="external-link">pluck</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load in a new client instance</span></span>
<span><span class="va">existing_assistant</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/OpenAI_Assistant.html">OpenAI_Assistant</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="fu">load_assistant</span><span class="op">(</span>id <span class="op">=</span> <span class="va">assistant_id</span><span class="op">)</span></span></code></pre></div>
</div>
</blockquote>
</div>
<p><strong>Available Models</strong></p>
<div>
<blockquote>
<p><strong>Note</strong></p>
<p>The Assistants API does not support GPT-5 models. Use GPT-4 or earlier.</p>
</blockquote>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">openai_assistant</span><span class="op">$</span><span class="fu">list_models</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">id</span>, <span class="st">"-4o-|-4.1-"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</section><section class="section level2"><h2 id="basic-chat">Basic Chat<a class="anchor" aria-label="anchor" href="#basic-chat"></a>
</h2>
<p>The Assistants API manages conversation state through threads:</p>
<ul>
<li>
<strong>First message</strong>: Creates a new thread automatically</li>
<li>
<strong>Subsequent messages</strong>: Continue in the same thread by default</li>
<li>
<strong>New thread</strong>: Set <code>in_new_thread = TRUE</code> to create a fresh conversation</li>
<li>
<strong>Persistence</strong>: Threads persist on OpenAI’s servers until explicitly deleted</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">openai_assistant</span><span class="op">$</span><span class="fu">chat</span><span class="op">(</span><span class="st">"What's the R programming language? Answer in three sentences."</span><span class="op">)</span></span>
<span><span class="co">#&gt; ✔ [OpenAI Assistant] Thread created: thread_r4WVfgfBmPZ66WUpy4diT2gE</span></span></code></pre></div>
</div>
<p>Continue in the same thread:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">openai_assistant</span><span class="op">$</span><span class="fu">chat</span><span class="op">(</span><span class="st">"Tell me more about its history"</span><span class="op">)</span></span></code></pre></div>
</div>
<p>Start a new thread:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">openai_assistant</span><span class="op">$</span><span class="fu">chat</span><span class="op">(</span><span class="st">"What were we just talking about?"</span>, in_new_thread <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; ✔ [OpenAI Assistant] Thread created: thread_eVLlsNW3xGR2a0cUQSaoMX4G</span></span></code></pre></div>
</div>
<div>
<blockquote>
<p><strong>Note</strong></p>
<p>Unlike the Responses API which uses <code>previous_response_id</code>, the Assistants API maintains state through persistent threads. Threads continue automatically unless you explicitly create a new one, e.g. with <code>in_new_thread = TRUE</code>.</p>
</blockquote>
</div>
<p>Access the latest thread messages with <code>get_thread_msgs()</code> (to see the current ‘chat history’):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">openai_assistant</span><span class="op">$</span><span class="fu">get_chat_history</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<p>Or, simply print the <code>openai_assistant</code> object to see the current chat history:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">openai_assistant</span>, show_tools <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
</section><section class="section level2"><h2 id="tool-calling-structured-output">Tool Calling + Structured Output<a class="anchor" aria-label="anchor" href="#tool-calling-structured-output"></a>
</h2>
<p>First, define web-related tools bundled in a <code>web_tools</code> list:</p>
<details><summary>Web Tools Implementation</summary><p><strong>Search:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">web_search</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">query</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co">#' @description Search the web for information using Tavily API. Returns a JSON array of search results with titles, URLs, and content snippets. Use this when you need current information, facts, news, or any data not in your training data.</span></span>
<span>    <span class="co">#' @param query:string* The search query string. Be specific and use keywords that will yield the most relevant results.</span></span>
<span>    </span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu">web_search_tavily</span><span class="op">(</span><span class="va">query</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">web_search_tavily</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">query</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">httr2</span><span class="fu">::</span><span class="fu"><a href="https://httr2.r-lib.org/reference/request.html" class="external-link">request</a></span><span class="op">(</span><span class="st">"https://api.tavily.com/search"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>        <span class="fu">httr2</span><span class="fu">::</span><span class="fu"><a href="https://httr2.r-lib.org/reference/req_body.html" class="external-link">req_body_json</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>            query <span class="op">=</span> <span class="va">query</span>,</span>
<span>            search_depth <span class="op">=</span> <span class="st">"basic"</span>,</span>
<span>            include_answer <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>            max_results <span class="op">=</span> <span class="fl">10</span>,</span>
<span>            api_key <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"TAVILY_API_KEY"</span><span class="op">)</span></span>
<span>        <span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>        <span class="fu">httr2</span><span class="fu">::</span><span class="fu"><a href="https://httr2.r-lib.org/reference/req_error.html" class="external-link">req_error</a></span><span class="op">(</span>is_error <span class="op">=</span> \<span class="op">(</span><span class="va">resp</span><span class="op">)</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>        <span class="fu">httr2</span><span class="fu">::</span><span class="fu"><a href="https://httr2.r-lib.org/reference/req_throttle.html" class="external-link">req_throttle</a></span><span class="op">(</span>rate <span class="op">=</span> <span class="fl">20</span><span class="op">/</span><span class="fl">60</span>, realm <span class="op">=</span> <span class="st">"tavily"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>        <span class="fu">httr2</span><span class="fu">::</span><span class="fu"><a href="https://httr2.r-lib.org/reference/req_perform.html" class="external-link">req_perform</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>        <span class="fu">httr2</span><span class="fu">::</span><span class="fu"><a href="https://httr2.r-lib.org/reference/resp_body_raw.html" class="external-link">resp_body_json</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>        <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/keep_at.html" class="external-link">discard_at</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"response_time"</span>, <span class="st">"follow_up_questions"</span>, <span class="st">"images"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">results</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">results</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/keep_at.html" class="external-link">discard_at</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"raw_content"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu">jsonlite</span><span class="fu">::</span><span class="fu"><a href="https://jeroen.r-universe.dev/jsonlite/reference/fromJSON.html" class="external-link">toJSON</a></span><span class="op">(</span><span class="va">results</span>, pretty <span class="op">=</span> <span class="cn">FALSE</span>, auto_unbox <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<p><strong>Fetch:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">web_fetch</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">url</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co">#' @description Fetch and extract the main text content from a web page as clean markdown. Returns the page content with formatting preserved, stripped of navigation, ads, and boilerplate. Use this to read articles, documentation, blog posts, or any web page content. Automatically falls back to alternative methods if the primary fetch fails.</span></span>
<span>    <span class="co">#' @param url:string* The complete URL of the web page to fetch (e.g., "https://example.com/article"). Must be a valid HTTP/HTTPS URL.</span></span>
<span>    </span>
<span>    <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">web_fetch_trafilatura</span><span class="op">(</span><span class="va">url</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">could_not_fetch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>        <span class="st">"Impossible to fetch the contents of this web page"</span>,</span>
<span>        <span class="st">"Please reload this page"</span>,</span>
<span>        <span class="st">"There was an error while loading"</span>,</span>
<span>        <span class="st">"404"</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span> <span class="op">||</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span> <span class="op">||</span> <span class="fu"><a href="https://rdrr.io/r/base/nchar.html" class="external-link">nchar</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">||</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">res</span>, <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/modifiers.html" class="external-link">fixed</a></span><span class="op">(</span><span class="va">could_not_fetch</span>, ignore_case <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">web_fetch_rvest</span><span class="op">(</span><span class="va">url</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">web_fetch_trafilatura</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">url</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># pip install trafilatura</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span><span class="op">{</span></span>
<span>        <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"trafilatura -u "</span>, <span class="va">url</span>, <span class="st">" --markdown --no-comments --links "</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/system.html" class="external-link">system</a></span><span class="op">(</span>intern <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>            <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/keep.html" class="external-link">keep</a></span><span class="op">(</span><span class="va">nzchar</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span>collapse <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span></span>
<span>        </span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span>
<span>    <span class="op">}</span>,</span>
<span>    error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="st">"Impossible to fetch the contents of this web page. It might not allow scraping"</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">web_fetch_rvest</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">url</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">tags_to_ignore</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>        <span class="st">"a"</span>, <span class="st">"script"</span>, <span class="st">"code"</span>, <span class="st">"img"</span>, <span class="st">"svg"</span>, <span class="st">"footer"</span>, <span class="st">"g"</span>, <span class="st">"path"</span>, <span class="st">"polygon"</span>, <span class="st">"label"</span>, <span class="st">"button"</span>, <span class="st">"form"</span>, <span class="st">"input"</span>, <span class="st">"select"</span>, </span>
<span>        <span class="st">"style"</span>, <span class="st">"link"</span>, <span class="st">"meta"</span>, <span class="st">"noscript"</span>, <span class="st">"iframe"</span>, <span class="st">"embed"</span>, <span class="st">"object"</span>, <span class="st">"param"</span>, <span class="st">"video"</span>, <span class="st">"audio"</span>, <span class="st">"track"</span>, <span class="st">"source"</span>, </span>
<span>        <span class="st">"canvas"</span>, <span class="st">"map"</span>, <span class="st">"area"</span>, <span class="st">"math"</span>, <span class="st">"col"</span>, <span class="st">"colgroup"</span>, <span class="st">"dl"</span>, <span class="st">"dt"</span>, <span class="st">"dd"</span>, <span class="st">"hr"</span>, <span class="st">"pre"</span>, <span class="st">"address"</span>, <span class="st">"figure"</span>, <span class="st">"figcaption"</span>,</span>
<span>        <span class="st">"dfn"</span>, <span class="st">"em"</span>, <span class="st">"kbd"</span>, <span class="st">"samp"</span>, <span class="st">"var"</span>, <span class="st">"del"</span>, <span class="st">"ins"</span>, <span class="st">"mark"</span>, <span class="st">"circle"</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span>    <span class="va">remove_tags</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">xml</span>, <span class="va">tags</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">walk</a></span><span class="op">(</span><span class="va">tags</span>, \<span class="op">(</span><span class="va">tag</span><span class="op">)</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">walk</a></span><span class="op">(</span><span class="fu">xml2</span><span class="fu">::</span><span class="fu"><a href="http://xml2.r-lib.org/reference/xml_find_all.html" class="external-link">xml_find_all</a></span><span class="op">(</span><span class="va">xml</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">".//"</span>, <span class="va">tag</span><span class="op">)</span><span class="op">)</span>, \<span class="op">(</span><span class="va">node</span><span class="op">)</span> <span class="fu">xml2</span><span class="fu">::</span><span class="fu"><a href="http://xml2.r-lib.org/reference/xml_replace.html" class="external-link">xml_remove</a></span><span class="op">(</span><span class="va">node</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">xml</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span></span>
<span>    <span class="va">cleaned_contents</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span></span>
<span>        <span class="fu">rvest</span><span class="fu">::</span><span class="fu"><a href="http://xml2.r-lib.org/reference/read_xml.html" class="external-link">read_html</a></span><span class="op">(</span><span class="va">url</span><span class="op">)</span></span>
<span>        <span class="op">|&gt;</span> <span class="fu">rvest</span><span class="fu">::</span><span class="fu"><a href="https://rvest.tidyverse.org/reference/html_element.html" class="external-link">html_element</a></span><span class="op">(</span><span class="st">"body"</span><span class="op">)</span></span>
<span>        <span class="op">|&gt;</span> <span class="fu">remove_tags</span><span class="op">(</span><span class="va">tags_to_ignore</span><span class="op">)</span></span>
<span>        <span class="op">|&gt;</span> <span class="fu">rvest</span><span class="fu">::</span><span class="fu"><a href="https://rvest.tidyverse.org/reference/html_children.html" class="external-link">html_children</a></span><span class="op">(</span><span class="op">)</span></span>
<span>        <span class="op">|&gt;</span> <span class="fu">rvest</span><span class="fu">::</span><span class="fu"><a href="https://rvest.tidyverse.org/reference/html_text.html" class="external-link">html_text2</a></span><span class="op">(</span><span class="op">)</span></span>
<span>        <span class="op">|&gt;</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/keep.html" class="external-link">discard</a></span><span class="op">(</span>\<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span> <span class="op">==</span> <span class="st">""</span><span class="op">)</span></span>
<span>        <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span>collapse <span class="op">=</span> <span class="st">"\n\n"</span><span class="op">)</span>,</span>
<span>        error <span class="op">=</span> \<span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">cleaned_contents</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
</details><p>Then, define a JSON schema for structured output using <code><a href="../reference/tool_definitions.html">schema()</a></code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">package_info_schema</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tool_definitions.html">schema</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"package_info"</span>,</span>
<span>    description <span class="op">=</span> <span class="st">"Information about an R package release"</span>,</span>
<span>    release_version <span class="op">=</span> <span class="st">"string* The release version of the package"</span>,</span>
<span>    release_date <span class="op">=</span> <span class="st">"string* The release date of the `release_version`"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<p>Create an assistant with client-side tools:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">openai_assistant</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/OpenAI_Assistant.html">OpenAI_Assistant</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="fu">create_assistant</span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"My Assistant"</span>,</span>
<span>    model <span class="op">=</span> <span class="st">"gpt-4.1"</span>,</span>
<span>    tools <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="../reference/tool_definitions.html">as_tool</a></span><span class="op">(</span><span class="va">web_search</span><span class="op">)</span>, <span class="fu"><a href="../reference/tool_definitions.html">as_tool</a></span><span class="op">(</span><span class="va">web_fetch</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<p>Ask a question with structured output:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">openai_assistant</span><span class="op">$</span><span class="fu">chat</span><span class="op">(</span></span>
<span>    <span class="st">"When was the first release of the R 'ellmer' package on GitHub?"</span>,</span>
<span>    output_schema <span class="op">=</span> <span class="va">package_info_schema</span></span>
<span><span class="op">)</span></span>
<span><span class="fl">6</span><span class="co">#&gt; ✔ [OpenAI Assistant] Thread created: thread_leVxekjFQnO8vUES62HBJuLc</span></span></code></pre></div>
</div>
<div class="sourceCode" id="cb16"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>$release_version</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>[1] "0.1.0"</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>$release_date</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>[1] "2024-03-20"</span></code></pre></div>
<p><em>Hum. Not quite right …</em></p>
<div>
<blockquote>
<p><strong>Warning</strong></p>
<p>When an assistant uses server-side tools (like <code>file_search</code> or <code>code_interpreter</code>) and you provide an <code>output_schema</code>, the API forces a second call with the schema (and no tools) once the assistant is done using its tools, to bypass the fact that you can’t use server-side tools with structured outputs. This happens automatically.</p>
</blockquote>
</div>
</section><section class="section level2"><h2 id="server-side-tools">Server-side Tools<a class="anchor" aria-label="anchor" href="#server-side-tools"></a>
</h2>
<p>Server-side tools are tools you can call without having to define them yourself. They will be run on the provider’s server.</p>
<p>OpenAI Assistants API supports two server-side tools:</p>
<ul>
<li>
<strong>file_search</strong> - Search through uploaded files using vector stores (i.e. server-side RAG)</li>
<li>
<strong>code_interpreter</strong> - Execute Python code in sandboxed containers</li>
</ul>
<section class="level2"><h3 id="server-side-code-interpreter">Server-side: Code Interpreter<a class="anchor" aria-label="anchor" href="#server-side-code-interpreter"></a>
</h3>
<p>The Assistants API provides <code>code_interpreter</code> for executing Python code. Unlike the Responses API which uses containers, the Assistants API attaches files directly to the tool.</p>
<p><strong>Example: Analyzing the Penguins Dataset</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins_url</span> <span class="op">&lt;-</span> <span class="st">"https://raw.githubusercontent.com/allisonhorst/palmerpenguins/refs/heads/main/inst/extdata/penguins.csv"</span></span>
<span><span class="va">penguins_file_metadata</span> <span class="op">&lt;-</span> <span class="va">openai_assistant</span><span class="op">$</span><span class="fu">upload_file</span><span class="op">(</span><span class="va">penguins_url</span>, purpose <span class="op">=</span> <span class="st">"assistants"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data_analyst</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/OpenAI_Assistant.html">OpenAI_Assistant</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="fu">create_assistant</span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"Data Analyst"</span>,</span>
<span>    model <span class="op">=</span> <span class="st">"gpt-4.1"</span>,</span>
<span>    tools <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"code_interpreter"</span>, file_ids <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">penguins_file_metadata</span><span class="op">$</span><span class="va">id</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">data_analyst</span><span class="op">$</span><span class="fu">chat</span><span class="op">(</span></span>
<span>    <span class="st">"Create a summary table showing average body_mass grouped by species, sex, and year. Save as CSV."</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<p>Download generated files:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">downloaded_paths</span> <span class="op">&lt;-</span> <span class="va">data_analyst</span><span class="op">$</span><span class="fu">download_generated_files</span><span class="op">(</span>dest_path <span class="op">=</span> <span class="st">"data"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="va">downloaded_paths</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, na.strings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">""</span>, <span class="st">"NA"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="sourceCode" id="cb20"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>     species    sex year body_mass_g</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>1     Adelie female 2007    3389.773</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>2     Adelie female 2008    3386.000</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>3     Adelie female 2009    3334.615</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>4     Adelie   male 2007    4038.636</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>5     Adelie   male 2008    4098.000</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>6     Adelie   male 2009    3995.192</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>7  Chinstrap female 2007    3569.231</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>8  Chinstrap female 2008    3472.222</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>9  Chinstrap female 2009    3522.917</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>10 Chinstrap   male 2007    3819.231</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>11 Chinstrap   male 2008    4127.778</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>12 Chinstrap   male 2009    3927.083</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>13    Gentoo female 2007    4618.750</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>14    Gentoo female 2008    4627.273</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>15    Gentoo female 2009    4786.250</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>16    Gentoo   male 2007    5552.941</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>17    Gentoo   male 2008    5410.870</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>18    Gentoo   male 2009    5510.714</span></code></pre></div>
<p>Continue asking questions in the same thread:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguin_output_schema</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tool_definitions.html">schema</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"penguin_output"</span>,</span>
<span>    description <span class="op">=</span> <span class="st">"Schema for the penguin output"</span>,</span>
<span>    average_body_mass <span class="op">=</span> <span class="st">"number* The average body_mass"</span>,</span>
<span>    species <span class="op">=</span> <span class="st">"string* The species"</span>,</span>
<span>    sex <span class="op">=</span> <span class="st">"string* The sex"</span>,</span>
<span>    year <span class="op">=</span> <span class="st">"integer* The year"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">data_analyst</span><span class="op">$</span><span class="fu">chat</span><span class="op">(</span></span>
<span>    <span class="st">"What's the average body_mass for the Adelie females in 2009? Use the code_interpreter tool to compute the answer."</span>,</span>
<span>    output_schema <span class="op">=</span> <span class="va">penguin_output_schema</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="sourceCode" id="cb22"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>$average_body_mass</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>[1] 3317.073</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>$species</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>[1] "Adelie"</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>$sex</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>[1] "male"</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>$year</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>[1] 2007</span></code></pre></div>
<p><em>Incorrect year, incorrect sex, and even accounting for that, the value is incorrect …</em></p>
<div>
<blockquote>
<p><strong>Note</strong></p>
<p>The Responses API uses containers for code execution with dedicated management methods (<code>list_containers()</code>, <code>delete_container()</code>). The Assistants API attaches files directly and maintains context automatically within threads.</p>
</blockquote>
</div>
</section></section><section class="section level2"><h2 id="multimodal-inputs">Multimodal Inputs<a class="anchor" aria-label="anchor" href="#multimodal-inputs"></a>
</h2>
<p>OpenAI Assistants API supports sending:</p>
<ul>
<li>Images: URLs (as-is, or base64), files (base64)</li>
<li>PDFs: URLs (as-is, base64, or text content), files (base64, or text content)</li>
<li>Remote files (through <code><a href="../reference/as_file_content.html">as_file_content()</a></code>)</li>
<li>Plain text &amp; code files</li>
<li>Text-based data files (csv, tsv, json, ..)</li>
<li>R objects</li>
</ul>
<section class="level2"><h3 id="image-comprehension">Image Comprehension<a class="anchor" aria-label="anchor" href="#image-comprehension"></a>
</h3>
<div class="cell">
<details class="code-fold"><summary>Downloading an example image</summary><div class="sourceCode cell-code" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bsg04_cast_image_url</span> <span class="op">&lt;-</span> <span class="st">"https://upload.wikimedia.org/wikipedia/en/1/1a/Battlestar_Galactica_%282004%29_cast.jpg"</span></span>
<span><span class="va">bsg04_cast_image_path</span> <span class="op">&lt;-</span> <span class="fu">download_temp_file</span><span class="op">(</span><span class="va">bsg04_cast_image_url</span><span class="op">)</span></span></code></pre></div>
</details>
</div>
<p><strong>Sending a local image:</strong></p>
<p>When we provide a local image path, the image will be automatically uploaded to the server and the file_id will be passed to the model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">openai_assistant</span><span class="op">$</span><span class="fu">chat</span><span class="op">(</span></span>
<span>    <span class="st">"Who are the characters in this image, and what show is it from?"</span>,</span>
<span>    <span class="va">bsg04_cast_image_path</span>,</span>
<span>    in_new_thread <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="sourceCode" id="cb25"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>The characters in the image are from the television series **Battlestar Galactica**, which aired from 2004 to 2009. Here are the main characters shown:</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>1. **William Adama** (played by Edward James Olmos) - Commanding Officer of the Galactica.</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>2. **Laura Roslin** (played by Mary McDonnell) - President of the Twelve Colonies and a key leader.</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>3. **Lee "Apollo" Adama** (played by Jamie Bamber) - A captain in the Colonial Fleet and son of Bill Adama.</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>4. **Kara "Starbuck" Thrace** (played by Katee Sackhoff) - A talented pilot known for her rebellious nature.</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>5. **Gaius Baltar** (played by James Callis) - A scientist with a complex role in the series’ storyline.</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>6. **Number Six** (played by Tricia Helfer) - A Cylon who plays a significant role in the narrative.</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>7. **Baltar's Number Six** (also played by Tricia Helfer) - A manifestation that interacts with Gaius Baltar.</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>These characters are central to the themes of survival, morality, and human identity explored in the series.</span></code></pre></div>
<div>
<blockquote>
<p><strong>Warning</strong></p>
<p>Behind the scenes, this is uploading the image to the server (i.e. using <code>$upload_file()</code>) and then passing the file_id to the model. Don’t forget to delete the file after use with <code>$delete_file()</code>.</p>
</blockquote>
</div>
<p><em>So say we all!</em></p>
<p><strong>Sending an image URL:</strong></p>
<p>OpenAI supports sending image URLs as-is:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">openai_assistant</span><span class="op">$</span><span class="fu">chat</span><span class="op">(</span></span>
<span>    <span class="st">"Who are the characters in this image, and what show is it from?"</span>,</span>
<span>    <span class="va">bsg04_cast_image_url</span>,</span>
<span>    in_new_thread <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div>
<blockquote>
<p><strong>Note</strong></p>
<p>OpenAI supports an optional <code>detail</code> parameter (low/high/auto) to control the image processing detail level when the image is sent as a URL. The default value is <code>"auto"</code>.</p>
<p>To specify this parameter, pass the image URL to <code>as_image_content(url, .provider_options = list(detail = "low"))</code>.</p>
<p>You could also use <code><a href="../reference/as_image_content.html">as_image_content()</a></code> to resize the image before sending it with the <code>.resize</code> argument.</p>
<p>OpenAI Assistants API also supports sending a file_id (i.e. the image <code>as_file_content(file_id)</code> after uploading it with <code>openai_assistant$upload_file()</code>).</p>
</blockquote>
</div>
</section><section class="level2"><h3 id="pdf-comprehension">PDF Comprehension<a class="anchor" aria-label="anchor" href="#pdf-comprehension"></a>
</h3>
<div class="cell">
<details class="code-fold"><summary>Downloading an example PDF (my CV)</summary><div class="sourceCode cell-code" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_cv_url</span> <span class="op">&lt;-</span> <span class="st">"https://ma-riviere.com/res/cv.pdf"</span></span>
<span><span class="va">my_cv_pdf_path</span> <span class="op">&lt;-</span> <span class="fu">download_temp_file</span><span class="op">(</span><span class="va">my_cv_url</span><span class="op">)</span></span></code></pre></div>
</details>
</div>
<p>For PDFs, we need to give the assistant the <code>file_search</code> tool to be able to search through the PDF’s contents, so let’s create an assistant with that tool:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pdf_assistant</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/OpenAI_Assistant.html">OpenAI_Assistant</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="fu">create_assistant</span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"PDF Assistant"</span>,</span>
<span>    model <span class="op">=</span> <span class="st">"gpt-4o-mini"</span>,</span>
<span>    tools <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"file_search"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div>
<blockquote>
<p><strong>Warning</strong></p>
<p>Behind the scenes, this is uploading the PDF to the server (i.e. using <code>$upload_file()</code>) and then passing the file_id to the model. Don’t forget to delete the file after use with <code>$delete_file()</code>.</p>
</blockquote>
</div>
<p><strong>Sending a local PDF:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pdf_assistant</span><span class="op">$</span><span class="fu">chat</span><span class="op">(</span></span>
<span>    <span class="st">"What's my favorite programming language?"</span>,</span>
<span>    <span class="va">my_cv_pdf_path</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="sourceCode" id="cb30"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>Your favorite programming language appears to be **R**, as indicated by your extensive experience and focus on R and Shiny in your work and projects【4:0†source】.</span></code></pre></div>
<p><em>Damn right!</em></p>
<p><strong>Sending PDF URLs:</strong></p>
<p>For OpenAI Assistants, by default, PDF URLs (or files) are uploaded to the server and the file_id is passed to the model.</p>
<p>However, we can use the <code><a href="../reference/as_text_content.html">as_text_content()</a></code> helper to have <code><a href="https://docs.ropensci.org/pdftools//reference/pdf_render_page.html" class="external-link">pdftools::pdf_convert()</a></code> parse the PDFs and pass their text contents to the model instead.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">r6_pdf_url</span> <span class="op">&lt;-</span> <span class="st">"https://cran.r-project.org/web/packages/R6/R6.pdf"</span></span>
<span><span class="va">s7_pdf_url</span> <span class="op">&lt;-</span> <span class="st">"https://cran.r-project.org/web/packages/S7/S7.pdf"</span></span>
<span></span>
<span><span class="va">multimodal_prompt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="st">"Give a 3 sentences summary of the advantages of S7 over R6"</span>,</span>
<span>    <span class="fu"><a href="../reference/as_text_content.html">as_text_content</a></span><span class="op">(</span><span class="va">r6_pdf_url</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="../reference/as_text_content.html">as_text_content</a></span><span class="op">(</span><span class="va">s7_pdf_url</span><span class="op">)</span>,</span>
<span>    <span class="st">"And give me the current versions of both packages"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">openai_assistant</span><span class="op">$</span><span class="fu">chat</span><span class="op">(</span><span class="op">!</span><span class="op">!</span><span class="op">!</span><span class="va">multimodal_prompt</span>, in_new_thread <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="sourceCode" id="cb32"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>**Summary of the Advantages of S7 over R6:**</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>S7 is designed to be a more robust object-oriented programming system than R6, offering formal class and method specifications along with a limited form of multiple dispatch, which enhances its flexibility. It also integrates both S3 and S4 systems seamlessly, allowing for extensibility with the addition of a clear inheritance model and property validation, thereby promoting cleaner and more maintainable code. Furthermore, S7 facilitates better interoperability with base R types and modern R programming practices, making it more suitable for complex applications  .</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>**Current Versions of Both Packages:**</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>- **R6:** Version 2.6.1</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>- **S7:** Version 0.2.0</span></code></pre></div>
</section><section class="level2"><h3 id="passing-r-objects">Passing R Objects<a class="anchor" aria-label="anchor" href="#passing-r-objects"></a>
</h3>
<p>You can pass any R object to <code>chat()</code> as is:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lm_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">body_mass</span> <span class="op">~</span> <span class="va">species</span> <span class="op">+</span> <span class="va">sex</span>, data <span class="op">=</span> <span class="fu">datasets</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/r/datasets/penguins.html" class="external-link">penguins</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">openai_assistant</span><span class="op">$</span><span class="fu">chat</span><span class="op">(</span></span>
<span>    <span class="st">"What can we deduct from this regression model?"</span>,</span>
<span>    <span class="va">lm_obj</span>,</span>
<span>    in_new_thread <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div>
<blockquote>
<p><strong>Note</strong></p>
<p>Any R object passed to <code>chat()</code> will be automatically converted to JSON (or text if JSON conversion fails), with some added information like the name of the object and its classes.</p>
</blockquote>
</div>
</section><section class="level2"><h3 id="sending-files">Sending files<a class="anchor" aria-label="anchor" href="#sending-files"></a>
</h3>
<p>We can also send files directly to the model.</p>
<p>For this, we also need to give the assistant the <code>file_search</code> tool to be able to search through the files’ contents, so let’s create an assistant with that tool:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">file_assistant</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/OpenAI_Assistant.html">OpenAI_Assistant</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="fu">create_assistant</span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"File Assistant"</span>,</span>
<span>    model <span class="op">=</span> <span class="st">"gpt-4o-mini"</span>,</span>
<span>    tools <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"file_search"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<p><strong>Uploading Files</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">file_metadata</span> <span class="op">&lt;-</span> <span class="va">file_assistant</span><span class="op">$</span><span class="fu">upload_file</span><span class="op">(</span><span class="va">my_cv_url</span>, purpose <span class="op">=</span> <span class="st">"assistants"</span><span class="op">)</span></span></code></pre></div>
</div>
<p><strong>Listing Files</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">file_assistant</span><span class="op">$</span><span class="fu">list_files</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="sourceCode" id="cb37"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a># A tibble: 1 × 9</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>   object id                          purpose    filename                bytes created_at          expires_at status    status_details</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>   &lt;chr&gt;  &lt;chr&gt;                       &lt;chr&gt;      &lt;chr&gt;                   &lt;int&gt; &lt;dttm&gt;              &lt;lgl&gt;      &lt;chr&gt;     &lt;lgl&gt;         </span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a> 1 file   file-B1MRQat6f1sRArT3KhFkGu assistants file1e612f9544482.pdf  431965 2025-11-14 09:03:52 NA         processed NA  </span></code></pre></div>
<p><strong>Using Uploaded Files</strong></p>
<p>Use <code><a href="../reference/as_file_content.html">as_file_content()</a></code> to reference uploaded files:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">file_assistant</span><span class="op">$</span><span class="fu">chat</span><span class="op">(</span></span>
<span>    <span class="st">"What are my two favorite frameworks/tools ?"</span>,</span>
<span>    <span class="fu"><a href="../reference/as_file_content.html">as_file_content</a></span><span class="op">(</span><span class="va">file_metadata</span><span class="op">$</span><span class="va">id</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="sourceCode" id="cb39"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>Your two favorite frameworks/tools are **Shiny** and **Quarto**【4:0†source】.</span></code></pre></div>
<div>
<blockquote>
<p><strong>Note</strong></p>
<p>For Assistants, this does the same thing as simply giving the local file path in the inputs of <code>$chat()</code>, like in the “PDF Comprehension” section.</p>
</blockquote>
</div>
<p><strong>Downloading Files</strong></p>
<div>
<blockquote>
<p><strong>Note</strong></p>
<p>Files with purpose ‘assistants’ cannot be downloaded.</p>
</blockquote>
</div>
<p><strong>Deleting Files</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">file_assistant</span><span class="op">$</span><span class="fu">delete_file</span><span class="op">(</span><span class="va">file_metadata</span><span class="op">$</span><span class="va">id</span><span class="op">)</span></span>
<span><span class="co">#&gt; ✔ [OpenAI] File deleted: file-B1MRQat6f1sRArT3KhFkGu</span></span></code></pre></div>
</div>
</section></section><section class="section level2"><h2 id="server-side-rag">Server-Side RAG<a class="anchor" aria-label="anchor" href="#server-side-rag"></a>
</h2>
<p>Instead of just passing single files to the Assistant, we can also add them to a vector store (where the files are chunked and indexed) and use the <code>file_search</code> tool to search through the store and retrieve the relevant chunks, effectively turning it into a server-side RAG application. This is useful when your files are too large to pass directly to the model.</p>
<section class="level2"><h3 id="vector-store-management">Vector Store Management<a class="anchor" aria-label="anchor" href="#vector-store-management"></a>
</h3>
<p>First, a quick overview of available methods to manage vector stores:</p>
<p><strong>Creating a Vector Store</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">store</span> <span class="op">&lt;-</span> <span class="va">file_assistant</span><span class="op">$</span><span class="fu">create_store</span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"my_docs"</span>,</span>
<span>    file_ids <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"file-123"</span>, <span class="st">"file-456"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<p><strong>Listing Vector Stores</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">openai_assistant</span><span class="op">$</span><span class="fu">list_stores</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<p><strong>Adding Files to a Vector Store</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">openai_assistant</span><span class="op">$</span><span class="fu">add_file_to_store</span><span class="op">(</span><span class="va">store</span><span class="op">$</span><span class="va">id</span>, <span class="st">"file-789"</span><span class="op">)</span></span></code></pre></div>
</div>
<p><strong>Listing Files in a Vector Store</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">openai_assistant</span><span class="op">$</span><span class="fu">list_files_in_store</span><span class="op">(</span><span class="va">store</span><span class="op">$</span><span class="va">id</span><span class="op">)</span></span></code></pre></div>
</div>
<p><strong>Deleting a Vector Store</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">openai_assistant</span><span class="op">$</span><span class="fu">delete_store</span><span class="op">(</span><span class="va">store</span><span class="op">$</span><span class="va">id</span><span class="op">)</span></span></code></pre></div>
</div>
<div>
<blockquote>
<p><strong>Note</strong></p>
<p>Files and vector stores are shared across all OpenAI APIs (Chat Completions, Responses, and Assistants). A file uploaded via one API can be used in another.</p>
</blockquote>
</div>
</section><section class="level2"><h3 id="basic-server-side-rag-example">Basic Server-Side RAG Example<a class="anchor" aria-label="anchor" href="#basic-server-side-rag-example"></a>
</h3>
<p>First, let’s upload the files we want to search through and create a vector store with them:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">r6_file_metadata</span> <span class="op">&lt;-</span> <span class="va">openai_assistant</span><span class="op">$</span><span class="fu">upload_file</span><span class="op">(</span><span class="va">r6_pdf_url</span>, purpose <span class="op">=</span> <span class="st">"assistants"</span><span class="op">)</span></span>
<span><span class="va">s7_file_metadata</span> <span class="op">&lt;-</span> <span class="va">openai_assistant</span><span class="op">$</span><span class="fu">upload_file</span><span class="op">(</span><span class="va">s7_pdf_url</span>, purpose <span class="op">=</span> <span class="st">"assistants"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">r_oop_store</span> <span class="op">&lt;-</span> <span class="va">openai_assistant</span><span class="op">$</span><span class="fu">create_store</span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"r_oop_store"</span>,</span>
<span>    file_ids <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">r6_file_metadata</span><span class="op">$</span><span class="va">id</span>, <span class="va">s7_file_metadata</span><span class="op">$</span><span class="va">id</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<p>Then, define an output schema for the response:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">oop_output_schema</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tool_definitions.html">schema</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"oop_output"</span>,</span>
<span>    description <span class="op">=</span> <span class="st">"Explanation of the R6 and S7 active bindings mechanism"</span>,</span>
<span>    short_answer <span class="op">=</span> <span class="st">"string* The short answer to the question, in plain text. One sentence."</span>,</span>
<span>    r6_code_example <span class="op">=</span> <span class="st">"string* R6 active bindings code example. Formatted as code block (```{r} ... ```)."</span>,</span>
<span>    s7_code_example <span class="op">=</span> <span class="st">"string* S7 active bindings 'equivalent' code example. Formatted as code block (```{r} ... ```)."</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<p>Create an assistant with <code>file_search</code> and use it with structured output:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rag_assistant</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/OpenAI_Assistant.html">OpenAI_Assistant</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>rate_limit <span class="op">=</span> <span class="fl">3</span> <span class="op">/</span> <span class="fl">60</span><span class="op">)</span><span class="op">$</span><span class="fu">create_assistant</span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"R OOP Expert"</span>,</span>
<span>    model <span class="op">=</span> <span class="st">"gpt-4.1"</span>,</span>
<span>    tools <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"file_search"</span>, store_ids <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">r_oop_store</span><span class="op">$</span><span class="va">id</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        <span class="fu"><a href="../reference/tool_definitions.html">as_tool</a></span><span class="op">(</span><span class="va">web_search</span><span class="op">)</span>,</span>
<span>        <span class="fu"><a href="../reference/tool_definitions.html">as_tool</a></span><span class="op">(</span><span class="va">web_fetch</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div>
<blockquote>
<p><strong>Note</strong></p>
<p>Unlike the Responses API where you can specify the vector store per-call, the Assistants API attaches the vector store to the assistant during creation. The store is available for all chat calls across all threads.</p>
</blockquote>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="va">rag_assistant</span><span class="op">$</span><span class="fu">chat</span><span class="op">(</span></span>
<span>    <span class="st">"What's the active bindings' R6 mechanism equivalent in S7?"</span>,</span>
<span>    <span class="st">"Important: use both the file_search and web_search &amp; web_fetch tools to find the information."</span>,</span>
<span>    output_schema <span class="op">=</span> <span class="va">oop_output_schema</span>,</span>
<span>    remove_citations <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div>
<blockquote>
<p><strong>Note</strong></p>
<p>The Assistants API includes citation markers like 【35†source】 and [3:0†source] in responses when using <code>file_search</code>. Set <code>remove_citations = TRUE</code> in <code>chat()</code> to automatically remove these markers from the response text.</p>
</blockquote>
</div>
<details><summary>Response</summary><div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">walk</a></span><span class="op">(</span><span class="va">res</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"\n\n"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<p>R6 uses ‘active bindings’ to define properties that compute values dynamically when accessed, whereas S7 uses active class methods to achieve similar behavior.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r6.r-lib.org" class="external-link">R6</a></span><span class="op">)</span></span>
<span><span class="va">Person</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://r6.r-lib.org/reference/R6Class.html" class="external-link">R6Class</a></span><span class="op">(</span><span class="st">"Person"</span>,</span>
<span>  private <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>age <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>,</span>
<span>  active <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    age <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">value</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/missing.html" class="external-link">missing</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="va">private</span><span class="op">$</span><span class="va">age</span>      <span class="co"># Getter</span></span>
<span>      <span class="kw">else</span> <span class="va">private</span><span class="op">$</span><span class="va">age</span> <span class="op">&lt;-</span> <span class="va">value</span>            <span class="co"># Setter</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="va">Person</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">p</span><span class="op">$</span><span class="va">age</span>           <span class="co"># get age</span></span>
<span><span class="va">p</span><span class="op">$</span><span class="va">age</span> <span class="op">&lt;-</span> <span class="fl">35</span>     <span class="co"># set age</span></span>
<span><span class="va">p</span><span class="op">$</span><span class="va">age</span>           <span class="co"># get new age</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rconsortium.github.io/S7/" class="external-link">S7</a></span><span class="op">)</span></span>
<span><span class="va">Person</span> <span class="op">&lt;-</span> <span class="fu">new_class</span><span class="op">(</span><span class="st">"Person"</span>,</span>
<span>  properties <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>age <span class="op">=</span> <span class="va">class_double</span><span class="op">)</span>,</span>
<span>  methods <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    age <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">self</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">self</span><span class="op">@</span><span class="va">age</span>     <span class="co"># Getter equivalent</span></span>
<span>    <span class="op">}</span>,</span>
<span>    set_age <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">self</span>, <span class="va">value</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">self</span><span class="op">@</span><span class="va">age</span> <span class="op">&lt;-</span> <span class="va">value</span>   <span class="co"># Setter equivalent</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">Person</span><span class="op">(</span>age <span class="op">=</span> <span class="fl">30</span><span class="op">)</span></span>
<span><span class="va">p</span><span class="op">$</span><span class="fu">age</span><span class="op">(</span><span class="op">)</span>          <span class="co"># get age</span></span>
<span><span class="va">p</span><span class="op">$</span><span class="fu">set_age</span><span class="op">(</span><span class="fl">35</span><span class="op">)</span>    <span class="co"># set age</span></span>
<span><span class="va">p</span><span class="op">$</span><span class="fu">age</span><span class="op">(</span><span class="op">)</span>          <span class="co"># get new age</span></span></code></pre></div>
</div>
</details><p>View citations and supplementary information:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">rag_assistant</span><span class="op">$</span><span class="fu">get_supplementary</span><span class="op">(</span>format_to <span class="op">=</span> <span class="st">"yaml"</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">citations</span><span class="kw">:</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">type</span><span class="kw">:</span><span class="at"> file_citation</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">text</span><span class="kw">:</span><span class="at"> 【6:18†file216bb87f788d7f.pdf】</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">start_index</span><span class="kw">:</span><span class="at"> </span><span class="dv">1264</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">end_index</span><span class="kw">:</span><span class="at"> </span><span class="dv">1293</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">file_citation</span><span class="kw">:</span></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">file_id</span><span class="kw">:</span><span class="at"> file-N3CEQUR9ttxiRpo2qm3nqS</span></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">type</span><span class="kw">:</span><span class="at"> file_citation</span></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">text</span><span class="kw">:</span><span class="at"> 【6:13†file216bb87f788d7f.pdf】</span></span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">start_index</span><span class="kw">:</span><span class="at"> </span><span class="dv">1293</span></span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">end_index</span><span class="kw">:</span><span class="at"> </span><span class="dv">1322</span></span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">file_citation</span><span class="kw">:</span></span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">file_id</span><span class="kw">:</span><span class="at"> file-N3CEQUR9ttxiRpo2qm3nqS</span></span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">type</span><span class="kw">:</span><span class="at"> file_citation</span></span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">text</span><span class="kw">:</span><span class="at"> 【6:0†file216bb87f788d7f.pdf】</span></span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">start_index</span><span class="kw">:</span><span class="at"> </span><span class="dv">1497</span></span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">end_index</span><span class="kw">:</span><span class="at"> </span><span class="dv">1525</span></span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">file_citation</span><span class="kw">:</span></span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">file_id</span><span class="kw">:</span><span class="at"> file-N3CEQUR9ttxiRpo2qm3nqS</span></span></code></pre></div>
</div>
<p><strong>Cleaning up</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rag_assistant</span><span class="op">$</span><span class="fu">delete_store</span><span class="op">(</span><span class="va">r_oop_store</span><span class="op">$</span><span class="va">id</span><span class="op">)</span></span>
<span><span class="va">rag_assistant</span><span class="op">$</span><span class="fu">delete_file</span><span class="op">(</span><span class="va">r6_file_metadata</span><span class="op">$</span><span class="va">id</span><span class="op">)</span></span>
<span><span class="va">rag_assistant</span><span class="op">$</span><span class="fu">delete_file</span><span class="op">(</span><span class="va">s7_file_metadata</span><span class="op">$</span><span class="va">id</span><span class="op">)</span></span>
<span><span class="va">rag_assistant</span><span class="op">$</span><span class="fu">delete_assistant</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div>
<blockquote>
<p><strong>Tip</strong></p>
<p>We could have deleted everything (assistant, stores used by the assistant, and files used by the stores) with :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rag_assistant</span><span class="op">$</span><span class="fu">delete_assistant_and_contents</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
</blockquote>
</div>
</section></section><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config);
    }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script></main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://ma-riviere.com" class="external-link">Marc-Aurèle Rivière</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
