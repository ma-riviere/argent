% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/provider.R
\name{Provider}
\alias{Provider}
\title{Provider Base Class: shared interface & common functionalities for all LLM providers}
\description{
Base R6 class for all LLM provider clients. Provides shared infrastructure for:
\itemize{
\item Chat history management (get, set, reset, append)
\item Automatic history persistence to JSON (enabled by default, per-instance control)
\item Rate limiting configuration
\item Token usage tracking
}

This class is inherited by all provider classes (Google, Anthropic, OpenAI_Base)
to ensure consistent interfaces and eliminate code duplication.
}
\section{History Auto-Save}{

History auto-save is controlled per-instance and enabled by default. To control it:
\itemize{
\item At initialization: Pass \code{auto_save_history = TRUE/FALSE} to \verb{$new()} (default: TRUE)
\item After creation: Use \verb{$set_auto_save_history(TRUE/FALSE)} or \verb{$get_auto_save_history()}
}

Manual save/load available via \code{dump_history()} and \code{load_history()}.
}

\keyword{internal}
\section{Public fields}{
\if{html}{\out{<div class="r6-fields">}}
\describe{
\item{\code{base_url}}{Character. Base URL for API endpoint}

\item{\code{provider_name}}{Character. Provider name}

\item{\code{rate_limit}}{Numeric. Rate limit in requests per second}

\item{\code{history_file_path}}{Character. Full file path for persistent history storage}

\item{\code{chat_history}}{List. Conversation history (provider-specific format)}

\item{\code{session_history}}{List. Ground truth: alternating query_data and API responses}

\item{\code{server_tools}}{Character vector. Server-side tools to use for API requests}

\item{\code{default_model}}{Character. Default model to use for chat requests}
}
\if{html}{\out{</div>}}
}
\section{Methods}{
\subsection{Public methods}{
\itemize{
\item \href{#method-Provider-new}{\code{Provider$new()}}
\item \href{#method-Provider-get_rate_limit}{\code{Provider$get_rate_limit()}}
\item \href{#method-Provider-set_rate_limit}{\code{Provider$set_rate_limit()}}
\item \href{#method-Provider-get_history}{\code{Provider$get_history()}}
\item \href{#method-Provider-set_history}{\code{Provider$set_history()}}
\item \href{#method-Provider-get_chat_history}{\code{Provider$get_chat_history()}}
\item \href{#method-Provider-get_session_history}{\code{Provider$get_session_history()}}
\item \href{#method-Provider-dump_history}{\code{Provider$dump_history()}}
\item \href{#method-Provider-reset_history}{\code{Provider$reset_history()}}
\item \href{#method-Provider-get_history_file_path}{\code{Provider$get_history_file_path()}}
\item \href{#method-Provider-load_history}{\code{Provider$load_history()}}
\item \href{#method-Provider-get_auto_save_history}{\code{Provider$get_auto_save_history()}}
\item \href{#method-Provider-set_auto_save_history}{\code{Provider$set_auto_save_history()}}
\item \href{#method-Provider-get_session_last_token_count}{\code{Provider$get_session_last_token_count()}}
\item \href{#method-Provider-get_session_cumulative_token_count}{\code{Provider$get_session_cumulative_token_count()}}
\item \href{#method-Provider-get_last_response}{\code{Provider$get_last_response()}}
\item \href{#method-Provider-get_content_text}{\code{Provider$get_content_text()}}
\item \href{#method-Provider-get_reasoning_text}{\code{Provider$get_reasoning_text()}}
\item \href{#method-Provider-get_generated_code}{\code{Provider$get_generated_code()}}
\item \href{#method-Provider-get_generated_files}{\code{Provider$get_generated_files()}}
\item \href{#method-Provider-download_generated_files}{\code{Provider$download_generated_files()}}
\item \href{#method-Provider-get_supplementary}{\code{Provider$get_supplementary()}}
\item \href{#method-Provider-print}{\code{Provider$print()}}
\item \href{#method-Provider-clone}{\code{Provider$clone()}}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-Provider-new"></a>}}
\if{latex}{\out{\hypertarget{method-Provider-new}{}}}
\subsection{Method \code{new()}}{
Initialize a new Provider instance
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{Provider$new(
  base_url = NULL,
  api_key = NULL,
  provider_name = "Provider",
  rate_limit = NULL,
  server_tools = character(0),
  default_model = NULL,
  auto_save_history = TRUE
)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{base_url}}{Character. Base URL for API endpoint}

\item{\code{api_key}}{Character. API key for the provider}

\item{\code{provider_name}}{Character. Provider name}

\item{\code{rate_limit}}{Numeric. Rate limit in requests per second}

\item{\code{server_tools}}{Character vector. Server-side tools available}

\item{\code{default_model}}{Character. Default model to use for chat requests}

\item{\code{auto_save_history}}{Logical. Enable/disable automatic history sync (default: TRUE)}
}
\if{html}{\out{</div>}}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-Provider-get_rate_limit"></a>}}
\if{latex}{\out{\hypertarget{method-Provider-get_rate_limit}{}}}
\subsection{Method \code{get_rate_limit()}}{
Get the rate limit
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{Provider$get_rate_limit()}\if{html}{\out{</div>}}
}

\subsection{Returns}{
Numeric. Rate limit in requests per second
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-Provider-set_rate_limit"></a>}}
\if{latex}{\out{\hypertarget{method-Provider-set_rate_limit}{}}}
\subsection{Method \code{set_rate_limit()}}{
Set the rate limit
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{Provider$set_rate_limit(rate_limit)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{rate_limit}}{Numeric. Rate limit in requests per second}
}
\if{html}{\out{</div>}}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-Provider-get_history"></a>}}
\if{latex}{\out{\hypertarget{method-Provider-get_history}{}}}
\subsection{Method \code{get_history()}}{
Get both chat and session history
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{Provider$get_history()}\if{html}{\out{</div>}}
}

\subsection{Returns}{
List. History containing both chat_history and session_history
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-Provider-set_history"></a>}}
\if{latex}{\out{\hypertarget{method-Provider-set_history}{}}}
\subsection{Method \code{set_history()}}{
Set both chat and session history
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{Provider$set_history(history)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{history}}{List. Chat and session history to set (list(chat_history = ..., session_history = ...))}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
Self (invisibly) for method chaining
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-Provider-get_chat_history"></a>}}
\if{latex}{\out{\hypertarget{method-Provider-get_chat_history}{}}}
\subsection{Method \code{get_chat_history()}}{
Get the chat history. The chat history is the history of messages exchanged between the user and the model.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{Provider$get_chat_history()}\if{html}{\out{</div>}}
}

\subsection{Returns}{
List. Chat history
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-Provider-get_session_history"></a>}}
\if{latex}{\out{\hypertarget{method-Provider-get_session_history}{}}}
\subsection{Method \code{get_session_history()}}{
Get the session history
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{Provider$get_session_history()}\if{html}{\out{</div>}}
}

\subsection{Returns}{
List. Session history (alternating query_data and responses)
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-Provider-dump_history"></a>}}
\if{latex}{\out{\hypertarget{method-Provider-dump_history}{}}}
\subsection{Method \code{dump_history()}}{
Dump both chat and session history to JSON file
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{Provider$dump_history(dest_path = NULL)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{dest_path}}{Character. Optional custom file path. If NULL, uses history_file_path.}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
Character. Path to saved file (invisibly)
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-Provider-reset_history"></a>}}
\if{latex}{\out{\hypertarget{method-Provider-reset_history}{}}}
\subsection{Method \code{reset_history()}}{
Reset both chat and session history
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{Provider$reset_history()}\if{html}{\out{</div>}}
}

\subsection{Details}{
Archives current history before resetting, then generates new history_file_path
}

}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-Provider-get_history_file_path"></a>}}
\if{latex}{\out{\hypertarget{method-Provider-get_history_file_path}{}}}
\subsection{Method \code{get_history_file_path()}}{
Get the history file path
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{Provider$get_history_file_path()}\if{html}{\out{</div>}}
}

\subsection{Returns}{
Character. History file path
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-Provider-load_history"></a>}}
\if{latex}{\out{\hypertarget{method-Provider-load_history}{}}}
\subsection{Method \code{load_history()}}{
Load both chat and session history from JSON file
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{Provider$load_history(file_path)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{file_path}}{Character. Path to history file (absolute or relative to project root) or just filename}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
Self (invisibly) for method chaining
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-Provider-get_auto_save_history"></a>}}
\if{latex}{\out{\hypertarget{method-Provider-get_auto_save_history}{}}}
\subsection{Method \code{get_auto_save_history()}}{
Get the auto-save history setting
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{Provider$get_auto_save_history()}\if{html}{\out{</div>}}
}

\subsection{Returns}{
Logical. Auto-save history setting
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-Provider-set_auto_save_history"></a>}}
\if{latex}{\out{\hypertarget{method-Provider-set_auto_save_history}{}}}
\subsection{Method \code{set_auto_save_history()}}{
Set the auto-save history setting
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{Provider$set_auto_save_history(enabled)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{enabled}}{Logical. Enable/disable automatic history sync}
}
\if{html}{\out{</div>}}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-Provider-get_session_last_token_count"></a>}}
\if{latex}{\out{\hypertarget{method-Provider-get_session_last_token_count}{}}}
\subsection{Method \code{get_session_last_token_count()}}{
Get the total tokens used from session_history
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{Provider$get_session_last_token_count()}\if{html}{\out{</div>}}
}

\subsection{Returns}{
Integer. Total tokens used at last API call
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-Provider-get_session_cumulative_token_count"></a>}}
\if{latex}{\out{\hypertarget{method-Provider-get_session_cumulative_token_count}{}}}
\subsection{Method \code{get_session_cumulative_token_count()}}{
Get the cumulative tokens used from session_history
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{Provider$get_session_cumulative_token_count(up_to_index = NULL)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{up_to_index}}{Integer. Index up to which to calculate the cumulative tokens (default: NULL)}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
Integer. Cumulative tokens used computed from session_history, up to the specified index
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-Provider-get_last_response"></a>}}
\if{latex}{\out{\hypertarget{method-Provider-get_last_response}{}}}
\subsection{Method \code{get_last_response()}}{
Get the last API response
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{Provider$get_last_response()}\if{html}{\out{</div>}}
}

\subsection{Returns}{
List. Last API response object, or NULL if no response has been stored
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-Provider-get_content_text"></a>}}
\if{latex}{\out{\hypertarget{method-Provider-get_content_text}{}}}
\subsection{Method \code{get_content_text()}}{
Get the text content from an API response
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{Provider$get_content_text(api_res = self$get_last_response())}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{api_res}}{List. API response object (defaults to last response)}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
Character. Text content from response
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-Provider-get_reasoning_text"></a>}}
\if{latex}{\out{\hypertarget{method-Provider-get_reasoning_text}{}}}
\subsection{Method \code{get_reasoning_text()}}{
Get the text content from reasoning in an API response
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{Provider$get_reasoning_text(api_res = self$get_last_response())}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{api_res}}{List. API response object (defaults to last response)}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
Character or List. Text content from reasoning in response
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-Provider-get_generated_code"></a>}}
\if{latex}{\out{\hypertarget{method-Provider-get_generated_code}{}}}
\subsection{Method \code{get_generated_code()}}{
Get generated code from an API response (e.g. from code execution tools)
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{Provider$get_generated_code(
  api_res = self$get_last_response(),
  langs = NULL,
  as_chunks = FALSE
)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{api_res}}{List. API response object (defaults to last response)}

\item{\code{langs}}{Character vector. Languages to filter code parts by (default: NULL)}

\item{\code{as_chunks}}{Logical. Whether to return the code as a list of chunks (default: FALSE)}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
Character or List. Code content from response as list of chunks or as single string
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-Provider-get_generated_files"></a>}}
\if{latex}{\out{\hypertarget{method-Provider-get_generated_files}{}}}
\subsection{Method \code{get_generated_files()}}{
Get generated files from an API response (e.g. from code execution tools)
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{Provider$get_generated_files(api_res = self$get_last_response())}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{api_res}}{List. API response object (defaults to last response)}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
List. Files from response (each with mime_type and data), or NULL if none found
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-Provider-download_generated_files"></a>}}
\if{latex}{\out{\hypertarget{method-Provider-download_generated_files}{}}}
\subsection{Method \code{download_generated_files()}}{
Download files generated by code execution from an API response (e.g. from code execution tools)
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{Provider$download_generated_files(
  api_res = self$get_last_response(),
  dest_path = "data",
  overwrite = TRUE
)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{api_res}}{List. API response object (defaults to last response)}

\item{\code{dest_path}}{Character. Destination path for downloaded files}

\item{\code{overwrite}}{Logical. Whether to overwrite existing files}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
Character vector. Paths to saved files (invisibly)
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-Provider-get_supplementary"></a>}}
\if{latex}{\out{\hypertarget{method-Provider-get_supplementary}{}}}
\subsection{Method \code{get_supplementary()}}{
Get supplementary data from an API response (annotations, citations, grounding metadata, etc.)
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{Provider$get_supplementary(api_res = self$get_last_response())}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{api_res}}{List. API response object (defaults to last response)}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
List. Supplementary data from response (provider-specific structure)
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-Provider-print"></a>}}
\if{latex}{\out{\hypertarget{method-Provider-print}{}}}
\subsection{Method \code{print()}}{
Print chat history in a formatted view. Inspired by ellmer
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{Provider$print(
  show_system = TRUE,
  show_reasoning = TRUE,
  show_code = FALSE,
  show_tools = FALSE,
  show_supplementary = FALSE,
  max_content_length = 999
)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{show_system}}{Logical. Include system messages (default: TRUE)}

\item{\code{show_reasoning}}{Logical. Include reasoning/thinking blocks (default: TRUE)}

\item{\code{show_code}}{Logical. Include code blocks (default: FALSE)}

\item{\code{show_tools}}{Logical. Include tool calls and results (default: FALSE)}

\item{\code{show_supplementary}}{Logical. Include supplementary data like annotations, citations (default: FALSE)}

\item{\code{max_content_length}}{Integer. Maximum content length before truncation (default: 999)}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
Self (invisibly) for method chaining
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-Provider-clone"></a>}}
\if{latex}{\out{\hypertarget{method-Provider-clone}{}}}
\subsection{Method \code{clone()}}{
The objects of this class are cloneable with this method.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{Provider$clone(deep = FALSE)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{deep}}{Whether to make a deep clone.}
}
\if{html}{\out{</div>}}
}
}
}
